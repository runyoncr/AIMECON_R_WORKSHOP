<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>28&nbsp; Activity: Shiny App Development – Integrating Generative AI into R Workflows: From APIs to Shiny Apps</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./29-saving-shiny-data.html" rel="next">
<link href="./27-shiny-integration.html" rel="prev">
<link href="./therefore.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-23878c111f7dac4fb735463ab16209b4.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><link rel="stylesheet" href="style.css">
</head>
<body class="nav-sidebar floating fullcontent quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./25-shiny.html">Vibe Coding with Shiny</a></li><li class="breadcrumb-item"><a href="./activity-shiny-app-development.html"><span class="chapter-number">28</span>&nbsp; <span class="chapter-title">Activity: Shiny App Development</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Integrating Generative AI into R Workflows: From APIs to Shiny Apps</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false">
 <span class="menu-text">Setup</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-R-setup.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">R Setup</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-R-packages.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">R Packages</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-test-connect.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Testing API Connection</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-api-implementation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">API Implementation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-api-keys.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">API Keys</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false">
 <span class="menu-text">Generative AI Models</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 ">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-gen-ai-fundamentals.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Generative AI Fundamentals</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-gen-ai-basics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Foundational Principles</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-gen-ai-parameters.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Generation Parameters</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./activity-parameter-testing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Activity: Generation Parameter Testing</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false">
 <span class="menu-text">Conversational Interactions</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 ">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-integration.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Integrating LLMs into R Workflows</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11-conversations-via-api.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Chat Conversations via API</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./activity-content-development-revision.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Activity: Content Development and Revision</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false">
 <span class="menu-text">Transactional Interactions</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 ">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13-single-interactions-via-api.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Transactional Interactions via API</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14-prompt-engineering.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Prompt Engineering</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./15-prompt-formulas.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Prompt Formulas</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./activity-prompt-engineering.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Activity: Prompt Engineering</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./17-mitigating-variability.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Mitigating Output Variability</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./18-batch-processing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Batch Processing</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./19-rubric-scoring.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Scoring with Rubrics</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./activity-scoring-with-rubrics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Activity: Scoring with Rubrics</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./21-chained-workflows.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Chained Workflows</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./activity-chained-workflows.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Activity: Chained Workflows</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./23-calling-other-llms.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Call other (non-Gen AI) LLMs</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./24-rag-models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Retrieval Augmented Generation</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">Vibe Coding with Shiny</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./25-shiny.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">R Shiny</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./26-vibe-coding.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">“Vibe Coding”</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./27-shiny-integration.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">Vibe Coding R Shiny Apps</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./activity-shiny-app-development.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">28</span>&nbsp; <span class="chapter-title">Activity: Shiny App Development</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./29-saving-shiny-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">29</span>&nbsp; <span class="chapter-title">Saving R Shiny Data</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="false">
 <span class="menu-text">Resources</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 ">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./30-reference-materials.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">30</span>&nbsp; <span class="chapter-title">Reference Materials</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./31-acknowledgements.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Acknowledgements</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./32-references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./25-shiny.html">Vibe Coding with Shiny</a></li><li class="breadcrumb-item"><a href="./activity-shiny-app-development.html"><span class="chapter-number">28</span>&nbsp; <span class="chapter-title">Activity: Shiny App Development</span></a></li></ol></nav><div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span id="sec-act-shiny" class="quarto-section-identifier"><span class="chapter-number">28</span>&nbsp; <span class="chapter-title">Activity: Shiny App Development</span></span></h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header><p>Now it’s time to make an app! When building an app via vibe coding, I’ve found that it’s best to ask the model to add features to the app in chunks. Providing a long list of “must-haves” to the model in a single prompt can overwhelm the model, and it can be difficult to make tweaks to small parts of the app.</p>
<p>For my process, I usually outline the basic functionality of what I want the app to do in the first prompt, knowing that there will be additional functionality that I want to build out later. I will sometimes write out a list of the functionality that I want to be integrated into the app. I then review the list and see if there is a logical structure to order that I want the components built - do any features depend on having other functionality in place. From there I then start the process of iterating with the model to develop the code that I want.</p>
<p><strong>Note: Working with a model to vibe code can use a lot of tokens quickly.</strong> I have the lowest-tier plans with both Anthropic and ChatGPT, and the only time I’ve been told that I need to wait to submit another prompt is when I’ve been engaged in extensive vibe-coding sessions.</p>
<section id="data-visualization-with-existing-data" class="level2" data-number="28.1"><h2 data-number="28.1" class="anchored" data-anchor-id="data-visualization-with-existing-data">
<span class="header-section-number">28.1</span> Data Visualization with Existing Data</h2>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Initial Prompt to Generate a Prompt
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Help me generate a high-quality prompt that I can supply to an LLM to generate a Shiny app to evaluate the ChickWeight dataset. Have it include some interesting layout options, such as a sidebar or tabset. Also have some interesting pop-up displays of some sort - so when the user hovers over something (a graph, a selection box, etc) a pop-up is displayed that provides more context or provides instructions.</p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Prompt Generated by ChatGPT5
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Prompt: Build a Shiny App to Explore the <code>ChickWeight</code> Dataset (no APIs)</p>
<p><strong>Role:</strong> You are an expert R Shiny developer.</p>
<p><strong>Task:</strong> Create a complete, runnable <strong>single-file Shiny app (<code>app.R</code>)</strong> that explores the base R <strong><code><a href="https://rdrr.io/r/datasets/ChickWeight.html">datasets::ChickWeight</a></code></strong> dataset. The app must include: (1) a <strong>sidebar layout</strong> with global filters, (2) a <strong>tabset</strong> in the main area for multiple linked views, and (3) <strong>hover pop-ups / tooltips</strong> that provide instructions or context when users hover over inputs or UI elements.<br><strong>No external APIs or LLMs</strong>—everything is local to R.</p>
<hr>
<p><strong>Data</strong> Use <code><a href="https://rdrr.io/r/datasets/ChickWeight.html">datasets::ChickWeight</a></code> as the only data source. Variables:<br>
- <code>weight</code> (numeric), <code>Time</code> (days), <code>Chick</code> (ID), <code>Diet</code> (1–4).</p>
<hr>
<p><strong>Packages (keep dependencies modest)</strong> - Required: <strong>shiny</strong>, <strong>ggplot2</strong>, <strong>dplyr</strong>, <strong>tidyr</strong>, <strong>DT</strong>, <strong>bslib</strong><br>
- Optional (strongly preferred for interactivity): <strong>plotly</strong> for hover tooltips on charts<br>
- Do <strong>not</strong> use packages that need system libraries; keep it CRAN-friendly.</p>
<hr>
<p><strong>UI &amp; Layout</strong> Use <strong><code>bslib</code></strong> for a clean Bootstrap-5 theme (e.g., <code>bslib::bs_theme(preset = "minty")</code>).</p>
<p><strong>Overall structure:</strong> <code><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html">shiny::fluidPage()</a></code> → <code><a href="https://rdrr.io/pkg/shiny/man/sidebarLayout.html">shiny::sidebarLayout()</a></code><br>
- <strong>Sidebar panel (global filters):</strong> - <strong>Diet filter</strong>: <code>checkboxGroupInput</code> for Diet 1–4 (default: all) - Add a <strong>hover tooltip</strong> explaining diet codes (use <code><a href="https://rstudio.github.io/bslib/reference/tooltip.html">bslib::tooltip()</a></code> or <code><a href="https://rstudio.github.io/bslib/reference/popover.html">bslib::popover()</a></code> on the input label or an adjacent info icon). - <strong>Time range</strong>: <code>sliderInput</code> for days (0–21) - Add a tooltip: “Drag to focus growth interval; all summaries respect this window.” - <strong>Chick highlight</strong>: <code>selectizeInput</code> allowing multiple IDs to highlight (default: none) - Tooltip: “Type to find a Chick ID; selected IDs are emphasized in plots and table.” - <strong>Smoothing</strong>: <code>checkboxInput</code> to add LOESS mean curve per Diet (and optional CI ribbon) - Tooltip: “Show smoothed average by Diet; use with caution for small n.” - <strong>Scale</strong>: <code>radioButtons</code> for y-axis (“Linear”, “Log10”) - Tooltip: short rationale for log-scale. - <strong>Reset filters</strong>: <code>actionButton("reset", "Reset Filters")</code></p>
<ul>
<li>
<p><strong>Main panel (tabset)</strong> Use <code>tabsetPanel(id = "tabs", type = "pills")</code> with the following tabs:</p>
<ol type="1">
<li>
<strong>Overview</strong>
<ul>
<li>A <strong>valueBox-like summary row</strong> (simple cards) showing:
<ul>
<li>Number of visible chicks, average terminal weight (within time window), and number of timepoints.</li>
</ul>
</li>
<li>A short paragraph (Markdown) describing the dataset and how filters apply.</li>
<li>A <strong>popover</strong> (hover info icon) that explains the study design and why repeated measures matter.</li>
</ul>
</li>
<li>
<strong>Growth Curves</strong>
<ul>
<li>
<strong>Primary plot</strong>: weight vs.&nbsp;time lines, one line per Chick, colored by Diet.</li>
<li>Optional <strong>mean LOESS curve per Diet</strong> + semi-transparent ribbon (if smoothing is on).</li>
<li>
<strong>Highlight</strong> selected Chick IDs (thicker line/alpha=1).</li>
<li>If <code>plotly</code> is available, convert <code>ggplot</code> to <code><a href="https://rdrr.io/pkg/plotly/man/ggplotly.html">ggplotly()</a></code> so that <strong>hover</strong> shows:
<ul>
<li>Chick, Diet, Time, Weight, and (if computed) per-Chick slope for current window.</li>
</ul>
</li>
<li>Add a small <strong>info icon</strong> near the tab title with a <code><a href="https://rstudio.github.io/bslib/reference/popover.html">bslib::popover()</a></code> explaining how to read growth curves.</li>
</ul>
</li>
<li>
<strong>Diet Comparison</strong>
<ul>
<li>Side-by-side <strong>boxplots/violins</strong> of final weight (within the chosen time window) by Diet.</li>
<li>A secondary <strong>bar chart</strong> ranking Diets by mean terminal weight (or mean Δweight per Chick).</li>
<li>Hover/tooltip on the plot area describing how “final weight” is derived (max Time within window).</li>
</ul>
</li>
<li>
<strong>Chick Table</strong>
<ul>
<li>A <code><a href="https://rdrr.io/pkg/DT/man/datatable.html">DT::datatable</a></code> listing only the currently <strong>visible</strong> chicks (after filters), with columns:
<ul>
<li>Chick, Diet, n_timepoints (within window), first_weight, last_weight, <strong>Δweight</strong>, and <strong>slope</strong> (simple lm(weight ~ Time) over the window).</li>
</ul>
</li>
<li>
<strong>Row selection → highlights</strong> the corresponding Chick line in the Growth Curves tab (reactively).</li>
<li>Add a <strong>download button</strong> to export this table as CSV (no server storage).</li>
<li>Tooltip on the table header: “Click column headers to sort; use search to filter rows.”</li>
</ul>
</li>
<li>
<strong>About / Help</strong>
<ul>
<li>Concise prose on interpretation, caveats (missing values, small samples), and how smoothing/log scale change the view.</li>
<li>A <code><a href="https://rstudio.github.io/bslib/reference/popover.html">bslib::popover()</a></code> on “Caveats” that appears on hover for a few seconds.</li>
</ul>
</li>
</ol>
</li>
</ul>
<hr>
<p><strong>Server Requirements (high-level behavior)</strong> - Create a single reactive <strong>filtered dataset</strong> based on Diet and Time range. All downstream outputs depend on this. - <strong>Linked reactivity</strong>: - Changing filters updates all tabs’ outputs. - Selecting/changing Chick IDs highlights them in plots and the table. - Selecting rows in the table highlights those lines in the Growth Curves plot. - <strong>Derived metrics</strong> (computed on the filtered data): - Per-Chick <strong>Δweight</strong> = (max weight − min weight) for times within the window. - Per-Chick <strong>slope</strong> from <code>lm(weight ~ Time)</code> within the window; display as g/day. - Per-Diet summaries (mean terminal weight, median Δweight). - <strong>Validation/empty states</strong>: - If filters remove all data, show a friendly empty-state message instead of blank plots/tables. - <strong>Scale handling</strong>: - If log scale is selected, transform y-axis appropriately and suppress non-positive weights (with a note). - <strong>Reset</strong> button restores default filters.</p>
<hr>
<p><strong>Hover Pop-ups / Tooltips (must-have)</strong> Use <strong><code><a href="https://rstudio.github.io/bslib/reference/tooltip.html">bslib::tooltip()</a></code></strong> and/or <strong><code><a href="https://rstudio.github.io/bslib/reference/popover.html">bslib::popover()</a></code></strong> to attach hover help to: - Diet filter label (explain diet codes 1–4) - Time range slider label (explain windows) - Chick select label (how highlighting works) - Growth Curves tab title or an adjacent info icon (how to interpret lines and smoothing) - Diet Comparison plot container (how “final weight” is determined) - Table header (sorting/search tips)</p>
<p>If <code>plotly</code> is used, ensure <strong>hovertext</strong> on the graph shows: Chick, Diet, Time, Weight, and Slope (if available).</p>
<hr>
<p><strong>Quality &amp; Style</strong> - Clean, minimal design using <strong>bslib</strong>; sensible spacing and headings. - Clear code comments explaining each reactive object and output. - No external services or files; everything runs locally with <code><a href="https://rdrr.io/pkg/shiny/man/runApp.html">shiny::runApp()</a></code>. - Keep code in <strong>one file <code>app.R</code></strong>.</p>
<hr>
<p><strong>Deliverable</strong> Output <strong>only</strong> a complete <code>app.R</code> in a single code block, ready to run.</p>
<p><strong>Acceptance Criteria</strong> - App launches with sidebar + tabset and all tabs functioning. - Filters, highlights, and tabs are fully reactive and consistent. - Hover pop-ups/tooltips appear on specified inputs/areas using <code>bslib</code>. - Growth Curves and Diet Comparison are informative and respect filters/smoothing/scale. - Table reflects the filtered/visible cohort and supports row-selection highlighting. - CSV download works for the current table view.</p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
App Syntax Generated by Claude
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>You can either download the app below, or copy and paste the chunk of code in a new .R file. Then highlight and execute the text. It may take a minute or two the first time the app runs for it to be built, but a new window should open and the app should run.</p>
<p><a href="downloads/ChickWeight_app.R" download="" style="display: inline-block; padding: 10px 20px; background-color: #4A90E2; color: black; text-decoration: none; border-radius: 5px;"> 📥 Download <code>ChickWeight_app</code> </a></p>
<div class="cell">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># ==============================================================================</span></span>
<span><span class="co"># Shiny App: ChickWeight Explorer</span></span>
<span><span class="co"># A single-file app exploring the datasets::ChickWeight dataset</span></span>
<span><span class="co"># ==============================================================================</span></span>
<span></span>
<span><span class="co"># Load required packages</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://shiny.posit.co/">shiny</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org">tidyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/rstudio/DT">DT</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rstudio.github.io/bslib/">bslib</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">datasets</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://plotly-r.com">plotly</a></span><span class="op">)</span>  <span class="co"># For interactive hover tooltips</span></span>
<span></span>
<span><span class="co"># Load the data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"ChickWeight"</span>, package <span class="op">=</span> <span class="st">"datasets"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># ==============================================================================</span></span>
<span><span class="co"># UI</span></span>
<span><span class="co"># ==============================================================================</span></span>
<span></span>
<span><span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html">fluidPage</a></span><span class="op">(</span></span>
<span>  theme <span class="op">=</span> <span class="fu"><a href="https://rstudio.github.io/bslib/reference/bs_theme.html">bs_theme</a></span><span class="op">(</span>preset <span class="op">=</span> <span class="st">"minty"</span>, version <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>,</span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/titlePanel.html">titlePanel</a></span><span class="op">(</span><span class="st">"ChickWeight Dataset Explorer"</span><span class="op">)</span>,</span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/sidebarLayout.html">sidebarLayout</a></span><span class="op">(</span></span>
<span>    <span class="co"># --------------------------------------------------------------------------</span></span>
<span>    <span class="co"># SIDEBAR: Global Filters with Tooltips</span></span>
<span>    <span class="co"># --------------------------------------------------------------------------</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/sidebarLayout.html">sidebarPanel</a></span><span class="op">(</span></span>
<span>      width <span class="op">=</span> <span class="fl">3</span>,</span>
<span>      </span>
<span>      <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html">h4</a></span><span class="op">(</span><span class="st">"Filters"</span><span class="op">)</span>,</span>
<span>      </span>
<span>      <span class="co"># Diet filter with tooltip</span></span>
<span>      <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html">div</a></span><span class="op">(</span></span>
<span>        style <span class="op">=</span> <span class="st">"display: flex; align-items: center; gap: 5px;"</span>,</span>
<span>        <span class="va">tags</span><span class="op">$</span><span class="fu">label</span><span class="op">(</span><span class="st">"Diet"</span>, `for` <span class="op">=</span> <span class="st">"diet_filter"</span><span class="op">)</span>,</span>
<span>        <span class="fu">bslib</span><span class="fu">::</span><span class="fu"><a href="https://rstudio.github.io/bslib/reference/tooltip.html">tooltip</a></span><span class="op">(</span></span>
<span>          <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/icon.html">icon</a></span><span class="op">(</span><span class="st">"circle-info"</span><span class="op">)</span>,</span>
<span>          <span class="st">"Diet types 1–4 represent different protein supplements. Select which diets to include in the analysis."</span>,</span>
<span>          placement <span class="op">=</span> <span class="st">"right"</span></span>
<span>        <span class="op">)</span></span>
<span>      <span class="op">)</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/checkboxGroupInput.html">checkboxGroupInput</a></span><span class="op">(</span></span>
<span>        <span class="st">"diet_filter"</span>,</span>
<span>        label <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>        choices <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">4</span>,</span>
<span>        selected <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">4</span>,</span>
<span>        inline <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>      <span class="op">)</span>,</span>
<span>      </span>
<span>      <span class="co"># Time range slider with tooltip</span></span>
<span>      <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html">div</a></span><span class="op">(</span></span>
<span>        style <span class="op">=</span> <span class="st">"display: flex; align-items: center; gap: 5px; margin-top: 15px;"</span>,</span>
<span>        <span class="va">tags</span><span class="op">$</span><span class="fu">label</span><span class="op">(</span><span class="st">"Time Range (days)"</span>, `for` <span class="op">=</span> <span class="st">"time_range"</span><span class="op">)</span>,</span>
<span>        <span class="fu">bslib</span><span class="fu">::</span><span class="fu"><a href="https://rstudio.github.io/bslib/reference/tooltip.html">tooltip</a></span><span class="op">(</span></span>
<span>          <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/icon.html">icon</a></span><span class="op">(</span><span class="st">"circle-info"</span><span class="op">)</span>,</span>
<span>          <span class="st">"Drag to focus on a specific growth interval. All summaries and plots respect this time window."</span>,</span>
<span>          placement <span class="op">=</span> <span class="st">"right"</span></span>
<span>        <span class="op">)</span></span>
<span>      <span class="op">)</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/sliderInput.html">sliderInput</a></span><span class="op">(</span></span>
<span>        <span class="st">"time_range"</span>,</span>
<span>        label <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>        min <span class="op">=</span> <span class="fl">0</span>,</span>
<span>        max <span class="op">=</span> <span class="fl">21</span>,</span>
<span>        value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">21</span><span class="op">)</span>,</span>
<span>        step <span class="op">=</span> <span class="fl">1</span></span>
<span>      <span class="op">)</span>,</span>
<span>      </span>
<span>      <span class="co"># Chick highlight with tooltip</span></span>
<span>      <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html">div</a></span><span class="op">(</span></span>
<span>        style <span class="op">=</span> <span class="st">"display: flex; align-items: center; gap: 5px; margin-top: 15px;"</span>,</span>
<span>        <span class="va">tags</span><span class="op">$</span><span class="fu">label</span><span class="op">(</span><span class="st">"Highlight Chicks"</span>, `for` <span class="op">=</span> <span class="st">"chick_highlight"</span><span class="op">)</span>,</span>
<span>        <span class="fu">bslib</span><span class="fu">::</span><span class="fu"><a href="https://rstudio.github.io/bslib/reference/tooltip.html">tooltip</a></span><span class="op">(</span></span>
<span>          <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/icon.html">icon</a></span><span class="op">(</span><span class="st">"circle-info"</span><span class="op">)</span>,</span>
<span>          <span class="st">"Type to find a Chick ID. Selected chicks are emphasized in plots and highlighted in the table."</span>,</span>
<span>          placement <span class="op">=</span> <span class="st">"right"</span></span>
<span>        <span class="op">)</span></span>
<span>      <span class="op">)</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/selectInput.html">selectizeInput</a></span><span class="op">(</span></span>
<span>        <span class="st">"chick_highlight"</span>,</span>
<span>        label <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>        choices <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">ChickWeight</span><span class="op">$</span><span class="va">Chick</span><span class="op">)</span>,</span>
<span>        selected <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>        multiple <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>        options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>placeholder <span class="op">=</span> <span class="st">"Select chick(s)..."</span><span class="op">)</span></span>
<span>      <span class="op">)</span>,</span>
<span>      </span>
<span>      <span class="co"># Smoothing option with tooltip</span></span>
<span>      <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html">div</a></span><span class="op">(</span></span>
<span>        style <span class="op">=</span> <span class="st">"margin-top: 15px;"</span>,</span>
<span>        <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/checkboxInput.html">checkboxInput</a></span><span class="op">(</span></span>
<span>          <span class="st">"smoothing"</span>,</span>
<span>          label <span class="op">=</span> <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html">div</a></span><span class="op">(</span></span>
<span>            <span class="st">"Add LOESS smoothing"</span>,</span>
<span>            <span class="fu">bslib</span><span class="fu">::</span><span class="fu"><a href="https://rstudio.github.io/bslib/reference/tooltip.html">tooltip</a></span><span class="op">(</span></span>
<span>              <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/icon.html">icon</a></span><span class="op">(</span><span class="st">"circle-info"</span><span class="op">)</span>,</span>
<span>              <span class="st">"Show smoothed average trend by Diet with confidence ribbon. Use with caution for small sample sizes."</span>,</span>
<span>              placement <span class="op">=</span> <span class="st">"right"</span></span>
<span>            <span class="op">)</span></span>
<span>          <span class="op">)</span>,</span>
<span>          value <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>        <span class="op">)</span></span>
<span>      <span class="op">)</span>,</span>
<span>      </span>
<span>      <span class="co"># Scale option with tooltip</span></span>
<span>      <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html">div</a></span><span class="op">(</span></span>
<span>        style <span class="op">=</span> <span class="st">"margin-top: 15px;"</span>,</span>
<span>        <span class="va">tags</span><span class="op">$</span><span class="fu">label</span><span class="op">(</span><span class="st">"Y-axis Scale"</span><span class="op">)</span>,</span>
<span>        <span class="fu">bslib</span><span class="fu">::</span><span class="fu"><a href="https://rstudio.github.io/bslib/reference/tooltip.html">tooltip</a></span><span class="op">(</span></span>
<span>          <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/icon.html">icon</a></span><span class="op">(</span><span class="st">"circle-info"</span><span class="op">)</span>,</span>
<span>          <span class="st">"Log scale can reveal proportional growth patterns and reduce the influence of outliers."</span>,</span>
<span>          placement <span class="op">=</span> <span class="st">"right"</span></span>
<span>        <span class="op">)</span>,</span>
<span>        <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/radioButtons.html">radioButtons</a></span><span class="op">(</span></span>
<span>          <span class="st">"scale"</span>,</span>
<span>          label <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>          choices <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Linear"</span>, <span class="st">"Log10"</span><span class="op">)</span>,</span>
<span>          selected <span class="op">=</span> <span class="st">"Linear"</span></span>
<span>        <span class="op">)</span></span>
<span>      <span class="op">)</span>,</span>
<span>      </span>
<span>      <span class="co"># Reset button</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/actionButton.html">actionButton</a></span><span class="op">(</span></span>
<span>        <span class="st">"reset"</span>,</span>
<span>        <span class="st">"Reset Filters"</span>,</span>
<span>        class <span class="op">=</span> <span class="st">"btn-warning"</span>,</span>
<span>        style <span class="op">=</span> <span class="st">"margin-top: 20px; width: 100%;"</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    </span>
<span>    <span class="co"># --------------------------------------------------------------------------</span></span>
<span>    <span class="co"># MAIN PANEL: Tabset</span></span>
<span>    <span class="co"># --------------------------------------------------------------------------</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/sidebarLayout.html">mainPanel</a></span><span class="op">(</span></span>
<span>      width <span class="op">=</span> <span class="fl">9</span>,</span>
<span>      </span>
<span>      <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/tabsetPanel.html">tabsetPanel</a></span><span class="op">(</span></span>
<span>        id <span class="op">=</span> <span class="st">"tabs"</span>,</span>
<span>        type <span class="op">=</span> <span class="st">"pills"</span>,</span>
<span>        </span>
<span>        <span class="co"># ---- Tab 1: Overview ----</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/tabPanel.html">tabPanel</a></span><span class="op">(</span></span>
<span>          <span class="st">"Overview"</span>,</span>
<span>          <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html">br</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>          <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html">fluidRow</a></span><span class="op">(</span></span>
<span>            <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/column.html">column</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/htmlOutput.html">uiOutput</a></span><span class="op">(</span><span class="st">"summary_chicks"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>            <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/column.html">column</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/htmlOutput.html">uiOutput</a></span><span class="op">(</span><span class="st">"summary_weight"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>            <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/column.html">column</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/htmlOutput.html">uiOutput</a></span><span class="op">(</span><span class="st">"summary_timepoints"</span><span class="op">)</span><span class="op">)</span></span>
<span>          <span class="op">)</span>,</span>
<span>          <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html">hr</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>          <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html">div</a></span><span class="op">(</span></span>
<span>            <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html">h4</a></span><span class="op">(</span></span>
<span>              <span class="st">"About the Dataset"</span>,</span>
<span>              <span class="fu">bslib</span><span class="fu">::</span><span class="fu"><a href="https://rstudio.github.io/bslib/reference/popover.html">popover</a></span><span class="op">(</span></span>
<span>                <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/icon.html">icon</a></span><span class="op">(</span><span class="st">"circle-info"</span><span class="op">)</span>,</span>
<span>                title <span class="op">=</span> <span class="st">"Study Design"</span>,</span>
<span>                <span class="st">"This is a repeated-measures experiment tracking chick growth over time under four different diet regimens. Each chick is measured at regular intervals (days 0, 2, 4, ..., 21)."</span>,</span>
<span>                placement <span class="op">=</span> <span class="st">"right"</span></span>
<span>              <span class="op">)</span></span>
<span>            <span class="op">)</span>,</span>
<span>            <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html">p</a></span><span class="op">(</span><span class="st">"The ChickWeight dataset contains measurements from an experiment on the effect of diet on early growth of chicks. </span></span>
<span><span class="st">              The body weights of chicks were measured at birth and every second day thereafter until day 21. </span></span>
<span><span class="st">              Four different protein diets were tested on different groups of newly hatched chicks."</span><span class="op">)</span>,</span>
<span>            <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html">p</a></span><span class="op">(</span><span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html">strong</a></span><span class="op">(</span><span class="st">"Variables:"</span><span class="op">)</span>, <span class="st">"Weight (grams), Time (days), Chick (ID), Diet (1–4)"</span><span class="op">)</span>,</span>
<span>            <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html">p</a></span><span class="op">(</span><span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html">strong</a></span><span class="op">(</span><span class="st">"Sample size:"</span><span class="op">)</span>, <span class="st">"50 chicks total across 4 diet groups"</span><span class="op">)</span>,</span>
<span>            <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html">p</a></span><span class="op">(</span><span class="st">"Use the sidebar filters to focus on specific diets, time windows, or individual chicks. </span></span>
<span><span class="st">              All visualizations and summaries automatically update based on your selections."</span><span class="op">)</span></span>
<span>          <span class="op">)</span></span>
<span>        <span class="op">)</span>,</span>
<span>        </span>
<span>        <span class="co"># ---- Tab 2: Growth Curves ----</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/tabPanel.html">tabPanel</a></span><span class="op">(</span></span>
<span>          <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html">div</a></span><span class="op">(</span></span>
<span>            <span class="st">"Growth Curves"</span>,</span>
<span>            <span class="fu">bslib</span><span class="fu">::</span><span class="fu"><a href="https://rstudio.github.io/bslib/reference/tooltip.html">tooltip</a></span><span class="op">(</span></span>
<span>              <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/icon.html">icon</a></span><span class="op">(</span><span class="st">"circle-info"</span><span class="op">)</span>,</span>
<span>              <span class="st">"Each line represents one chick's growth trajectory. Hover over lines to see details. Use the smoothing option to view average trends by diet."</span>,</span>
<span>              placement <span class="op">=</span> <span class="st">"top"</span></span>
<span>            <span class="op">)</span></span>
<span>          <span class="op">)</span>,</span>
<span>          <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html">br</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>          <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/htmlOutput.html">uiOutput</a></span><span class="op">(</span><span class="st">"growth_empty_state"</span><span class="op">)</span>,</span>
<span>          <span class="fu"><a href="https://rdrr.io/pkg/plotly/man/plotly-shiny.html">plotlyOutput</a></span><span class="op">(</span><span class="st">"growth_plot"</span>, height <span class="op">=</span> <span class="st">"600px"</span><span class="op">)</span></span>
<span>        <span class="op">)</span>,</span>
<span>        </span>
<span>        <span class="co"># ---- Tab 3: Diet Comparison ----</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/tabPanel.html">tabPanel</a></span><span class="op">(</span></span>
<span>          <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html">div</a></span><span class="op">(</span></span>
<span>            <span class="st">"Diet Comparison"</span>,</span>
<span>            <span class="fu">bslib</span><span class="fu">::</span><span class="fu"><a href="https://rstudio.github.io/bslib/reference/tooltip.html">tooltip</a></span><span class="op">(</span></span>
<span>              <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/icon.html">icon</a></span><span class="op">(</span><span class="st">"circle-info"</span><span class="op">)</span>,</span>
<span>              <span class="st">"Final weight is defined as the maximum weight observed within the selected time window for each chick."</span>,</span>
<span>              placement <span class="op">=</span> <span class="st">"top"</span></span>
<span>            <span class="op">)</span></span>
<span>          <span class="op">)</span>,</span>
<span>          <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html">br</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>          <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/htmlOutput.html">uiOutput</a></span><span class="op">(</span><span class="st">"diet_empty_state"</span><span class="op">)</span>,</span>
<span>          <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html">fluidRow</a></span><span class="op">(</span></span>
<span>            <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/column.html">column</a></span><span class="op">(</span><span class="fl">6</span>, <span class="fu"><a href="https://rdrr.io/pkg/plotly/man/plotly-shiny.html">plotlyOutput</a></span><span class="op">(</span><span class="st">"diet_boxplot"</span>, height <span class="op">=</span> <span class="st">"400px"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>            <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/column.html">column</a></span><span class="op">(</span><span class="fl">6</span>, <span class="fu"><a href="https://rdrr.io/pkg/plotly/man/plotly-shiny.html">plotlyOutput</a></span><span class="op">(</span><span class="st">"diet_barplot"</span>, height <span class="op">=</span> <span class="st">"400px"</span><span class="op">)</span><span class="op">)</span></span>
<span>          <span class="op">)</span></span>
<span>        <span class="op">)</span>,</span>
<span>        </span>
<span>        <span class="co"># ---- Tab 4: Chick Table ----</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/tabPanel.html">tabPanel</a></span><span class="op">(</span></span>
<span>          <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html">div</a></span><span class="op">(</span></span>
<span>            <span class="st">"Chick Table"</span>,</span>
<span>            <span class="fu">bslib</span><span class="fu">::</span><span class="fu"><a href="https://rstudio.github.io/bslib/reference/tooltip.html">tooltip</a></span><span class="op">(</span></span>
<span>              <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/icon.html">icon</a></span><span class="op">(</span><span class="st">"circle-info"</span><span class="op">)</span>,</span>
<span>              <span class="st">"Click column headers to sort. Use the search box to filter rows. Select rows to highlight chicks in the Growth Curves tab."</span>,</span>
<span>              placement <span class="op">=</span> <span class="st">"top"</span></span>
<span>            <span class="op">)</span></span>
<span>          <span class="op">)</span>,</span>
<span>          <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html">br</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>          <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/downloadButton.html">downloadButton</a></span><span class="op">(</span><span class="st">"download_table"</span>, <span class="st">"Download CSV"</span>, class <span class="op">=</span> <span class="st">"btn-primary"</span><span class="op">)</span>,</span>
<span>          <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html">br</a></span><span class="op">(</span><span class="op">)</span>, <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html">br</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>          <span class="fu"><a href="https://rdrr.io/pkg/DT/man/dataTableOutput.html">DTOutput</a></span><span class="op">(</span><span class="st">"chick_table"</span><span class="op">)</span></span>
<span>        <span class="op">)</span>,</span>
<span>        </span>
<span>        <span class="co"># ---- Tab 5: About / Help ----</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/tabPanel.html">tabPanel</a></span><span class="op">(</span></span>
<span>          <span class="st">"About / Help"</span>,</span>
<span>          <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html">br</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>          <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html">h4</a></span><span class="op">(</span><span class="st">"Interpretation Guide"</span><span class="op">)</span>,</span>
<span>          <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html">p</a></span><span class="op">(</span><span class="st">"This app provides multiple perspectives on chick growth patterns:"</span><span class="op">)</span>,</span>
<span>          <span class="va">tags</span><span class="op">$</span><span class="fu">ul</span><span class="op">(</span></span>
<span>            <span class="va">tags</span><span class="op">$</span><span class="fu">li</span><span class="op">(</span><span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html">strong</a></span><span class="op">(</span><span class="st">"Growth Curves:"</span><span class="op">)</span>, <span class="st">"Show individual trajectories. Look for parallel growth patterns, </span></span>
<span><span class="st">                    divergence over time, or individual outliers."</span><span class="op">)</span>,</span>
<span>            <span class="va">tags</span><span class="op">$</span><span class="fu">li</span><span class="op">(</span><span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html">strong</a></span><span class="op">(</span><span class="st">"Diet Comparison:"</span><span class="op">)</span>, <span class="st">"Summarizes final outcomes. Boxplots reveal distribution shape and outliers; </span></span>
<span><span class="st">                    bar charts show average performance."</span><span class="op">)</span>,</span>
<span>            <span class="va">tags</span><span class="op">$</span><span class="fu">li</span><span class="op">(</span><span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html">strong</a></span><span class="op">(</span><span class="st">"Chick Table:"</span><span class="op">)</span>, <span class="st">"Provides quantitative metrics including growth rate (slope) and total weight gain (Δweight)."</span><span class="op">)</span></span>
<span>          <span class="op">)</span>,</span>
<span>          </span>
<span>          <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html">hr</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>          <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html">h4</a></span><span class="op">(</span></span>
<span>            <span class="st">"Caveats"</span>,</span>
<span>            <span class="fu">bslib</span><span class="fu">::</span><span class="fu"><a href="https://rstudio.github.io/bslib/reference/popover.html">popover</a></span><span class="op">(</span></span>
<span>              <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/icon.html">icon</a></span><span class="op">(</span><span class="st">"triangle-exclamation"</span><span class="op">)</span>,</span>
<span>              title <span class="op">=</span> <span class="st">"Important Considerations"</span>,</span>
<span>              <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/HTML.html">HTML</a></span><span class="op">(</span><span class="st">"&lt;ul&gt;</span></span>
<span><span class="st">                &lt;li&gt;Some chicks have missing measurements at later timepoints&lt;/li&gt;</span></span>
<span><span class="st">                &lt;li&gt;Sample sizes vary by diet group&lt;/li&gt;</span></span>
<span><span class="st">                &lt;li&gt;LOESS smoothing can be misleading with small sample sizes&lt;/li&gt;</span></span>
<span><span class="st">                &lt;li&gt;Log scale is only appropriate for positive weights&lt;/li&gt;</span></span>
<span><span class="st">                &lt;/ul&gt;"</span><span class="op">)</span>,</span>
<span>              placement <span class="op">=</span> <span class="st">"right"</span></span>
<span>            <span class="op">)</span></span>
<span>          <span class="op">)</span>,</span>
<span>          <span class="va">tags</span><span class="op">$</span><span class="fu">ul</span><span class="op">(</span></span>
<span>            <span class="va">tags</span><span class="op">$</span><span class="fu">li</span><span class="op">(</span><span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html">strong</a></span><span class="op">(</span><span class="st">"Missing data:"</span><span class="op">)</span>, <span class="st">"Not all chicks were measured at all timepoints. </span></span>
<span><span class="st">                    The 'final weight' is the maximum observed within your selected time window."</span><span class="op">)</span>,</span>
<span>            <span class="va">tags</span><span class="op">$</span><span class="fu">li</span><span class="op">(</span><span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html">strong</a></span><span class="op">(</span><span class="st">"Small samples:"</span><span class="op">)</span>, <span class="st">"Some diet groups have fewer chicks. Be cautious when comparing groups of very different sizes."</span><span class="op">)</span>,</span>
<span>            <span class="va">tags</span><span class="op">$</span><span class="fu">li</span><span class="op">(</span><span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html">strong</a></span><span class="op">(</span><span class="st">"Smoothing caveats:"</span><span class="op">)</span>, <span class="st">"LOESS smoothing assumes smooth, continuous growth. </span></span>
<span><span class="st">                    It may overfit with small samples or hide important individual variation."</span><span class="op">)</span>,</span>
<span>            <span class="va">tags</span><span class="op">$</span><span class="fu">li</span><span class="op">(</span><span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html">strong</a></span><span class="op">(</span><span class="st">"Log scale:"</span><span class="op">)</span>, <span class="st">"Useful for comparing proportional growth rates across different starting weights. </span></span>
<span><span class="st">                    However, it can make small absolute differences appear large."</span><span class="op">)</span></span>
<span>          <span class="op">)</span>,</span>
<span>          </span>
<span>          <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html">hr</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>          <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html">h4</a></span><span class="op">(</span><span class="st">"Tips"</span><span class="op">)</span>,</span>
<span>          <span class="va">tags</span><span class="op">$</span><span class="fu">ul</span><span class="op">(</span></span>
<span>            <span class="va">tags</span><span class="op">$</span><span class="fu">li</span><span class="op">(</span><span class="st">"Start with all diets selected to get the full picture, then narrow down."</span><span class="op">)</span>,</span>
<span>            <span class="va">tags</span><span class="op">$</span><span class="fu">li</span><span class="op">(</span><span class="st">"Use the time slider to focus on specific growth phases (e.g., days 10–21 for late growth)."</span><span class="op">)</span>,</span>
<span>            <span class="va">tags</span><span class="op">$</span><span class="fu">li</span><span class="op">(</span><span class="st">"Highlight specific chicks to track individuals across multiple views."</span><span class="op">)</span>,</span>
<span>            <span class="va">tags</span><span class="op">$</span><span class="fu">li</span><span class="op">(</span><span class="st">"Row selection in the table automatically highlights those chicks in the growth curves plot."</span><span class="op">)</span></span>
<span>          <span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># ==============================================================================</span></span>
<span><span class="co"># SERVER</span></span>
<span><span class="co"># ==============================================================================</span></span>
<span></span>
<span><span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># ----------------------------------------------------------------------------</span></span>
<span>  <span class="co"># Reactive: Filtered Dataset</span></span>
<span>  <span class="co"># ----------------------------------------------------------------------------</span></span>
<span>  <span class="va">filtered_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/reactive.html">reactive</a></span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/req.html">req</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">diet_filter</span>, <span class="va">input</span><span class="op">$</span><span class="va">time_range</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="va">ChickWeight</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span></span>
<span>        <span class="va">Diet</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">input</span><span class="op">$</span><span class="va">diet_filter</span>,</span>
<span>        <span class="va">Time</span> <span class="op">&gt;=</span> <span class="va">input</span><span class="op">$</span><span class="va">time_range</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>        <span class="va">Time</span> <span class="op">&lt;=</span> <span class="va">input</span><span class="op">$</span><span class="va">time_range</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span>      <span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># ----------------------------------------------------------------------------</span></span>
<span>  <span class="co"># Reactive: Highlighted Chicks (from sidebar OR table selection)</span></span>
<span>  <span class="co"># ----------------------------------------------------------------------------</span></span>
<span>  <span class="va">highlighted_chicks</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/reactive.html">reactive</a></span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="co"># Combine sidebar selection and table row selection</span></span>
<span>    <span class="va">sidebar_selected</span> <span class="op">&lt;-</span> <span class="va">input</span><span class="op">$</span><span class="va">chick_highlight</span></span>
<span>    <span class="va">table_selected</span> <span class="op">&lt;-</span> <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">chick_table_rows_selected</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu">summary_table</span><span class="op">(</span><span class="op">)</span><span class="op">[</span><span class="va">input</span><span class="op">$</span><span class="va">chick_table_rows_selected</span>, <span class="op">]</span><span class="op">$</span><span class="va">Chick</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>      <span class="cn">NULL</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">sidebar_selected</span>, <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">table_selected</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># ----------------------------------------------------------------------------</span></span>
<span>  <span class="co"># Reactive: Per-Chick Summary Metrics</span></span>
<span>  <span class="co"># ----------------------------------------------------------------------------</span></span>
<span>  <span class="va">summary_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/reactive.html">reactive</a></span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/req.html">req</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="fu">filtered_data</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="fu">filtered_data</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">Chick</span>, <span class="va">Diet</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span></span>
<span>        n_timepoints <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        first_weight <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">weight</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>        last_weight <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">weight</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>        delta_weight <span class="op">=</span> <span class="va">last_weight</span> <span class="op">-</span> <span class="va">first_weight</span>,</span>
<span>        slope <span class="op">=</span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>          <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">weight</span> <span class="op">~</span> <span class="va">Time</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span>        <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>          <span class="cn">NA_real_</span></span>
<span>        <span class="op">}</span>,</span>
<span>        .groups <span class="op">=</span> <span class="st">"drop"</span></span>
<span>      <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>        slope <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">slope</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>        delta_weight <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">delta_weight</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>        first_weight <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">first_weight</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>        last_weight <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">last_weight</span>, <span class="fl">1</span><span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># ----------------------------------------------------------------------------</span></span>
<span>  <span class="co"># Observer: Reset Filters</span></span>
<span>  <span class="co"># ----------------------------------------------------------------------------</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/observeEvent.html">observeEvent</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">reset</span>, <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/updateCheckboxGroupInput.html">updateCheckboxGroupInput</a></span><span class="op">(</span><span class="va">session</span>, <span class="st">"diet_filter"</span>, selected <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/updateSliderInput.html">updateSliderInput</a></span><span class="op">(</span><span class="va">session</span>, <span class="st">"time_range"</span>, value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">21</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/updateSelectInput.html">updateSelectizeInput</a></span><span class="op">(</span><span class="va">session</span>, <span class="st">"chick_highlight"</span>, selected <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">character</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/updateCheckboxInput.html">updateCheckboxInput</a></span><span class="op">(</span><span class="va">session</span>, <span class="st">"smoothing"</span>, value <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/updateRadioButtons.html">updateRadioButtons</a></span><span class="op">(</span><span class="va">session</span>, <span class="st">"scale"</span>, selected <span class="op">=</span> <span class="st">"Linear"</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># ----------------------------------------------------------------------------</span></span>
<span>  <span class="co"># TAB 1: Overview - Summary Cards</span></span>
<span>  <span class="co"># ----------------------------------------------------------------------------</span></span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">summary_chicks</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/renderUI.html">renderUI</a></span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="va">n_chicks</span> <span class="op">&lt;-</span> <span class="fu">filtered_data</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">Chick</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html">div</a></span><span class="op">(</span></span>
<span>      class <span class="op">=</span> <span class="st">"card text-center"</span>,</span>
<span>      style <span class="op">=</span> <span class="st">"background-color: #e3f2fd; padding: 20px;"</span>,</span>
<span>      <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html">h3</a></span><span class="op">(</span><span class="va">n_chicks</span>, style <span class="op">=</span> <span class="st">"color: #1976d2; margin: 0;"</span><span class="op">)</span>,</span>
<span>      <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html">p</a></span><span class="op">(</span><span class="st">"Visible Chicks"</span>, style <span class="op">=</span> <span class="st">"margin: 5px 0 0 0;"</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">summary_weight</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/renderUI.html">renderUI</a></span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="va">avg_terminal</span> <span class="op">&lt;-</span> <span class="fu">filtered_data</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">Chick</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>terminal <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">weight</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">terminal</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span>na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html">div</a></span><span class="op">(</span></span>
<span>      class <span class="op">=</span> <span class="st">"card text-center"</span>,</span>
<span>      style <span class="op">=</span> <span class="st">"background-color: #f3e5f5; padding: 20px;"</span>,</span>
<span>      <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html">h3</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">avg_terminal</span>, <span class="st">" g"</span><span class="op">)</span>, style <span class="op">=</span> <span class="st">"color: #7b1fa2; margin: 0;"</span><span class="op">)</span>,</span>
<span>      <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html">p</a></span><span class="op">(</span><span class="st">"Avg Terminal Weight"</span>, style <span class="op">=</span> <span class="st">"margin: 5px 0 0 0;"</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">summary_timepoints</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/renderUI.html">renderUI</a></span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="va">n_points</span> <span class="op">&lt;-</span> <span class="fu">filtered_data</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">Time</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html">div</a></span><span class="op">(</span></span>
<span>      class <span class="op">=</span> <span class="st">"card text-center"</span>,</span>
<span>      style <span class="op">=</span> <span class="st">"background-color: #e8f5e9; padding: 20px;"</span>,</span>
<span>      <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html">h3</a></span><span class="op">(</span><span class="va">n_points</span>, style <span class="op">=</span> <span class="st">"color: #388e3c; margin: 0;"</span><span class="op">)</span>,</span>
<span>      <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html">p</a></span><span class="op">(</span><span class="st">"Timepoints in Window"</span>, style <span class="op">=</span> <span class="st">"margin: 5px 0 0 0;"</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># ----------------------------------------------------------------------------</span></span>
<span>  <span class="co"># TAB 2: Growth Curves Plot</span></span>
<span>  <span class="co"># ----------------------------------------------------------------------------</span></span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">growth_empty_state</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/renderUI.html">renderUI</a></span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="fu">filtered_data</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html">div</a></span><span class="op">(</span></span>
<span>        class <span class="op">=</span> <span class="st">"alert alert-warning"</span>,</span>
<span>        <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/icon.html">icon</a></span><span class="op">(</span><span class="st">"triangle-exclamation"</span><span class="op">)</span>,</span>
<span>        <span class="st">" No data available with current filter settings. Try adjusting the filters."</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">growth_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/plotly/man/plotly-shiny.html">renderPlotly</a></span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/req.html">req</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="fu">filtered_data</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co"># Prepare data with highlighting</span></span>
<span>    <span class="va">plot_data</span> <span class="op">&lt;-</span> <span class="fu">filtered_data</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>        highlight <span class="op">=</span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu">highlighted_chicks</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>          <span class="va">Chick</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu">highlighted_chicks</span><span class="op">(</span><span class="op">)</span></span>
<span>        <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>          <span class="cn">FALSE</span></span>
<span>        <span class="op">}</span>,</span>
<span>        alpha_val <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">highlight</span>, <span class="fl">1</span>, <span class="fl">0.4</span><span class="op">)</span>,</span>
<span>        size_val <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">highlight</span>, <span class="fl">1.2</span>, <span class="fl">0.6</span><span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>    </span>
<span>    <span class="co"># Add slope to hover text</span></span>
<span>    <span class="va">slope_data</span> <span class="op">&lt;-</span> <span class="fu">summary_table</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Chick</span>, <span class="va">slope</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="va">plot_data</span> <span class="op">&lt;-</span> <span class="va">plot_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">slope_data</span>, by <span class="op">=</span> <span class="st">"Chick"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>        hover_text <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span></span>
<span>          <span class="st">"Chick: "</span>, <span class="va">Chick</span>, <span class="st">"&lt;br&gt;"</span>,</span>
<span>          <span class="st">"Diet: "</span>, <span class="va">Diet</span>, <span class="st">"&lt;br&gt;"</span>,</span>
<span>          <span class="st">"Time: "</span>, <span class="va">Time</span>, <span class="st">" days&lt;br&gt;"</span>,</span>
<span>          <span class="st">"Weight: "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">weight</span>, <span class="fl">1</span><span class="op">)</span>, <span class="st">" g&lt;br&gt;"</span>,</span>
<span>          <span class="st">"Slope: "</span>, <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">slope</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">slope</span>, <span class="st">" g/day"</span><span class="op">)</span>, <span class="st">"N/A"</span><span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>    </span>
<span>    <span class="co"># Base plot</span></span>
<span>    <span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">plot_data</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Time</span>, y <span class="op">=</span> <span class="va">weight</span>, group <span class="op">=</span> <span class="va">Chick</span>, color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">Diet</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="va">alpha_val</span>, size <span class="op">=</span> <span class="va">size_val</span>, text <span class="op">=</span> <span class="va">hover_text</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_identity.html">scale_alpha_identity</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_identity.html">scale_size_identity</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_color_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Set1"</span>, name <span class="op">=</span> <span class="st">"Diet"</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span></span>
<span>        title <span class="op">=</span> <span class="st">"Chick Growth Trajectories"</span>,</span>
<span>        x <span class="op">=</span> <span class="st">"Time (days)"</span>,</span>
<span>        y <span class="op">=</span> <span class="st">"Weight (grams)"</span></span>
<span>      <span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">14</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"right"</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co"># Add LOESS smoothing if requested</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">smoothing</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">p</span> <span class="op">&lt;-</span> <span class="va">p</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>group <span class="op">=</span> <span class="va">Diet</span>, color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">Diet</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        method <span class="op">=</span> <span class="st">"loess"</span>,</span>
<span>        se <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>        alpha <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span>        linewidth <span class="op">=</span> <span class="fl">1.5</span>,</span>
<span>        inherit.aes <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>        data <span class="op">=</span> <span class="fu">filtered_data</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Diet <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">Diet</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    </span>
<span>    <span class="co"># Apply scale transformation</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">scale</span> <span class="op">==</span> <span class="st">"Log10"</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="co"># Filter out non-positive weights for log scale</span></span>
<span>      <span class="va">plot_data_log</span> <span class="op">&lt;-</span> <span class="va">plot_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">weight</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span></span>
<span>      <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">plot_data_log</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">plot_data</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/showNotification.html">showNotification</a></span><span class="op">(</span><span class="st">"Some weights ≤ 0 were excluded for log scale."</span>, type <span class="op">=</span> <span class="st">"warning"</span><span class="op">)</span></span>
<span>      <span class="op">}</span></span>
<span>      <span class="va">p</span> <span class="op">&lt;-</span> <span class="va">p</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_log10</a></span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    </span>
<span>    <span class="co"># Convert to plotly for interactivity</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/plotly/man/ggplotly.html">ggplotly</a></span><span class="op">(</span><span class="va">p</span>, tooltip <span class="op">=</span> <span class="st">"text"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">layout</span><span class="op">(</span>hovermode <span class="op">=</span> <span class="st">"closest"</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># ----------------------------------------------------------------------------</span></span>
<span>  <span class="co"># TAB 3: Diet Comparison</span></span>
<span>  <span class="co"># ----------------------------------------------------------------------------</span></span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">diet_empty_state</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/renderUI.html">renderUI</a></span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="fu">filtered_data</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html">div</a></span><span class="op">(</span></span>
<span>        class <span class="op">=</span> <span class="st">"alert alert-warning"</span>,</span>
<span>        <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/icon.html">icon</a></span><span class="op">(</span><span class="st">"triangle-exclamation"</span><span class="op">)</span>,</span>
<span>        <span class="st">" No data available with current filter settings. Try adjusting the filters."</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">diet_boxplot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/plotly/man/plotly-shiny.html">renderPlotly</a></span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/req.html">req</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="fu">filtered_data</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co"># Get final weight per chick</span></span>
<span>    <span class="va">final_weights</span> <span class="op">&lt;-</span> <span class="fu">filtered_data</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">Chick</span>, <span class="va">Diet</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>final_weight <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">weight</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">final_weights</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">Diet</span><span class="op">)</span>, y <span class="op">=</span> <span class="va">final_weight</span>, fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">Diet</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_violin.html">geom_violin</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.2</span>, alpha <span class="op">=</span> <span class="fl">0.8</span>, outlier.shape <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_jitter.html">geom_jitter</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.1</span>, alpha <span class="op">=</span> <span class="fl">0.4</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_fill_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Set1"</span>, name <span class="op">=</span> <span class="st">"Diet"</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span></span>
<span>        title <span class="op">=</span> <span class="st">"Final Weight Distribution by Diet"</span>,</span>
<span>        x <span class="op">=</span> <span class="st">"Diet"</span>,</span>
<span>        y <span class="op">=</span> <span class="st">"Final Weight (grams)"</span></span>
<span>      <span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">14</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/plotly/man/ggplotly.html">ggplotly</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">layout</span><span class="op">(</span>hovermode <span class="op">=</span> <span class="st">"closest"</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">diet_barplot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/plotly/man/plotly-shiny.html">renderPlotly</a></span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/req.html">req</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="fu">filtered_data</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co"># Mean delta weight by diet</span></span>
<span>    <span class="va">diet_summary</span> <span class="op">&lt;-</span> <span class="fu">summary_table</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">Diet</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span></span>
<span>        mean_delta <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">delta_weight</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>        .groups <span class="op">=</span> <span class="st">"drop"</span></span>
<span>      <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span><span class="op">(</span><span class="va">mean_delta</span><span class="op">)</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">diet_summary</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html">reorder</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">Diet</span><span class="op">)</span>, <span class="va">mean_delta</span><span class="op">)</span>, y <span class="op">=</span> <span class="va">mean_delta</span>, fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">Diet</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_text</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">mean_delta</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>, vjust <span class="op">=</span> <span class="op">-</span><span class="fl">0.5</span>, size <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_fill_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Set1"</span>, name <span class="op">=</span> <span class="st">"Diet"</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span></span>
<span>        title <span class="op">=</span> <span class="st">"Mean Weight Gain by Diet"</span>,</span>
<span>        x <span class="op">=</span> <span class="st">"Diet (ranked)"</span>,</span>
<span>        y <span class="op">=</span> <span class="st">"Mean Δ Weight (grams)"</span></span>
<span>      <span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">14</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/plotly/man/ggplotly.html">ggplotly</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">layout</span><span class="op">(</span>hovermode <span class="op">=</span> <span class="st">"closest"</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># ----------------------------------------------------------------------------</span></span>
<span>  <span class="co"># TAB 4: Chick Table</span></span>
<span>  <span class="co"># ----------------------------------------------------------------------------</span></span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">chick_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/DT/man/dataTableOutput.html">renderDT</a></span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/req.html">req</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="fu">summary_table</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/DT/man/datatable.html">datatable</a></span><span class="op">(</span></span>
<span>      <span class="fu">summary_table</span><span class="op">(</span><span class="op">)</span>,</span>
<span>      options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>        pageLength <span class="op">=</span> <span class="fl">15</span>,</span>
<span>        searching <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>        ordering <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>        dom <span class="op">=</span> <span class="st">'frtip'</span></span>
<span>      <span class="op">)</span>,</span>
<span>      selection <span class="op">=</span> <span class="st">"multiple"</span>,</span>
<span>      rownames <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>      colnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>        <span class="st">"Chick"</span>, <span class="st">"Diet"</span>, <span class="st">"N Timepoints"</span>, <span class="st">"First Weight (g)"</span>,</span>
<span>        <span class="st">"Last Weight (g)"</span>, <span class="st">"Δ Weight (g)"</span>, <span class="st">"Slope (g/day)"</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://rdrr.io/pkg/DT/man/formatCurrency.html">formatStyle</a></span><span class="op">(</span></span>
<span>        <span class="st">"Chick"</span>,</span>
<span>        target <span class="op">=</span> <span class="st">"row"</span>,</span>
<span>        backgroundColor <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/DT/man/styleInterval.html">styleEqual</a></span><span class="op">(</span></span>
<span>          <span class="fu">highlighted_chicks</span><span class="op">(</span><span class="op">)</span>,</span>
<span>          <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"lightyellow"</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu">highlighted_chicks</span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Download handler for table</span></span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">download_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/downloadHandler.html">downloadHandler</a></span><span class="op">(</span></span>
<span>    filename <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"chick_summary_"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.Date</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">".csv"</span><span class="op">)</span></span>
<span>    <span class="op">}</span>,</span>
<span>    content <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">file</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/utils/write.table.html">write.csv</a></span><span class="op">(</span><span class="fu">summary_table</span><span class="op">(</span><span class="op">)</span>, <span class="va">file</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># ==============================================================================</span></span>
<span><span class="co"># Run the App</span></span>
<span><span class="co"># ==============================================================================</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html">shinyApp</a></span><span class="op">(</span>ui <span class="op">=</span> <span class="va">ui</span>, server <span class="op">=</span> <span class="va">server</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
<section id="screenshots-of-chickweight-app" class="level3" data-number="28.1.1"><h3 data-number="28.1.1" class="anchored" data-anchor-id="screenshots-of-chickweight-app">
<span class="header-section-number">28.1.1</span> Screenshots of ChickWeight App</h3>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-4-contents" aria-controls="callout-4" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
First tab: Overview
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-4" class="callout-4-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="screenshots/cw_0.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-5-contents" aria-controls="callout-5" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Second tab: Growth Curves
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-5" class="callout-5-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="screenshots/cw_1.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-6-contents" aria-controls="callout-6" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Third tab: Diet Comparison Plots
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-6" class="callout-6-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="screenshots/cw_2.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-7-contents" aria-controls="callout-7" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Fourth tab: CSV Download
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-7" class="callout-7-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="screenshots/cw_3.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-8-contents" aria-controls="callout-8" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Fifth tab: About/Help Page
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-8" class="callout-8-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="screenshots/cw_4.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</div>
</div>
</div>
</section></section><section id="integrating-llm-calls-in-an-app" class="level2" data-number="28.2"><h2 data-number="28.2" class="anchored" data-anchor-id="integrating-llm-calls-in-an-app">
<span class="header-section-number">28.2</span> Integrating LLM Calls in an App</h2>
<p>Now let’s pull together a few of the things you learned today and build an app that integrates calling an LLM! This purpose of this simple app is to help educators / test developers generate items given certain parameters - student grade level and school subject.</p>
<p>When developing a prompt for vibe coding, I often ask a model to help me improve my first prompt.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-9-contents" aria-controls="callout-9" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Initial Prompt that I wrote:
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-9" class="callout-9-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Prompt:</p>
<p>I want to make an R Shiny app to facilitate making multiple-choice questions for a variety of grade levels for a variety of subjects.</p>
<p>On the left is a drop-down menu is has two selectable options: grade level (1st, 3rd, 5th, 7th) and topic (geography, science, social studies). This will serve to an input for a function that will call a generative AI model to generate a multiple-choice item based on the selected topic that is appropriate for the selected grade level. The generative AI model will return a question [question], 5 answer options [option A : option E], and the repeat the correct answer option [correct answer : ]. Here is an example:</p>
<p>[Question : What is the main source of energy for the water cycle?]</p>
<p>In the second column: Those responses will each populate in a different text box column that corresponds to the LLM output (question, option A, option B, option C, option D, option E, correct answer) with instructions to the user to “change the item as desired”. The user can then makes changes if they would like, and then re-submit the item. Alternatively, if the user does not want to make changes or is happy with the submitted changes, the user can select “submit item” which will then save the item to a certain location on the computer.</p>
<p>I want the user to ask the app to re-generate parts of an MCQ question. So the user can “save” or “lock” aspects of the LLM response (such as the item stem or some of the responses). I also want the user to be able to provide instructions to the LLM when asking for the item to be re-generated. So if the item is on volcanos and the LLM make an item about their location, the user can say “focus the question on lava” and the LLM will take this information and re-generate the item.</p>
<p>There should be two user input option buttons after finishing the task. “Update item” where the submitted information becomes the pre-populated item info, or “Save Item” when the information is satisfactory and should be saved.</p>
<p>Once the user selects “Save Item” when the item is finished, I would like this information saved to a list in R. So whatever is in the “Question” text box is written to a list entry called question, whatever is in the “Option A” text box is written to a list called optionA, and so on.</p>
<p>Write that syntax.</p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-10-contents" aria-controls="callout-10" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
The prompt to the LLM to improve the prompt
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-10" class="callout-10-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Here’s a prompt to ask an LLM to build an app that I’d like to include as an example for my workshop. Your task is to review the prompt and make improvements to it’s organization, language, and structure so it’s more appropriate to serve as an LLM prompt. Please ask clarifying questions after reviewing the prompt if it will help you in your refinement. The prompt:</p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-11-contents" aria-controls="callout-11" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Final LLM-assisted Prompt
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-11" class="callout-11-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>You are an expert R Shiny developer.</p>
<p>Build a complete, runnable single-file R Shiny app (app.R) that helps users generate, edit, and save multiple-choice questions (MCQs) by grade level and subject.</p>
<p><strong>🎯 Goals</strong></p>
<ul>
<li>Let users select a Grade Level and Subject.</li>
<li>Call a generative AI helper function to produce a question and five answer options (A–E), plus the correct answer.</li>
<li>Display the generated text in editable text boxes so users can make changes.</li>
<li>Provide two buttons:
<ul>
<li>“Update item” – commits edited text to the current item.</li>
<li>“Save item” – appends the finalized item to a persistent list stored in the app’s working directory.</li>
</ul>
</li>
<li>Store all items (including Grade and Subject metadata) in an .rds file named saved_items.rds.</li>
</ul>
<p><strong>⚙️ App Specifications</strong></p>
<p><strong>UI</strong></p>
<p><strong>Left sidebar:</strong></p>
<ul>
<li><code>selectInput("grade", "Grade Level", choices = c("1st", "3rd", "5th", "7th"))</code></li>
<li><code>selectInput("subject", "Subject", choices = c("Geography", "Science", "Social Studies"))</code></li>
<li><code>actionButton("generate", "Generate Item")</code></li>
</ul>
<p><strong>Main panel:</strong></p>
<p>Editable text boxes for:</p>
<ul>
<li>Question</li>
<li>Option A</li>
<li>Option B</li>
<li>Option C</li>
<li>Option D</li>
<li>Option E</li>
<li>Correct Answer</li>
</ul>
<p>(Each labeled clearly with a hint: “Change the item as desired.”)</p>
<p><strong>Action buttons:</strong></p>
<ul>
<li><code>actionButton("update_item", "Update Item")</code></li>
<li><code>actionButton("save_item", "Save Item")</code></li>
</ul>
<p><strong>Display area showing:</strong></p>
<ul>
<li>A message or notification confirming updates/saves</li>
<li>A summary table (<code>renderTable</code>) listing saved items (Grade, Subject, Question stem, Timestamp)</li>
</ul>
<p><strong>Server Logic</strong></p>
<p>Maintain a <code><a href="https://rdrr.io/pkg/shiny/man/reactiveValues.html">reactiveValues()</a></code> object named <code>current_item</code> containing:</p>
<ul>
<li>grade, subject, question, optionA, optionB, optionC, optionD, optionE, correctAnswer, and timestamp.</li>
</ul>
<p><strong>Generate Item</strong></p>
<ul>
<li>Use <code>observeEvent(input$generate, ...)</code> to call a helper function <code>generate_item_via_ai(grade, subject)</code>.</li>
<li>The helper function returns a named list of 7 fields based on the AI output format below.</li>
<li>Populate each text input area with the returned values.</li>
</ul>
<p><strong>AI Output Format</strong></p>
<p>The model should return text formatted exactly as:</p>
<pre><code>Question: &lt;text&gt;
Option A: &lt;text&gt;
Option B: &lt;text&gt;
Option C: &lt;text&gt;
Option D: &lt;text&gt;
Option E: &lt;text&gt;
Correct Answer: Option &lt;A|B|C|D|E&gt;: &lt;repeat the correct option text verbatim&gt;</code></pre>
<p><strong>Example:</strong></p>
<pre><code>Question: What is the main source of energy for the water cycle?
Option A: The Moon
Option B: The Sun
Option C: The Wind
Option D: The Earth's Core
Option E: Ocean Currents
Correct Answer: Option B: The Sun</code></pre>
<p><strong>Helper Function</strong></p>
<p>Implement <code>generate_item_via_ai()</code> with a live model call to an Anthropic model.</p>
<p><strong>Update Item</strong></p>
<ul>
<li>When “Update Item” is clicked, read all text inputs and overwrite the <code>current_item</code> values.</li>
<li>Validate that all fields are filled and that exactly five options (A–E) exist.</li>
</ul>
<p><strong>Save Item</strong></p>
<ul>
<li>Validate fields again before saving.</li>
<li>Append <code>current_item</code> to a reactive list <code>saved_items()</code> (using <code>reactiveVal</code>).</li>
<li>Include metadata fields: Grade, Subject, and Timestamp.</li>
<li>Save the entire list as an .rds file (<code>saveRDS(saved_items(), "saved_items.rds")</code>) in the working directory.</li>
<li>On app startup, if “saved_items.rds” exists, load it with <code><a href="https://rdrr.io/r/base/readRDS.html">readRDS()</a></code>.</li>
</ul>
<p><strong>Feedback</strong></p>
<ul>
<li>Use <code><a href="https://rdrr.io/pkg/shiny/man/showNotification.html">showNotification()</a></code> for user feedback (e.g., “Item saved successfully!” or “Missing correct answer.”).</li>
<li>Display a summary table of all saved items.</li>
</ul>
<p><strong>🧩 Implementation Details</strong></p>
<ul>
<li>Use base shiny and bslib (optional for theming).</li>
<li>Keep code in one self-contained file (app.R).</li>
<li>Comment each section clearly to support learning (especially reactivity).</li>
<li>Enforce exactly five options (A–E) at all times.</li>
<li>Save items to the working directory only—no external path handling.</li>
<li>Maintain minimal accessibility (no additional ARIA labeling for this demo).</li>
</ul>
<p><strong>✅ Deliverable</strong></p>
<p>Output only a fully runnable app.R file in one code block.</p>
<p>The app should work immediately when run with <code><a href="https://rdrr.io/pkg/shiny/man/runApp.html">shiny::runApp()</a></code>.</p>
</div>
</div>
</div>
<section id="working-app-with-llm-integration" class="level3" data-number="28.2.1"><h3 data-number="28.2.1" class="anchored" data-anchor-id="working-app-with-llm-integration">
<span class="header-section-number">28.2.1</span> Working App with LLM Integration</h3>
<p>You can either download the app below, or copy and paste the chunk of code in a new .R file. Then highlight and execute the text. It may take a minute or two the first time the app runs for it to be built, but a new window should open and the app should run. In the background the app is using the ANTHROPIC_API_KEY that was provided to you as part of the workshop. You’ll have to <a href="@sec-api-keys">get your own Anthropic API Key</a> to continue running the app outside of the workshop hours.</p>
<p><a href="downloads/mcq_maker_app.R" download="" style="display: inline-block; padding: 10px 20px; background-color: #4A90E2; color: black; text-decoration: none; border-radius: 5px;"> 📥 Download <code>mcq_maker_app</code> </a></p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-12-contents" aria-controls="callout-12" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
View the App Code Generated by Claude
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-12" class="callout-12-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Given the prompt above, here is what Claude produced:</p>
<div class="cell">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># MCQ Generator Shiny App</span></span>
<span><span class="co"># Single-file app with field locking and AI-powered regeneration</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://shiny.posit.co/">shiny</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rstudio.github.io/bslib/">bslib</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://httr2.r-lib.org">httr2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># ==============================================================================</span></span>
<span><span class="co"># AI HELPER FUNCTIONS</span></span>
<span><span class="co"># ==============================================================================</span></span>
<span></span>
<span><span class="co">#' Generate a complete MCQ item via AI</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @param grade Grade level (e.g., "1st", "3rd", "5th", "7th")</span></span>
<span><span class="co">#' @param subject Subject (e.g., "Geography", "Science", "Social Studies")</span></span>
<span><span class="co">#' @return Named list with: question, optionA, optionB, optionC, optionD, optionE, correctAnswer</span></span>
<span><span class="va">generate_item_via_ai</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">grade</span>, <span class="va">subject</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">api_key</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html">Sys.getenv</a></span><span class="op">(</span><span class="st">"ANTHROPIC_API_KEY"</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">api_key</span> <span class="op">==</span> <span class="st">""</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/stop.html">stop</a></span><span class="op">(</span><span class="st">"ANTHROPIC_API_KEY not found in .Renviron"</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="va">system_prompt</span> <span class="op">&lt;-</span> <span class="st">"You are an expert assessment item writer. Produce age-appropriate MCQs with exactly five options (A-E) and a single correct answer. Follow the output format strictly."</span></span>
<span>  </span>
<span>  <span class="va">user_prompt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span><span class="op">(</span></span>
<span>    <span class="st">"Context: Grade = %s, Subject = %s\n\nGenerate a multiple-choice question suitable for this grade level and subject.\n\nOutput Format (required):\nQuestion: &lt;text&gt;\nOption A: &lt;text&gt;\nOption B: &lt;text&gt;\nOption C: &lt;text&gt;\nOption D: &lt;text&gt;\nOption E: &lt;text&gt;\nCorrect Answer: Option &lt;A|B|C|D|E&gt;: &lt;repeat the correct option text verbatim&gt;\n\nEnsure the correct answer key and text match one of A-E. Keep language at the specified grade level."</span>,</span>
<span>    <span class="va">grade</span>, <span class="va">subject</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">response</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://httr2.r-lib.org/reference/request.html">request</a></span><span class="op">(</span><span class="st">"https://api.anthropic.com/v1/messages"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://httr2.r-lib.org/reference/req_headers.html">req_headers</a></span><span class="op">(</span></span>
<span>      <span class="st">"x-api-key"</span> <span class="op">=</span> <span class="va">api_key</span>,</span>
<span>      <span class="st">"anthropic-version"</span> <span class="op">=</span> <span class="st">"2023-06-01"</span>,</span>
<span>      <span class="st">"content-type"</span> <span class="op">=</span> <span class="st">"application/json"</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://httr2.r-lib.org/reference/req_body.html">req_body_json</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>      model <span class="op">=</span> <span class="st">"claude-sonnet-4-20250514"</span>,</span>
<span>      max_tokens <span class="op">=</span> <span class="fl">1024</span>,</span>
<span>      system <span class="op">=</span> <span class="va">system_prompt</span>,</span>
<span>      messages <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>role <span class="op">=</span> <span class="st">"user"</span>, content <span class="op">=</span> <span class="va">user_prompt</span><span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://httr2.r-lib.org/reference/req_perform.html">req_perform</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://httr2.r-lib.org/reference/resp_body_raw.html">resp_body_json</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">content_text</span> <span class="op">&lt;-</span> <span class="va">response</span><span class="op">$</span><span class="va">content</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">text</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu">parse_ai_output</span><span class="op">(</span><span class="va">content_text</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">#' Re-generate an MCQ item via AI with locked fields</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @param grade Grade level</span></span>
<span><span class="co">#' @param subject Subject</span></span>
<span><span class="co">#' @param instructions Free-text instructions for regeneration</span></span>
<span><span class="co">#' @param locked_values Named list of locked fields (subset of: question, optionA-E, correctAnswer)</span></span>
<span><span class="co">#' @return Named list with all 7 fields (locked fields unchanged)</span></span>
<span><span class="va">regenerate_item_via_ai</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">grade</span>, <span class="va">subject</span>, <span class="va">instructions</span>, <span class="va">locked_values</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">api_key</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html">Sys.getenv</a></span><span class="op">(</span><span class="st">"ANTHROPIC_API_KEY"</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">api_key</span> <span class="op">==</span> <span class="st">""</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/stop.html">stop</a></span><span class="op">(</span><span class="st">"ANTHROPIC_API_KEY not found in .Renviron"</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="va">system_prompt</span> <span class="op">&lt;-</span> <span class="st">"You are an expert assessment item writer. Produce age-appropriate MCQs with exactly five options (A-E) and a single correct answer. Follow the output format strictly."</span></span>
<span>  </span>
<span>  <span class="va">locked_fields_text</span> <span class="op">&lt;-</span> <span class="st">""</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">locked_values</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">locked_fields_text</span> <span class="op">&lt;-</span> <span class="st">"\n\nLocked fields (echo these unchanged):\n"</span></span>
<span>    <span class="kw">for</span> <span class="op">(</span><span class="va">field_name</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">locked_values</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">locked_fields_text</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">locked_fields_text</span>, <span class="va">field_name</span>, <span class="st">": "</span>, <span class="va">locked_values</span><span class="op">[[</span><span class="va">field_name</span><span class="op">]</span><span class="op">]</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="va">instructions_text</span> <span class="op">&lt;-</span> <span class="st">""</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">instructions</span><span class="op">)</span> <span class="op">&amp;&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/nchar.html">nchar</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/trimws.html">trimws</a></span><span class="op">(</span><span class="va">instructions</span><span class="op">)</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">instructions_text</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"\n\nInstructions: "</span>, <span class="va">instructions</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="va">user_prompt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span><span class="op">(</span></span>
<span>    <span class="st">"Context: Grade = %s, Subject = %s%s%s\n\nRe-generate a multiple-choice question. Echo all locked fields unchanged. Generate new content for unlocked fields that is consistent with locked fields, grade, subject, and instructions.\n\nOutput Format (required):\nQuestion: &lt;text&gt;\nOption A: &lt;text&gt;\nOption B: &lt;text&gt;\nOption C: &lt;text&gt;\nOption D: &lt;text&gt;\nOption E: &lt;text&gt;\nCorrect Answer: Option &lt;A|B|C|D|E&gt;: &lt;repeat the correct option text verbatim&gt;\n\nReturn all fields. Ensure the correct answer key and text match one of A-E. Keep language at the specified grade level."</span>,</span>
<span>    <span class="va">grade</span>, <span class="va">subject</span>, <span class="va">locked_fields_text</span>, <span class="va">instructions_text</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">response</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://httr2.r-lib.org/reference/request.html">request</a></span><span class="op">(</span><span class="st">"https://api.anthropic.com/v1/messages"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://httr2.r-lib.org/reference/req_headers.html">req_headers</a></span><span class="op">(</span></span>
<span>      <span class="st">"x-api-key"</span> <span class="op">=</span> <span class="va">api_key</span>,</span>
<span>      <span class="st">"anthropic-version"</span> <span class="op">=</span> <span class="st">"2023-06-01"</span>,</span>
<span>      <span class="st">"content-type"</span> <span class="op">=</span> <span class="st">"application/json"</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://httr2.r-lib.org/reference/req_body.html">req_body_json</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>      model <span class="op">=</span> <span class="st">"claude-sonnet-4-20250514"</span>,</span>
<span>      max_tokens <span class="op">=</span> <span class="fl">1024</span>,</span>
<span>      system <span class="op">=</span> <span class="va">system_prompt</span>,</span>
<span>      messages <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>role <span class="op">=</span> <span class="st">"user"</span>, content <span class="op">=</span> <span class="va">user_prompt</span><span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://httr2.r-lib.org/reference/req_perform.html">req_perform</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://httr2.r-lib.org/reference/resp_body_raw.html">resp_body_json</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">content_text</span> <span class="op">&lt;-</span> <span class="va">response</span><span class="op">$</span><span class="va">content</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">text</span></span>
<span>  <span class="va">parsed</span> <span class="op">&lt;-</span> <span class="fu">parse_ai_output</span><span class="op">(</span><span class="va">content_text</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Validate locked fields</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">field_name</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">locked_values</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/identical.html">identical</a></span><span class="op">(</span><span class="va">parsed</span><span class="op">[[</span><span class="va">field_name</span><span class="op">]</span><span class="op">]</span>, <span class="va">locked_values</span><span class="op">[[</span><span class="va">field_name</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="kw"><a href="https://rdrr.io/r/base/warning.html">warning</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"AI violated lock on field:"</span>, <span class="va">field_name</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="va">parsed</span><span class="op">[[</span><span class="va">field_name</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">locked_values</span><span class="op">[[</span><span class="va">field_name</span><span class="op">]</span><span class="op">]</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">parsed</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">#' Parse AI output text into structured format</span></span>
<span><span class="va">parse_ai_output</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">text</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">lines</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/strsplit.html">strsplit</a></span><span class="op">(</span><span class="va">text</span>, <span class="st">"\n"</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="va">lines</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/trimws.html">trimws</a></span><span class="op">(</span><span class="va">lines</span><span class="op">)</span></span>
<span>  <span class="va">lines</span> <span class="op">&lt;-</span> <span class="va">lines</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/nchar.html">nchar</a></span><span class="op">(</span><span class="va">lines</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">]</span></span>
<span>  </span>
<span>  <span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">line</span> <span class="kw">in</span> <span class="va">lines</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span><span class="op">(</span><span class="st">"^Question:"</span>, <span class="va">line</span>, ignore.case <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">result</span><span class="op">$</span><span class="va">question</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/trimws.html">trimws</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">sub</a></span><span class="op">(</span><span class="st">"^Question:"</span>, <span class="st">""</span>, <span class="va">line</span>, ignore.case <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span><span class="op">(</span><span class="st">"^Option A:"</span>, <span class="va">line</span>, ignore.case <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">result</span><span class="op">$</span><span class="va">optionA</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/trimws.html">trimws</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">sub</a></span><span class="op">(</span><span class="st">"^Option A:"</span>, <span class="st">""</span>, <span class="va">line</span>, ignore.case <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span><span class="op">(</span><span class="st">"^Option B:"</span>, <span class="va">line</span>, ignore.case <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">result</span><span class="op">$</span><span class="va">optionB</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/trimws.html">trimws</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">sub</a></span><span class="op">(</span><span class="st">"^Option B:"</span>, <span class="st">""</span>, <span class="va">line</span>, ignore.case <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span><span class="op">(</span><span class="st">"^Option C:"</span>, <span class="va">line</span>, ignore.case <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">result</span><span class="op">$</span><span class="va">optionC</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/trimws.html">trimws</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">sub</a></span><span class="op">(</span><span class="st">"^Option C:"</span>, <span class="st">""</span>, <span class="va">line</span>, ignore.case <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span><span class="op">(</span><span class="st">"^Option D:"</span>, <span class="va">line</span>, ignore.case <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">result</span><span class="op">$</span><span class="va">optionD</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/trimws.html">trimws</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">sub</a></span><span class="op">(</span><span class="st">"^Option D:"</span>, <span class="st">""</span>, <span class="va">line</span>, ignore.case <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span><span class="op">(</span><span class="st">"^Option E:"</span>, <span class="va">line</span>, ignore.case <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">result</span><span class="op">$</span><span class="va">optionE</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/trimws.html">trimws</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">sub</a></span><span class="op">(</span><span class="st">"^Option E:"</span>, <span class="st">""</span>, <span class="va">line</span>, ignore.case <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span><span class="op">(</span><span class="st">"^Correct Answer:"</span>, <span class="va">line</span>, ignore.case <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">result</span><span class="op">$</span><span class="va">correctAnswer</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/trimws.html">trimws</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">sub</a></span><span class="op">(</span><span class="st">"^Correct Answer:"</span>, <span class="st">""</span>, <span class="va">line</span>, ignore.case <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># ==============================================================================</span></span>
<span><span class="co"># VALIDATION FUNCTIONS</span></span>
<span><span class="co"># ==============================================================================</span></span>
<span></span>
<span><span class="va">validate_item</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">item</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">errors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Check question</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">item</span><span class="op">$</span><span class="va">question</span><span class="op">)</span> <span class="op">||</span> <span class="fu"><a href="https://rdrr.io/r/base/nchar.html">nchar</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/trimws.html">trimws</a></span><span class="op">(</span><span class="va">item</span><span class="op">$</span><span class="va">question</span><span class="op">)</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">errors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">errors</span>, <span class="st">"Question cannot be empty"</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="co"># Check all options</span></span>
<span>  <span class="va">required_options</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"optionA"</span>, <span class="st">"optionB"</span>, <span class="st">"optionC"</span>, <span class="st">"optionD"</span>, <span class="st">"optionE"</span><span class="op">)</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">opt</span> <span class="kw">in</span> <span class="va">required_options</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">item</span><span class="op">[[</span><span class="va">opt</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">||</span> <span class="fu"><a href="https://rdrr.io/r/base/nchar.html">nchar</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/trimws.html">trimws</a></span><span class="op">(</span><span class="va">item</span><span class="op">[[</span><span class="va">opt</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">errors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">errors</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Option"</span>, <span class="fu"><a href="https://rdrr.io/r/base/substr.html">substr</a></span><span class="op">(</span><span class="va">opt</span>, <span class="fl">7</span>, <span class="fl">7</span><span class="op">)</span>, <span class="st">"cannot be empty"</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="co"># Check correct answer format</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">item</span><span class="op">$</span><span class="va">correctAnswer</span><span class="op">)</span> <span class="op">||</span> <span class="fu"><a href="https://rdrr.io/r/base/nchar.html">nchar</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/trimws.html">trimws</a></span><span class="op">(</span><span class="va">item</span><span class="op">$</span><span class="va">correctAnswer</span><span class="op">)</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">errors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">errors</span>, <span class="st">"Correct Answer cannot be empty"</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="co"># Extract key (A-E)</span></span>
<span>    <span class="va">correct_key</span> <span class="op">&lt;-</span> <span class="fu">extract_correct_key</span><span class="op">(</span><span class="va">item</span><span class="op">$</span><span class="va">correctAnswer</span><span class="op">)</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">correct_key</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">errors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">errors</span>, <span class="st">"Correct Answer must start with 'Option A:', 'Option B:', etc."</span><span class="op">)</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>      <span class="co"># Verify the text matches the option</span></span>
<span>      <span class="va">option_field</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"option"</span>, <span class="va">correct_key</span><span class="op">)</span></span>
<span>      <span class="va">expected_text</span> <span class="op">&lt;-</span> <span class="va">item</span><span class="op">[[</span><span class="va">option_field</span><span class="op">]</span><span class="op">]</span></span>
<span>      <span class="va">actual_text</span> <span class="op">&lt;-</span> <span class="fu">extract_correct_text</span><span class="op">(</span><span class="va">item</span><span class="op">$</span><span class="va">correctAnswer</span><span class="op">)</span></span>
<span>      </span>
<span>      <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/identical.html">identical</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/trimws.html">trimws</a></span><span class="op">(</span><span class="va">expected_text</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/trimws.html">trimws</a></span><span class="op">(</span><span class="va">actual_text</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">errors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">errors</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"Correct Answer text must match Option "</span>, <span class="va">correct_key</span>, <span class="st">" exactly"</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="op">}</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">errors</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>valid <span class="op">=</span> <span class="cn">FALSE</span>, errors <span class="op">=</span> <span class="va">errors</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>valid <span class="op">=</span> <span class="cn">TRUE</span>, errors <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">extract_correct_key</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">correct_answer</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">match</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">regexpr</a></span><span class="op">(</span><span class="st">"Option ([A-E]):"</span>, <span class="va">correct_answer</span>, ignore.case <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">match</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">key_text</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/regmatches.html">regmatches</a></span><span class="op">(</span><span class="va">correct_answer</span>, <span class="va">match</span><span class="op">)</span></span>
<span>    <span class="va">key</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">sub</a></span><span class="op">(</span><span class="st">"Option ([A-E]):.*"</span>, <span class="st">"\\1"</span>, <span class="va">key_text</span>, ignore.case <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/chartr.html">toupper</a></span><span class="op">(</span><span class="va">key</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="cn">NA</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">extract_correct_text</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">correct_answer</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">text</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">sub</a></span><span class="op">(</span><span class="st">"^Option [A-E]:\\s*"</span>, <span class="st">""</span>, <span class="va">correct_answer</span>, ignore.case <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/trimws.html">trimws</a></span><span class="op">(</span><span class="va">text</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># ==============================================================================</span></span>
<span><span class="co"># UI</span></span>
<span><span class="co"># ==============================================================================</span></span>
<span></span>
<span><span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rstudio.github.io/bslib/reference/page_sidebar.html">page_sidebar</a></span><span class="op">(</span></span>
<span>  title <span class="op">=</span> <span class="st">"MCQ Generator"</span>,</span>
<span>  theme <span class="op">=</span> <span class="fu"><a href="https://rstudio.github.io/bslib/reference/bs_theme.html">bs_theme</a></span><span class="op">(</span>version <span class="op">=</span> <span class="fl">5</span>, bootswatch <span class="op">=</span> <span class="st">"flatly"</span><span class="op">)</span>,</span>
<span>  </span>
<span>  sidebar <span class="op">=</span> <span class="fu"><a href="https://rstudio.github.io/bslib/reference/sidebar.html">sidebar</a></span><span class="op">(</span></span>
<span>    width <span class="op">=</span> <span class="fl">300</span>,</span>
<span>    <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html">h4</a></span><span class="op">(</span><span class="st">"Configuration"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/selectInput.html">selectInput</a></span><span class="op">(</span></span>
<span>      <span class="st">"grade"</span>,</span>
<span>      <span class="st">"Grade Level"</span>,</span>
<span>      choices <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"1st"</span>, <span class="st">"3rd"</span>, <span class="st">"5th"</span>, <span class="st">"7th"</span><span class="op">)</span>,</span>
<span>      selected <span class="op">=</span> <span class="st">"3rd"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/selectInput.html">selectInput</a></span><span class="op">(</span></span>
<span>      <span class="st">"subject"</span>,</span>
<span>      <span class="st">"Subject"</span>,</span>
<span>      choices <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Geography"</span>, <span class="st">"Science"</span>, <span class="st">"Social Studies"</span><span class="op">)</span>,</span>
<span>      selected <span class="op">=</span> <span class="st">"Science"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/actionButton.html">actionButton</a></span><span class="op">(</span></span>
<span>      <span class="st">"generate"</span>,</span>
<span>      <span class="st">"Generate Item"</span>,</span>
<span>      icon <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/icon.html">icon</a></span><span class="op">(</span><span class="st">"wand-magic-sparkles"</span><span class="op">)</span>,</span>
<span>      class <span class="op">=</span> <span class="st">"btn-primary w-100 mb-3"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html">hr</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html">h4</a></span><span class="op">(</span><span class="st">"Re-generation"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/textAreaInput.html">textAreaInput</a></span><span class="op">(</span></span>
<span>      <span class="st">"regen_instructions"</span>,</span>
<span>      <span class="st">"Re-generation Instructions (optional)"</span>,</span>
<span>      placeholder <span class="op">=</span> <span class="st">"e.g., focus the question on lava; make distractors conceptually distinct"</span>,</span>
<span>      rows <span class="op">=</span> <span class="fl">3</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/actionButton.html">actionButton</a></span><span class="op">(</span></span>
<span>      <span class="st">"regen_unlocked"</span>,</span>
<span>      <span class="st">"Re-generate Unlocked Fields"</span>,</span>
<span>      icon <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/icon.html">icon</a></span><span class="op">(</span><span class="st">"rotate"</span><span class="op">)</span>,</span>
<span>      class <span class="op">=</span> <span class="st">"btn-warning w-100"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/helpText.html">helpText</a></span><span class="op">(</span><span class="st">"Locked fields will remain unchanged. Unlocked fields will be re-generated."</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  </span>
<span>  <span class="co"># Main content</span></span>
<span>  <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html">div</a></span><span class="op">(</span></span>
<span>    class <span class="op">=</span> <span class="st">"container-fluid"</span>,</span>
<span>    <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html">h3</a></span><span class="op">(</span><span class="st">"Edit Item"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/helpText.html">helpText</a></span><span class="op">(</span><span class="st">"Change the item as desired. Lock fields you want to preserve before re-generation."</span><span class="op">)</span>,</span>
<span>    </span>
<span>    <span class="co"># Question</span></span>
<span>    <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html">div</a></span><span class="op">(</span></span>
<span>      class <span class="op">=</span> <span class="st">"row mb-3"</span>,</span>
<span>      <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html">div</a></span><span class="op">(</span></span>
<span>        class <span class="op">=</span> <span class="st">"col-md-10"</span>,</span>
<span>        <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/textAreaInput.html">textAreaInput</a></span><span class="op">(</span></span>
<span>          <span class="st">"question"</span>,</span>
<span>          <span class="st">"Question"</span>,</span>
<span>          value <span class="op">=</span> <span class="st">""</span>,</span>
<span>          rows <span class="op">=</span> <span class="fl">3</span>,</span>
<span>          width <span class="op">=</span> <span class="st">"100%"</span></span>
<span>        <span class="op">)</span></span>
<span>      <span class="op">)</span>,</span>
<span>      <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html">div</a></span><span class="op">(</span></span>
<span>        class <span class="op">=</span> <span class="st">"col-md-2"</span>,</span>
<span>        <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html">br</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/checkboxInput.html">checkboxInput</a></span><span class="op">(</span><span class="st">"lock_question"</span>, <span class="st">"Lock"</span>, <span class="cn">FALSE</span><span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    </span>
<span>    <span class="co"># Options A-E</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">LETTERS</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span>, <span class="kw">function</span><span class="op">(</span><span class="va">letter</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html">div</a></span><span class="op">(</span></span>
<span>        class <span class="op">=</span> <span class="st">"row mb-2"</span>,</span>
<span>        <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html">div</a></span><span class="op">(</span></span>
<span>          class <span class="op">=</span> <span class="st">"col-md-10"</span>,</span>
<span>          <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/textInput.html">textInput</a></span><span class="op">(</span></span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"option"</span>, <span class="va">letter</span><span class="op">)</span>,</span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Option"</span>, <span class="va">letter</span><span class="op">)</span>,</span>
<span>            value <span class="op">=</span> <span class="st">""</span>,</span>
<span>            width <span class="op">=</span> <span class="st">"100%"</span></span>
<span>          <span class="op">)</span></span>
<span>        <span class="op">)</span>,</span>
<span>        <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html">div</a></span><span class="op">(</span></span>
<span>          class <span class="op">=</span> <span class="st">"col-md-2"</span>,</span>
<span>          <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html">br</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>          <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/checkboxInput.html">checkboxInput</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"lock_option"</span>, <span class="va">letter</span><span class="op">)</span>, <span class="st">"Lock"</span>, <span class="cn">FALSE</span><span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">}</span><span class="op">)</span>,</span>
<span>    </span>
<span>    <span class="co"># Correct Answer</span></span>
<span>    <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html">div</a></span><span class="op">(</span></span>
<span>      class <span class="op">=</span> <span class="st">"row mb-3"</span>,</span>
<span>      <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html">div</a></span><span class="op">(</span></span>
<span>        class <span class="op">=</span> <span class="st">"col-md-10"</span>,</span>
<span>        <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/textInput.html">textInput</a></span><span class="op">(</span></span>
<span>          <span class="st">"correctAnswer"</span>,</span>
<span>          <span class="st">"Correct Answer (format: Option X: text)"</span>,</span>
<span>          value <span class="op">=</span> <span class="st">""</span>,</span>
<span>          width <span class="op">=</span> <span class="st">"100%"</span>,</span>
<span>          placeholder <span class="op">=</span> <span class="st">"e.g., Option A: Pacific Ocean"</span></span>
<span>        <span class="op">)</span></span>
<span>      <span class="op">)</span>,</span>
<span>      <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html">div</a></span><span class="op">(</span></span>
<span>        class <span class="op">=</span> <span class="st">"col-md-2"</span>,</span>
<span>        <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html">br</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/checkboxInput.html">checkboxInput</a></span><span class="op">(</span><span class="st">"lock_correctAnswer"</span>, <span class="st">"Lock"</span>, <span class="cn">FALSE</span><span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    </span>
<span>    <span class="co"># Action buttons</span></span>
<span>    <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html">div</a></span><span class="op">(</span></span>
<span>      class <span class="op">=</span> <span class="st">"row mb-4"</span>,</span>
<span>      <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html">div</a></span><span class="op">(</span></span>
<span>        class <span class="op">=</span> <span class="st">"col-md-6"</span>,</span>
<span>        <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/actionButton.html">actionButton</a></span><span class="op">(</span></span>
<span>          <span class="st">"update_item"</span>,</span>
<span>          <span class="st">"Update Item"</span>,</span>
<span>          icon <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/icon.html">icon</a></span><span class="op">(</span><span class="st">"check"</span><span class="op">)</span>,</span>
<span>          class <span class="op">=</span> <span class="st">"btn-success w-100"</span></span>
<span>        <span class="op">)</span></span>
<span>      <span class="op">)</span>,</span>
<span>      <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html">div</a></span><span class="op">(</span></span>
<span>        class <span class="op">=</span> <span class="st">"col-md-6"</span>,</span>
<span>        <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/actionButton.html">actionButton</a></span><span class="op">(</span></span>
<span>          <span class="st">"save_item"</span>,</span>
<span>          <span class="st">"Save Item"</span>,</span>
<span>          icon <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/icon.html">icon</a></span><span class="op">(</span><span class="st">"save"</span><span class="op">)</span>,</span>
<span>          class <span class="op">=</span> <span class="st">"btn-info w-100"</span></span>
<span>        <span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    </span>
<span>    <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html">hr</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    </span>
<span>    <span class="co"># Feedback area</span></span>
<span>    <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html">h3</a></span><span class="op">(</span><span class="st">"Saved Items"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/htmlOutput.html">uiOutput</a></span><span class="op">(</span><span class="st">"feedback_message"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/renderTable.html">tableOutput</a></span><span class="op">(</span><span class="st">"saved_items_table"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># ==============================================================================</span></span>
<span><span class="co"># SERVER</span></span>
<span><span class="co"># ==============================================================================</span></span>
<span></span>
<span><span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># Reactive values for current item</span></span>
<span>  <span class="va">current_item</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/reactiveValues.html">reactiveValues</a></span><span class="op">(</span></span>
<span>    grade <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    subject <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    question <span class="op">=</span> <span class="st">""</span>,</span>
<span>    optionA <span class="op">=</span> <span class="st">""</span>,</span>
<span>    optionB <span class="op">=</span> <span class="st">""</span>,</span>
<span>    optionC <span class="op">=</span> <span class="st">""</span>,</span>
<span>    optionD <span class="op">=</span> <span class="st">""</span>,</span>
<span>    optionE <span class="op">=</span> <span class="st">""</span>,</span>
<span>    correctAnswer <span class="op">=</span> <span class="st">""</span>,</span>
<span>    timestamp <span class="op">=</span> <span class="cn">NULL</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Saved items list</span></span>
<span>  <span class="va">saved_items</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/reactiveVal.html">reactiveVal</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Load saved items on startup</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/observe.html">observe</a></span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/files.html">file.exists</a></span><span class="op">(</span><span class="st">"saved_items.rds"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="kw"><a href="https://rdrr.io/r/base/conditions.html">tryCatch</a></span><span class="op">(</span><span class="op">{</span></span>
<span>        <span class="va">loaded</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="st">"saved_items.rds"</span><span class="op">)</span></span>
<span>        <span class="fu">saved_items</span><span class="op">(</span><span class="va">loaded</span><span class="op">)</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/showNotification.html">showNotification</a></span><span class="op">(</span></span>
<span>          <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Loaded"</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">loaded</span><span class="op">)</span>, <span class="st">"saved items"</span><span class="op">)</span>,</span>
<span>          type <span class="op">=</span> <span class="st">"message"</span></span>
<span>        <span class="op">)</span></span>
<span>      <span class="op">}</span>, error <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">e</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/showNotification.html">showNotification</a></span><span class="op">(</span></span>
<span>          <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Error loading saved items:"</span>, <span class="va">e</span><span class="op">$</span><span class="va">message</span><span class="op">)</span>,</span>
<span>          type <span class="op">=</span> <span class="st">"error"</span></span>
<span>        <span class="op">)</span></span>
<span>      <span class="op">}</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Generate Item</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/observeEvent.html">observeEvent</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">generate</span>, <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/conditions.html">tryCatch</a></span><span class="op">(</span><span class="op">{</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/showNotification.html">showNotification</a></span><span class="op">(</span><span class="st">"Generating item..."</span>, type <span class="op">=</span> <span class="st">"message"</span>, duration <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span>      </span>
<span>      <span class="va">item</span> <span class="op">&lt;-</span> <span class="fu">generate_item_via_ai</span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">grade</span>, <span class="va">input</span><span class="op">$</span><span class="va">subject</span><span class="op">)</span></span>
<span>      </span>
<span>      <span class="co"># Update UI fields</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/updateTextAreaInput.html">updateTextAreaInput</a></span><span class="op">(</span><span class="va">session</span>, <span class="st">"question"</span>, value <span class="op">=</span> <span class="va">item</span><span class="op">$</span><span class="va">question</span><span class="op">)</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/updateTextInput.html">updateTextInput</a></span><span class="op">(</span><span class="va">session</span>, <span class="st">"optionA"</span>, value <span class="op">=</span> <span class="va">item</span><span class="op">$</span><span class="va">optionA</span><span class="op">)</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/updateTextInput.html">updateTextInput</a></span><span class="op">(</span><span class="va">session</span>, <span class="st">"optionB"</span>, value <span class="op">=</span> <span class="va">item</span><span class="op">$</span><span class="va">optionB</span><span class="op">)</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/updateTextInput.html">updateTextInput</a></span><span class="op">(</span><span class="va">session</span>, <span class="st">"optionC"</span>, value <span class="op">=</span> <span class="va">item</span><span class="op">$</span><span class="va">optionC</span><span class="op">)</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/updateTextInput.html">updateTextInput</a></span><span class="op">(</span><span class="va">session</span>, <span class="st">"optionD"</span>, value <span class="op">=</span> <span class="va">item</span><span class="op">$</span><span class="va">optionD</span><span class="op">)</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/updateTextInput.html">updateTextInput</a></span><span class="op">(</span><span class="va">session</span>, <span class="st">"optionE"</span>, value <span class="op">=</span> <span class="va">item</span><span class="op">$</span><span class="va">optionE</span><span class="op">)</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/updateTextInput.html">updateTextInput</a></span><span class="op">(</span><span class="va">session</span>, <span class="st">"correctAnswer"</span>, value <span class="op">=</span> <span class="va">item</span><span class="op">$</span><span class="va">correctAnswer</span><span class="op">)</span></span>
<span>      </span>
<span>      <span class="co"># Update current_item</span></span>
<span>      <span class="va">current_item</span><span class="op">$</span><span class="va">grade</span> <span class="op">&lt;-</span> <span class="va">input</span><span class="op">$</span><span class="va">grade</span></span>
<span>      <span class="va">current_item</span><span class="op">$</span><span class="va">subject</span> <span class="op">&lt;-</span> <span class="va">input</span><span class="op">$</span><span class="va">subject</span></span>
<span>      <span class="va">current_item</span><span class="op">$</span><span class="va">question</span> <span class="op">&lt;-</span> <span class="va">item</span><span class="op">$</span><span class="va">question</span></span>
<span>      <span class="va">current_item</span><span class="op">$</span><span class="va">optionA</span> <span class="op">&lt;-</span> <span class="va">item</span><span class="op">$</span><span class="va">optionA</span></span>
<span>      <span class="va">current_item</span><span class="op">$</span><span class="va">optionB</span> <span class="op">&lt;-</span> <span class="va">item</span><span class="op">$</span><span class="va">optionB</span></span>
<span>      <span class="va">current_item</span><span class="op">$</span><span class="va">optionC</span> <span class="op">&lt;-</span> <span class="va">item</span><span class="op">$</span><span class="va">optionC</span></span>
<span>      <span class="va">current_item</span><span class="op">$</span><span class="va">optionD</span> <span class="op">&lt;-</span> <span class="va">item</span><span class="op">$</span><span class="va">optionD</span></span>
<span>      <span class="va">current_item</span><span class="op">$</span><span class="va">optionE</span> <span class="op">&lt;-</span> <span class="va">item</span><span class="op">$</span><span class="va">optionE</span></span>
<span>      <span class="va">current_item</span><span class="op">$</span><span class="va">correctAnswer</span> <span class="op">&lt;-</span> <span class="va">item</span><span class="op">$</span><span class="va">correctAnswer</span></span>
<span>      <span class="va">current_item</span><span class="op">$</span><span class="va">timestamp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span>      </span>
<span>      <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/showNotification.html">showNotification</a></span><span class="op">(</span><span class="st">"Item generated successfully!"</span>, type <span class="op">=</span> <span class="st">"message"</span><span class="op">)</span></span>
<span>    <span class="op">}</span>, error <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">e</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/showNotification.html">showNotification</a></span><span class="op">(</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Error generating item:"</span>, <span class="va">e</span><span class="op">$</span><span class="va">message</span><span class="op">)</span>,</span>
<span>        type <span class="op">=</span> <span class="st">"error"</span>,</span>
<span>        duration <span class="op">=</span> <span class="fl">5</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">}</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Re-generate Unlocked Fields</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/observeEvent.html">observeEvent</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">regen_unlocked</span>, <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/conditions.html">tryCatch</a></span><span class="op">(</span><span class="op">{</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/showNotification.html">showNotification</a></span><span class="op">(</span><span class="st">"Re-generating unlocked fields..."</span>, type <span class="op">=</span> <span class="st">"message"</span>, duration <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span>      </span>
<span>      <span class="co"># Build locked_values from checkbox states</span></span>
<span>      <span class="va">locked_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span>      </span>
<span>      <span class="kw">if</span> <span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">lock_question</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">locked_values</span><span class="op">$</span><span class="va">question</span> <span class="op">&lt;-</span> <span class="va">input</span><span class="op">$</span><span class="va">question</span></span>
<span>      <span class="op">}</span></span>
<span>      <span class="kw">if</span> <span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">lock_optionA</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">locked_values</span><span class="op">$</span><span class="va">optionA</span> <span class="op">&lt;-</span> <span class="va">input</span><span class="op">$</span><span class="va">optionA</span></span>
<span>      <span class="op">}</span></span>
<span>      <span class="kw">if</span> <span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">lock_optionB</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">locked_values</span><span class="op">$</span><span class="va">optionB</span> <span class="op">&lt;-</span> <span class="va">input</span><span class="op">$</span><span class="va">optionB</span></span>
<span>      <span class="op">}</span></span>
<span>      <span class="kw">if</span> <span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">lock_optionC</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">locked_values</span><span class="op">$</span><span class="va">optionC</span> <span class="op">&lt;-</span> <span class="va">input</span><span class="op">$</span><span class="va">optionC</span></span>
<span>      <span class="op">}</span></span>
<span>      <span class="kw">if</span> <span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">lock_optionD</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">locked_values</span><span class="op">$</span><span class="va">optionD</span> <span class="op">&lt;-</span> <span class="va">input</span><span class="op">$</span><span class="va">optionD</span></span>
<span>      <span class="op">}</span></span>
<span>      <span class="kw">if</span> <span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">lock_optionE</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">locked_values</span><span class="op">$</span><span class="va">optionE</span> <span class="op">&lt;-</span> <span class="va">input</span><span class="op">$</span><span class="va">optionE</span></span>
<span>      <span class="op">}</span></span>
<span>      <span class="kw">if</span> <span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">lock_correctAnswer</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">locked_values</span><span class="op">$</span><span class="va">correctAnswer</span> <span class="op">&lt;-</span> <span class="va">input</span><span class="op">$</span><span class="va">correctAnswer</span></span>
<span>      <span class="op">}</span></span>
<span>      </span>
<span>      <span class="co"># Call regeneration</span></span>
<span>      <span class="va">item</span> <span class="op">&lt;-</span> <span class="fu">regenerate_item_via_ai</span><span class="op">(</span></span>
<span>        <span class="va">input</span><span class="op">$</span><span class="va">grade</span>,</span>
<span>        <span class="va">input</span><span class="op">$</span><span class="va">subject</span>,</span>
<span>        <span class="va">input</span><span class="op">$</span><span class="va">regen_instructions</span>,</span>
<span>        <span class="va">locked_values</span></span>
<span>      <span class="op">)</span></span>
<span>      </span>
<span>      <span class="co"># Validate that locked fields were respected</span></span>
<span>      <span class="va">violated_locks</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">)</span></span>
<span>      <span class="kw">for</span> <span class="op">(</span><span class="va">field</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">locked_values</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/identical.html">identical</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/trimws.html">trimws</a></span><span class="op">(</span><span class="va">item</span><span class="op">[[</span><span class="va">field</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/trimws.html">trimws</a></span><span class="op">(</span><span class="va">locked_values</span><span class="op">[[</span><span class="va">field</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>          <span class="va">violated_locks</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">violated_locks</span>, <span class="va">field</span><span class="op">)</span></span>
<span>          <span class="co"># Restore locked value</span></span>
<span>          <span class="va">item</span><span class="op">[[</span><span class="va">field</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">locked_values</span><span class="op">[[</span><span class="va">field</span><span class="op">]</span><span class="op">]</span></span>
<span>        <span class="op">}</span></span>
<span>      <span class="op">}</span></span>
<span>      </span>
<span>      <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">violated_locks</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/showNotification.html">showNotification</a></span><span class="op">(</span></span>
<span>          <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Warning: AI violated locks on:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">violated_locks</span>, collapse <span class="op">=</span> <span class="st">", "</span><span class="op">)</span>, <span class="st">". Values restored."</span><span class="op">)</span>,</span>
<span>          type <span class="op">=</span> <span class="st">"warning"</span>,</span>
<span>          duration <span class="op">=</span> <span class="fl">5</span></span>
<span>        <span class="op">)</span></span>
<span>      <span class="op">}</span></span>
<span>      </span>
<span>      <span class="co"># Update UI fields</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/updateTextAreaInput.html">updateTextAreaInput</a></span><span class="op">(</span><span class="va">session</span>, <span class="st">"question"</span>, value <span class="op">=</span> <span class="va">item</span><span class="op">$</span><span class="va">question</span><span class="op">)</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/updateTextInput.html">updateTextInput</a></span><span class="op">(</span><span class="va">session</span>, <span class="st">"optionA"</span>, value <span class="op">=</span> <span class="va">item</span><span class="op">$</span><span class="va">optionA</span><span class="op">)</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/updateTextInput.html">updateTextInput</a></span><span class="op">(</span><span class="va">session</span>, <span class="st">"optionB"</span>, value <span class="op">=</span> <span class="va">item</span><span class="op">$</span><span class="va">optionB</span><span class="op">)</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/updateTextInput.html">updateTextInput</a></span><span class="op">(</span><span class="va">session</span>, <span class="st">"optionC"</span>, value <span class="op">=</span> <span class="va">item</span><span class="op">$</span><span class="va">optionC</span><span class="op">)</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/updateTextInput.html">updateTextInput</a></span><span class="op">(</span><span class="va">session</span>, <span class="st">"optionD"</span>, value <span class="op">=</span> <span class="va">item</span><span class="op">$</span><span class="va">optionD</span><span class="op">)</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/updateTextInput.html">updateTextInput</a></span><span class="op">(</span><span class="va">session</span>, <span class="st">"optionE"</span>, value <span class="op">=</span> <span class="va">item</span><span class="op">$</span><span class="va">optionE</span><span class="op">)</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/updateTextInput.html">updateTextInput</a></span><span class="op">(</span><span class="va">session</span>, <span class="st">"correctAnswer"</span>, value <span class="op">=</span> <span class="va">item</span><span class="op">$</span><span class="va">correctAnswer</span><span class="op">)</span></span>
<span>      </span>
<span>      <span class="co"># Update current_item</span></span>
<span>      <span class="va">current_item</span><span class="op">$</span><span class="va">grade</span> <span class="op">&lt;-</span> <span class="va">input</span><span class="op">$</span><span class="va">grade</span></span>
<span>      <span class="va">current_item</span><span class="op">$</span><span class="va">subject</span> <span class="op">&lt;-</span> <span class="va">input</span><span class="op">$</span><span class="va">subject</span></span>
<span>      <span class="va">current_item</span><span class="op">$</span><span class="va">question</span> <span class="op">&lt;-</span> <span class="va">item</span><span class="op">$</span><span class="va">question</span></span>
<span>      <span class="va">current_item</span><span class="op">$</span><span class="va">optionA</span> <span class="op">&lt;-</span> <span class="va">item</span><span class="op">$</span><span class="va">optionA</span></span>
<span>      <span class="va">current_item</span><span class="op">$</span><span class="va">optionB</span> <span class="op">&lt;-</span> <span class="va">item</span><span class="op">$</span><span class="va">optionB</span></span>
<span>      <span class="va">current_item</span><span class="op">$</span><span class="va">optionC</span> <span class="op">&lt;-</span> <span class="va">item</span><span class="op">$</span><span class="va">optionC</span></span>
<span>      <span class="va">current_item</span><span class="op">$</span><span class="va">optionD</span> <span class="op">&lt;-</span> <span class="va">item</span><span class="op">$</span><span class="va">optionD</span></span>
<span>      <span class="va">current_item</span><span class="op">$</span><span class="va">optionE</span> <span class="op">&lt;-</span> <span class="va">item</span><span class="op">$</span><span class="va">optionE</span></span>
<span>      <span class="va">current_item</span><span class="op">$</span><span class="va">correctAnswer</span> <span class="op">&lt;-</span> <span class="va">item</span><span class="op">$</span><span class="va">correctAnswer</span></span>
<span>      <span class="va">current_item</span><span class="op">$</span><span class="va">timestamp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span>      </span>
<span>      <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/showNotification.html">showNotification</a></span><span class="op">(</span><span class="st">"Item re-generated successfully!"</span>, type <span class="op">=</span> <span class="st">"message"</span><span class="op">)</span></span>
<span>    <span class="op">}</span>, error <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">e</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/showNotification.html">showNotification</a></span><span class="op">(</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Error re-generating item:"</span>, <span class="va">e</span><span class="op">$</span><span class="va">message</span><span class="op">)</span>,</span>
<span>        type <span class="op">=</span> <span class="st">"error"</span>,</span>
<span>        duration <span class="op">=</span> <span class="fl">5</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">}</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Update Item</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/observeEvent.html">observeEvent</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">update_item</span>, <span class="op">{</span></span>
<span>    <span class="va">item</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>      question <span class="op">=</span> <span class="va">input</span><span class="op">$</span><span class="va">question</span>,</span>
<span>      optionA <span class="op">=</span> <span class="va">input</span><span class="op">$</span><span class="va">optionA</span>,</span>
<span>      optionB <span class="op">=</span> <span class="va">input</span><span class="op">$</span><span class="va">optionB</span>,</span>
<span>      optionC <span class="op">=</span> <span class="va">input</span><span class="op">$</span><span class="va">optionC</span>,</span>
<span>      optionD <span class="op">=</span> <span class="va">input</span><span class="op">$</span><span class="va">optionD</span>,</span>
<span>      optionE <span class="op">=</span> <span class="va">input</span><span class="op">$</span><span class="va">optionE</span>,</span>
<span>      correctAnswer <span class="op">=</span> <span class="va">input</span><span class="op">$</span><span class="va">correctAnswer</span></span>
<span>    <span class="op">)</span></span>
<span>    </span>
<span>    <span class="va">validation</span> <span class="op">&lt;-</span> <span class="fu">validate_item</span><span class="op">(</span><span class="va">item</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="va">validation</span><span class="op">$</span><span class="va">valid</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/showNotification.html">showNotification</a></span><span class="op">(</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Validation errors:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">validation</span><span class="op">$</span><span class="va">errors</span>, collapse <span class="op">=</span> <span class="st">"; "</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        type <span class="op">=</span> <span class="st">"error"</span>,</span>
<span>        duration <span class="op">=</span> <span class="fl">5</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>      <span class="va">current_item</span><span class="op">$</span><span class="va">grade</span> <span class="op">&lt;-</span> <span class="va">input</span><span class="op">$</span><span class="va">grade</span></span>
<span>      <span class="va">current_item</span><span class="op">$</span><span class="va">subject</span> <span class="op">&lt;-</span> <span class="va">input</span><span class="op">$</span><span class="va">subject</span></span>
<span>      <span class="va">current_item</span><span class="op">$</span><span class="va">question</span> <span class="op">&lt;-</span> <span class="va">item</span><span class="op">$</span><span class="va">question</span></span>
<span>      <span class="va">current_item</span><span class="op">$</span><span class="va">optionA</span> <span class="op">&lt;-</span> <span class="va">item</span><span class="op">$</span><span class="va">optionA</span></span>
<span>      <span class="va">current_item</span><span class="op">$</span><span class="va">optionB</span> <span class="op">&lt;-</span> <span class="va">item</span><span class="op">$</span><span class="va">optionB</span></span>
<span>      <span class="va">current_item</span><span class="op">$</span><span class="va">optionC</span> <span class="op">&lt;-</span> <span class="va">item</span><span class="op">$</span><span class="va">optionC</span></span>
<span>      <span class="va">current_item</span><span class="op">$</span><span class="va">optionD</span> <span class="op">&lt;-</span> <span class="va">item</span><span class="op">$</span><span class="va">optionD</span></span>
<span>      <span class="va">current_item</span><span class="op">$</span><span class="va">optionE</span> <span class="op">&lt;-</span> <span class="va">item</span><span class="op">$</span><span class="va">optionE</span></span>
<span>      <span class="va">current_item</span><span class="op">$</span><span class="va">correctAnswer</span> <span class="op">&lt;-</span> <span class="va">item</span><span class="op">$</span><span class="va">correctAnswer</span></span>
<span>      <span class="va">current_item</span><span class="op">$</span><span class="va">timestamp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span>      </span>
<span>      <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/showNotification.html">showNotification</a></span><span class="op">(</span><span class="st">"Item updated successfully!"</span>, type <span class="op">=</span> <span class="st">"message"</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Save Item</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/observeEvent.html">observeEvent</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">save_item</span>, <span class="op">{</span></span>
<span>    <span class="va">item</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>      grade <span class="op">=</span> <span class="va">input</span><span class="op">$</span><span class="va">grade</span>,</span>
<span>      subject <span class="op">=</span> <span class="va">input</span><span class="op">$</span><span class="va">subject</span>,</span>
<span>      question <span class="op">=</span> <span class="va">input</span><span class="op">$</span><span class="va">question</span>,</span>
<span>      optionA <span class="op">=</span> <span class="va">input</span><span class="op">$</span><span class="va">optionA</span>,</span>
<span>      optionB <span class="op">=</span> <span class="va">input</span><span class="op">$</span><span class="va">optionB</span>,</span>
<span>      optionC <span class="op">=</span> <span class="va">input</span><span class="op">$</span><span class="va">optionC</span>,</span>
<span>      optionD <span class="op">=</span> <span class="va">input</span><span class="op">$</span><span class="va">optionD</span>,</span>
<span>      optionE <span class="op">=</span> <span class="va">input</span><span class="op">$</span><span class="va">optionE</span>,</span>
<span>      correctAnswer <span class="op">=</span> <span class="va">input</span><span class="op">$</span><span class="va">correctAnswer</span></span>
<span>    <span class="op">)</span></span>
<span>    </span>
<span>    <span class="va">validation</span> <span class="op">&lt;-</span> <span class="fu">validate_item</span><span class="op">(</span><span class="va">item</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="va">validation</span><span class="op">$</span><span class="va">valid</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/showNotification.html">showNotification</a></span><span class="op">(</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Cannot save. Validation errors:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">validation</span><span class="op">$</span><span class="va">errors</span>, collapse <span class="op">=</span> <span class="st">"; "</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        type <span class="op">=</span> <span class="st">"error"</span>,</span>
<span>        duration <span class="op">=</span> <span class="fl">5</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>      <span class="co"># Add timestamp</span></span>
<span>      <span class="va">item</span><span class="op">$</span><span class="va">timestamp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span>      </span>
<span>      <span class="co"># Append to saved items</span></span>
<span>      <span class="va">current_saved</span> <span class="op">&lt;-</span> <span class="fu">saved_items</span><span class="op">(</span><span class="op">)</span></span>
<span>      <span class="va">current_saved</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">current_saved</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">item</span></span>
<span>      <span class="fu">saved_items</span><span class="op">(</span><span class="va">current_saved</span><span class="op">)</span></span>
<span>      </span>
<span>      <span class="co"># Save to file</span></span>
<span>      <span class="kw"><a href="https://rdrr.io/r/base/conditions.html">tryCatch</a></span><span class="op">(</span><span class="op">{</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span><span class="op">(</span><span class="va">current_saved</span>, <span class="st">"saved_items.rds"</span><span class="op">)</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/showNotification.html">showNotification</a></span><span class="op">(</span></span>
<span>          <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Item saved successfully! Total items:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">current_saved</span><span class="op">)</span><span class="op">)</span>,</span>
<span>          type <span class="op">=</span> <span class="st">"message"</span>,</span>
<span>          duration <span class="op">=</span> <span class="fl">3</span></span>
<span>        <span class="op">)</span></span>
<span>      <span class="op">}</span>, error <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">e</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/showNotification.html">showNotification</a></span><span class="op">(</span></span>
<span>          <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Error saving to file:"</span>, <span class="va">e</span><span class="op">$</span><span class="va">message</span><span class="op">)</span>,</span>
<span>          type <span class="op">=</span> <span class="st">"error"</span>,</span>
<span>          duration <span class="op">=</span> <span class="fl">5</span></span>
<span>        <span class="op">)</span></span>
<span>      <span class="op">}</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Render saved items table</span></span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">saved_items_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/renderTable.html">renderTable</a></span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="va">items</span> <span class="op">&lt;-</span> <span class="fu">saved_items</span><span class="op">(</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">items</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>        Message <span class="op">=</span> <span class="st">"No items saved yet"</span></span>
<span>      <span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    </span>
<span>    <span class="co"># Create summary table</span></span>
<span>    <span class="va">summary_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span><span class="op">(</span><span class="va">items</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">item</span> <span class="op">&lt;-</span> <span class="va">items</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>        Index <span class="op">=</span> <span class="va">i</span>,</span>
<span>        Grade <span class="op">=</span> <span class="va">item</span><span class="op">$</span><span class="va">grade</span>,</span>
<span>        Subject <span class="op">=</span> <span class="va">item</span><span class="op">$</span><span class="va">subject</span>,</span>
<span>        Question <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/substr.html">substr</a></span><span class="op">(</span><span class="va">item</span><span class="op">$</span><span class="va">question</span>, <span class="fl">1</span>, <span class="fl">60</span><span class="op">)</span>,</span>
<span>        Timestamp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">item</span><span class="op">$</span><span class="va">timestamp</span><span class="op">)</span>,</span>
<span>        stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">}</span><span class="op">)</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="va">summary_df</span></span>
<span>  <span class="op">}</span>, striped <span class="op">=</span> <span class="cn">TRUE</span>, hover <span class="op">=</span> <span class="cn">TRUE</span>, bordered <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Feedback message</span></span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">feedback_message</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/renderUI.html">renderUI</a></span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="va">items</span> <span class="op">&lt;-</span> <span class="fu">saved_items</span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">items</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html">div</a></span><span class="op">(</span></span>
<span>        class <span class="op">=</span> <span class="st">"alert alert-info"</span>,</span>
<span>        <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/icon.html">icon</a></span><span class="op">(</span><span class="st">"circle-info"</span><span class="op">)</span>,</span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Total saved items:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">items</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># ==============================================================================</span></span>
<span><span class="co"># RUN APP</span></span>
<span><span class="co"># ==============================================================================</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html">shinyApp</a></span><span class="op">(</span>ui <span class="op">=</span> <span class="va">ui</span>, server <span class="op">=</span> <span class="va">server</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section><section id="screenshots-of-the-app-with-llm-integration" class="level3" data-number="28.2.2"><h3 data-number="28.2.2" class="anchored" data-anchor-id="screenshots-of-the-app-with-llm-integration">
<span class="header-section-number">28.2.2</span> Screenshots of the App with LLM Integration</h3>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-13-contents" aria-controls="callout-13" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Initial App State
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-13" class="callout-13-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="screenshots/mcq_maker_0.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-14-contents" aria-controls="callout-14" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
After LLM Item Generation
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-14" class="callout-14-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="screenshots/mcq_maker_1.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-15-contents" aria-controls="callout-15" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Partial Item Re-generation
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-15" class="callout-15-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="screenshots/mcq_maker_2.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-16-contents" aria-controls="callout-16" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Re-generated Item
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-16" class="callout-16-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="screenshots/mcq_maker_3.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-17-contents" aria-controls="callout-17" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Direct Item Editing
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-17" class="callout-17-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="screenshots/mcq_maker_4.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</div>
</div>
</div>
</section></section><section id="build-your-own-app" class="level2" data-number="28.3"><h2 data-number="28.3" class="anchored" data-anchor-id="build-your-own-app">
<span class="header-section-number">28.3</span> Build your own app!</h2>
<p>Now it’s time for <em>you</em> to build a Shiny app!</p>


<!-- -->

</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
            // target, if specified
            link.setAttribute("target", "_blank");
            if (link.getAttribute("rel") === null) {
              link.setAttribute("rel", "noopener");
            }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./27-shiny-integration.html" class="pagination-link" aria-label="Vibe Coding R Shiny Apps">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">Vibe Coding R Shiny Apps</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./29-saving-shiny-data.html" class="pagination-link" aria-label="Saving R Shiny Data">
        <span class="nav-page-text"><span class="chapter-number">29</span>&nbsp; <span class="chapter-title">Saving R Shiny Data</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb5" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu"># Activity: Shiny App Development {#sec-act-shiny}</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>Now it's time to make an app! </span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>When building an app via vibe coding, I've found that it's best to ask the model to add features to the app in chunks.</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>Providing a long list of "must-haves" to the model in a single prompt can overwhelm the model, and it can be difficult to make tweaks to small parts of the app.</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>For my process, I usually outline the basic functionality of what I want the app to do in the first prompt, knowing that there will be additional functionality that I want to build out later. </span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>I will sometimes write out a list of the functionality that I want to be integrated into the app.</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>I then review the list and see if there is a logical structure to order that I want the components built - do any features depend on having other functionality in place.</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>From there I then start the process of iterating with the model to develop the code that I want.</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>**Note: Working with a model to vibe code can use a lot of tokens quickly.** </span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>I have the lowest-tier plans with both Anthropic and ChatGPT, and the only time I've been told that I need to wait to submit another prompt is when I've been engaged in extensive vibe-coding sessions.</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a><span class="fu">## Data Visualization with Existing Data</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>::: {.callout-note collapse="true"}</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a><span class="fu">## Initial Prompt to Generate a Prompt</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>Help me generate a high-quality prompt that I can supply to an LLM to generate a Shiny app to evaluate the ChickWeight dataset. Have it include some interesting layout options, such as a sidebar or tabset. Also have some interesting pop-up displays of some sort - so when the user hovers over something (a graph, a selection box, etc) a pop-up is displayed that provides more context or provides instructions.</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>::: {.callout-note collapse="true"}</span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a><span class="fu">## Prompt Generated by ChatGPT5</span></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>Prompt: Build a Shiny App to Explore the <span class="in">`ChickWeight`</span> Dataset (no APIs)</span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>**Role:** You are an expert R Shiny developer.</span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>**Task:** Create a complete, runnable **single-file Shiny app (`app.R`)** that explores the base R **`datasets::ChickWeight`** dataset. The app must include: (1) a **sidebar layout** with global filters, (2) a **tabset** in the main area for multiple linked views, and (3) **hover pop-ups / tooltips** that provide instructions or context when users hover over inputs or UI elements.  </span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>**No external APIs or LLMs**—everything is local to R.</span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a>**Data**</span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a>Use <span class="in">`datasets::ChickWeight`</span> as the only data source. Variables:  </span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`weight`</span> (numeric), <span class="in">`Time`</span> (days), <span class="in">`Chick`</span> (ID), <span class="in">`Diet`</span> (1–4).</span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a>**Packages (keep dependencies modest)**</span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Required: **shiny**, **ggplot2**, **dplyr**, **tidyr**, **DT**, **bslib**  </span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Optional (strongly preferred for interactivity): **plotly** for hover tooltips on charts  </span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Do **not** use packages that need system libraries; keep it CRAN-friendly.</span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb5-50"><a href="#cb5-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-51"><a href="#cb5-51" aria-hidden="true" tabindex="-1"></a>**UI &amp; Layout**</span>
<span id="cb5-52"><a href="#cb5-52" aria-hidden="true" tabindex="-1"></a>Use **`bslib`** for a clean Bootstrap-5 theme (e.g., <span class="in">`bslib::bs_theme(preset = "minty")`</span>).</span>
<span id="cb5-53"><a href="#cb5-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-54"><a href="#cb5-54" aria-hidden="true" tabindex="-1"></a>**Overall structure:** <span class="in">`shiny::fluidPage()`</span> → <span class="in">`shiny::sidebarLayout()`</span>  </span>
<span id="cb5-55"><a href="#cb5-55" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Sidebar panel (global filters):**</span>
<span id="cb5-56"><a href="#cb5-56" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>**Diet filter**: <span class="in">`checkboxGroupInput`</span> for Diet 1–4 (default: all)</span>
<span id="cb5-57"><a href="#cb5-57" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Add a **hover tooltip** explaining diet codes (use <span class="in">`bslib::tooltip()`</span> or <span class="in">`bslib::popover()`</span> on the input label or an adjacent info icon).</span>
<span id="cb5-58"><a href="#cb5-58" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>**Time range**: <span class="in">`sliderInput`</span> for days (0–21)</span>
<span id="cb5-59"><a href="#cb5-59" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Add a tooltip: “Drag to focus growth interval; all summaries respect this window.”</span>
<span id="cb5-60"><a href="#cb5-60" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>**Chick highlight**: <span class="in">`selectizeInput`</span> allowing multiple IDs to highlight (default: none)</span>
<span id="cb5-61"><a href="#cb5-61" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Tooltip: “Type to find a Chick ID; selected IDs are emphasized in plots and table.”</span>
<span id="cb5-62"><a href="#cb5-62" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>**Smoothing**: <span class="in">`checkboxInput`</span> to add LOESS mean curve per Diet (and optional CI ribbon)</span>
<span id="cb5-63"><a href="#cb5-63" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Tooltip: “Show smoothed average by Diet; use with caution for small n.”</span>
<span id="cb5-64"><a href="#cb5-64" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>**Scale**: <span class="in">`radioButtons`</span> for y-axis (“Linear”, “Log10”)</span>
<span id="cb5-65"><a href="#cb5-65" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Tooltip: short rationale for log-scale.</span>
<span id="cb5-66"><a href="#cb5-66" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>**Reset filters**: <span class="in">`actionButton("reset", "Reset Filters")`</span></span>
<span id="cb5-67"><a href="#cb5-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-68"><a href="#cb5-68" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Main panel (tabset)**</span>
<span id="cb5-69"><a href="#cb5-69" aria-hidden="true" tabindex="-1"></a>  Use <span class="in">`tabsetPanel(id = "tabs", type = "pills")`</span> with the following tabs:</span>
<span id="cb5-70"><a href="#cb5-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-71"><a href="#cb5-71" aria-hidden="true" tabindex="-1"></a>  1) **Overview**  </span>
<span id="cb5-72"><a href="#cb5-72" aria-hidden="true" tabindex="-1"></a><span class="ss">     - </span>A **valueBox-like summary row** (simple cards) showing:</span>
<span id="cb5-73"><a href="#cb5-73" aria-hidden="true" tabindex="-1"></a><span class="ss">       - </span>Number of visible chicks, average terminal weight (within time window), and number of timepoints.</span>
<span id="cb5-74"><a href="#cb5-74" aria-hidden="true" tabindex="-1"></a><span class="ss">     - </span>A short paragraph (Markdown) describing the dataset and how filters apply.</span>
<span id="cb5-75"><a href="#cb5-75" aria-hidden="true" tabindex="-1"></a><span class="ss">     - </span>A **popover** (hover info icon) that explains the study design and why repeated measures matter.</span>
<span id="cb5-76"><a href="#cb5-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-77"><a href="#cb5-77" aria-hidden="true" tabindex="-1"></a>  2) **Growth Curves**  </span>
<span id="cb5-78"><a href="#cb5-78" aria-hidden="true" tabindex="-1"></a><span class="ss">     - </span>**Primary plot**: weight vs. time lines, one line per Chick, colored by Diet.</span>
<span id="cb5-79"><a href="#cb5-79" aria-hidden="true" tabindex="-1"></a><span class="ss">     - </span>Optional **mean LOESS curve per Diet** + semi-transparent ribbon (if smoothing is on).</span>
<span id="cb5-80"><a href="#cb5-80" aria-hidden="true" tabindex="-1"></a><span class="ss">     - </span>**Highlight** selected Chick IDs (thicker line/alpha=1).</span>
<span id="cb5-81"><a href="#cb5-81" aria-hidden="true" tabindex="-1"></a><span class="ss">     - </span>If <span class="in">`plotly`</span> is available, convert <span class="in">`ggplot`</span> to <span class="in">`ggplotly()`</span> so that **hover** shows:</span>
<span id="cb5-82"><a href="#cb5-82" aria-hidden="true" tabindex="-1"></a><span class="ss">       - </span>Chick, Diet, Time, Weight, and (if computed) per-Chick slope for current window.</span>
<span id="cb5-83"><a href="#cb5-83" aria-hidden="true" tabindex="-1"></a><span class="ss">     - </span>Add a small **info icon** near the tab title with a <span class="in">`bslib::popover()`</span> explaining how to read growth curves.</span>
<span id="cb5-84"><a href="#cb5-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-85"><a href="#cb5-85" aria-hidden="true" tabindex="-1"></a>  3) **Diet Comparison**  </span>
<span id="cb5-86"><a href="#cb5-86" aria-hidden="true" tabindex="-1"></a><span class="ss">     - </span>Side-by-side **boxplots/violins** of final weight (within the chosen time window) by Diet.</span>
<span id="cb5-87"><a href="#cb5-87" aria-hidden="true" tabindex="-1"></a><span class="ss">     - </span>A secondary **bar chart** ranking Diets by mean terminal weight (or mean Δweight per Chick).</span>
<span id="cb5-88"><a href="#cb5-88" aria-hidden="true" tabindex="-1"></a><span class="ss">     - </span>Hover/tooltip on the plot area describing how “final weight” is derived (max Time within window).</span>
<span id="cb5-89"><a href="#cb5-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-90"><a href="#cb5-90" aria-hidden="true" tabindex="-1"></a>  4) **Chick Table**  </span>
<span id="cb5-91"><a href="#cb5-91" aria-hidden="true" tabindex="-1"></a><span class="ss">     - </span>A <span class="in">`DT::datatable`</span> listing only the currently **visible** chicks (after filters), with columns:</span>
<span id="cb5-92"><a href="#cb5-92" aria-hidden="true" tabindex="-1"></a><span class="ss">       - </span>Chick, Diet, n_timepoints (within window), first_weight, last_weight, **Δweight**, and **slope** (simple lm(weight ~ Time) over the window).</span>
<span id="cb5-93"><a href="#cb5-93" aria-hidden="true" tabindex="-1"></a><span class="ss">     - </span>**Row selection → highlights** the corresponding Chick line in the Growth Curves tab (reactively).</span>
<span id="cb5-94"><a href="#cb5-94" aria-hidden="true" tabindex="-1"></a><span class="ss">     - </span>Add a **download button** to export this table as CSV (no server storage).</span>
<span id="cb5-95"><a href="#cb5-95" aria-hidden="true" tabindex="-1"></a><span class="ss">     - </span>Tooltip on the table header: “Click column headers to sort; use search to filter rows.”</span>
<span id="cb5-96"><a href="#cb5-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-97"><a href="#cb5-97" aria-hidden="true" tabindex="-1"></a>  5) **About / Help**  </span>
<span id="cb5-98"><a href="#cb5-98" aria-hidden="true" tabindex="-1"></a><span class="ss">     - </span>Concise prose on interpretation, caveats (missing values, small samples), and how smoothing/log scale change the view.</span>
<span id="cb5-99"><a href="#cb5-99" aria-hidden="true" tabindex="-1"></a><span class="ss">     - </span>A <span class="in">`bslib::popover()`</span> on “Caveats” that appears on hover for a few seconds.</span>
<span id="cb5-100"><a href="#cb5-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-101"><a href="#cb5-101" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb5-102"><a href="#cb5-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-103"><a href="#cb5-103" aria-hidden="true" tabindex="-1"></a>**Server Requirements (high-level behavior)**</span>
<span id="cb5-104"><a href="#cb5-104" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Create a single reactive **filtered dataset** based on Diet and Time range. All downstream outputs depend on this.</span>
<span id="cb5-105"><a href="#cb5-105" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Linked reactivity**:</span>
<span id="cb5-106"><a href="#cb5-106" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Changing filters updates all tabs’ outputs.</span>
<span id="cb5-107"><a href="#cb5-107" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Selecting/changing Chick IDs highlights them in plots and the table.</span>
<span id="cb5-108"><a href="#cb5-108" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Selecting rows in the table highlights those lines in the Growth Curves plot.</span>
<span id="cb5-109"><a href="#cb5-109" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Derived metrics** (computed on the filtered data):</span>
<span id="cb5-110"><a href="#cb5-110" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Per-Chick **Δweight** = (max weight − min weight) for times within the window.</span>
<span id="cb5-111"><a href="#cb5-111" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Per-Chick **slope** from <span class="in">`lm(weight ~ Time)`</span> within the window; display as g/day.</span>
<span id="cb5-112"><a href="#cb5-112" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Per-Diet summaries (mean terminal weight, median Δweight).</span>
<span id="cb5-113"><a href="#cb5-113" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Validation/empty states**:</span>
<span id="cb5-114"><a href="#cb5-114" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>If filters remove all data, show a friendly empty-state message instead of blank plots/tables.</span>
<span id="cb5-115"><a href="#cb5-115" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Scale handling**:</span>
<span id="cb5-116"><a href="#cb5-116" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>If log scale is selected, transform y-axis appropriately and suppress non-positive weights (with a note).</span>
<span id="cb5-117"><a href="#cb5-117" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Reset** button restores default filters.</span>
<span id="cb5-118"><a href="#cb5-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-119"><a href="#cb5-119" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb5-120"><a href="#cb5-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-121"><a href="#cb5-121" aria-hidden="true" tabindex="-1"></a>**Hover Pop-ups / Tooltips (must-have)**</span>
<span id="cb5-122"><a href="#cb5-122" aria-hidden="true" tabindex="-1"></a>Use **`bslib::tooltip()`** and/or **`bslib::popover()`** to attach hover help to:</span>
<span id="cb5-123"><a href="#cb5-123" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Diet filter label (explain diet codes 1–4)</span>
<span id="cb5-124"><a href="#cb5-124" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Time range slider label (explain windows)</span>
<span id="cb5-125"><a href="#cb5-125" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Chick select label (how highlighting works)</span>
<span id="cb5-126"><a href="#cb5-126" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Growth Curves tab title or an adjacent info icon (how to interpret lines and smoothing)</span>
<span id="cb5-127"><a href="#cb5-127" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Diet Comparison plot container (how “final weight” is determined)</span>
<span id="cb5-128"><a href="#cb5-128" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Table header (sorting/search tips)</span>
<span id="cb5-129"><a href="#cb5-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-130"><a href="#cb5-130" aria-hidden="true" tabindex="-1"></a>If <span class="in">`plotly`</span> is used, ensure **hovertext** on the graph shows: Chick, Diet, Time, Weight, and Slope (if available).</span>
<span id="cb5-131"><a href="#cb5-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-132"><a href="#cb5-132" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb5-133"><a href="#cb5-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-134"><a href="#cb5-134" aria-hidden="true" tabindex="-1"></a>**Quality &amp; Style**</span>
<span id="cb5-135"><a href="#cb5-135" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Clean, minimal design using **bslib**; sensible spacing and headings.</span>
<span id="cb5-136"><a href="#cb5-136" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Clear code comments explaining each reactive object and output.</span>
<span id="cb5-137"><a href="#cb5-137" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>No external services or files; everything runs locally with <span class="in">`shiny::runApp()`</span>.</span>
<span id="cb5-138"><a href="#cb5-138" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Keep code in **one file `app.R`**.</span>
<span id="cb5-139"><a href="#cb5-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-140"><a href="#cb5-140" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb5-141"><a href="#cb5-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-142"><a href="#cb5-142" aria-hidden="true" tabindex="-1"></a>**Deliverable**</span>
<span id="cb5-143"><a href="#cb5-143" aria-hidden="true" tabindex="-1"></a>Output **only** a complete <span class="in">`app.R`</span> in a single code block, ready to run.</span>
<span id="cb5-144"><a href="#cb5-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-145"><a href="#cb5-145" aria-hidden="true" tabindex="-1"></a>**Acceptance Criteria**</span>
<span id="cb5-146"><a href="#cb5-146" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>App launches with sidebar + tabset and all tabs functioning.</span>
<span id="cb5-147"><a href="#cb5-147" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Filters, highlights, and tabs are fully reactive and consistent.</span>
<span id="cb5-148"><a href="#cb5-148" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Hover pop-ups/tooltips appear on specified inputs/areas using <span class="in">`bslib`</span>.</span>
<span id="cb5-149"><a href="#cb5-149" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Growth Curves and Diet Comparison are informative and respect filters/smoothing/scale.</span>
<span id="cb5-150"><a href="#cb5-150" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Table reflects the filtered/visible cohort and supports row-selection highlighting.</span>
<span id="cb5-151"><a href="#cb5-151" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>CSV download works for the current table view.</span>
<span id="cb5-152"><a href="#cb5-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-153"><a href="#cb5-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-154"><a href="#cb5-154" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb5-155"><a href="#cb5-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-156"><a href="#cb5-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-157"><a href="#cb5-157" aria-hidden="true" tabindex="-1"></a>::: {.callout-note collapse="true"}</span>
<span id="cb5-158"><a href="#cb5-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-159"><a href="#cb5-159" aria-hidden="true" tabindex="-1"></a><span class="fu">## App Syntax Generated by Claude</span></span>
<span id="cb5-160"><a href="#cb5-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-161"><a href="#cb5-161" aria-hidden="true" tabindex="-1"></a>You can either download the app below, or copy and paste the chunk of code in a new .R file.</span>
<span id="cb5-162"><a href="#cb5-162" aria-hidden="true" tabindex="-1"></a>Then highlight and execute the text.</span>
<span id="cb5-163"><a href="#cb5-163" aria-hidden="true" tabindex="-1"></a>It may take a minute or two the first time the app runs for it to be built, but a new window should open and the app should run.</span>
<span id="cb5-164"><a href="#cb5-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-165"><a href="#cb5-165" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">a</span><span class="ot"> href</span><span class="op">=</span><span class="st">"downloads/ChickWeight_app.R"</span><span class="ot"> download style</span><span class="op">=</span><span class="st">"display: inline-block; padding: 10px 20px; background-color: #4A90E2; color: black; text-decoration: none; border-radius: 5px;"</span><span class="dt">&gt;</span></span>
<span id="cb5-166"><a href="#cb5-166" aria-hidden="true" tabindex="-1"></a>  📥 Download <span class="in">`ChickWeight_app`</span></span>
<span id="cb5-167"><a href="#cb5-167" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">a</span><span class="dt">&gt;</span></span>
<span id="cb5-168"><a href="#cb5-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-169"><a href="#cb5-169" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = FALSE}</span></span>
<span id="cb5-170"><a href="#cb5-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-171"><a href="#cb5-171" aria-hidden="true" tabindex="-1"></a><span class="co"># ==============================================================================</span></span>
<span id="cb5-172"><a href="#cb5-172" aria-hidden="true" tabindex="-1"></a><span class="co"># Shiny App: ChickWeight Explorer</span></span>
<span id="cb5-173"><a href="#cb5-173" aria-hidden="true" tabindex="-1"></a><span class="co"># A single-file app exploring the datasets::ChickWeight dataset</span></span>
<span id="cb5-174"><a href="#cb5-174" aria-hidden="true" tabindex="-1"></a><span class="co"># ==============================================================================</span></span>
<span id="cb5-175"><a href="#cb5-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-176"><a href="#cb5-176" aria-hidden="true" tabindex="-1"></a><span class="co"># Load required packages</span></span>
<span id="cb5-177"><a href="#cb5-177" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(shiny)</span>
<span id="cb5-178"><a href="#cb5-178" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb5-179"><a href="#cb5-179" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb5-180"><a href="#cb5-180" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb5-181"><a href="#cb5-181" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DT)</span>
<span id="cb5-182"><a href="#cb5-182" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(bslib)</span>
<span id="cb5-183"><a href="#cb5-183" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(datasets)</span>
<span id="cb5-184"><a href="#cb5-184" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plotly)  <span class="co"># For interactive hover tooltips</span></span>
<span id="cb5-185"><a href="#cb5-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-186"><a href="#cb5-186" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the data</span></span>
<span id="cb5-187"><a href="#cb5-187" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"ChickWeight"</span>, <span class="at">package =</span> <span class="st">"datasets"</span>)</span>
<span id="cb5-188"><a href="#cb5-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-189"><a href="#cb5-189" aria-hidden="true" tabindex="-1"></a><span class="co"># ==============================================================================</span></span>
<span id="cb5-190"><a href="#cb5-190" aria-hidden="true" tabindex="-1"></a><span class="co"># UI</span></span>
<span id="cb5-191"><a href="#cb5-191" aria-hidden="true" tabindex="-1"></a><span class="co"># ==============================================================================</span></span>
<span id="cb5-192"><a href="#cb5-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-193"><a href="#cb5-193" aria-hidden="true" tabindex="-1"></a>ui <span class="ot">&lt;-</span> <span class="fu">fluidPage</span>(</span>
<span id="cb5-194"><a href="#cb5-194" aria-hidden="true" tabindex="-1"></a>  <span class="at">theme =</span> <span class="fu">bs_theme</span>(<span class="at">preset =</span> <span class="st">"minty"</span>, <span class="at">version =</span> <span class="dv">5</span>),</span>
<span id="cb5-195"><a href="#cb5-195" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-196"><a href="#cb5-196" aria-hidden="true" tabindex="-1"></a>  <span class="fu">titlePanel</span>(<span class="st">"ChickWeight Dataset Explorer"</span>),</span>
<span id="cb5-197"><a href="#cb5-197" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-198"><a href="#cb5-198" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sidebarLayout</span>(</span>
<span id="cb5-199"><a href="#cb5-199" aria-hidden="true" tabindex="-1"></a>    <span class="co"># --------------------------------------------------------------------------</span></span>
<span id="cb5-200"><a href="#cb5-200" aria-hidden="true" tabindex="-1"></a>    <span class="co"># SIDEBAR: Global Filters with Tooltips</span></span>
<span id="cb5-201"><a href="#cb5-201" aria-hidden="true" tabindex="-1"></a>    <span class="co"># --------------------------------------------------------------------------</span></span>
<span id="cb5-202"><a href="#cb5-202" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sidebarPanel</span>(</span>
<span id="cb5-203"><a href="#cb5-203" aria-hidden="true" tabindex="-1"></a>      <span class="at">width =</span> <span class="dv">3</span>,</span>
<span id="cb5-204"><a href="#cb5-204" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb5-205"><a href="#cb5-205" aria-hidden="true" tabindex="-1"></a>      <span class="fu">h4</span>(<span class="st">"Filters"</span>),</span>
<span id="cb5-206"><a href="#cb5-206" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb5-207"><a href="#cb5-207" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Diet filter with tooltip</span></span>
<span id="cb5-208"><a href="#cb5-208" aria-hidden="true" tabindex="-1"></a>      <span class="fu">div</span>(</span>
<span id="cb5-209"><a href="#cb5-209" aria-hidden="true" tabindex="-1"></a>        <span class="at">style =</span> <span class="st">"display: flex; align-items: center; gap: 5px;"</span>,</span>
<span id="cb5-210"><a href="#cb5-210" aria-hidden="true" tabindex="-1"></a>        tags<span class="sc">$</span><span class="fu">label</span>(<span class="st">"Diet"</span>, <span class="st">`</span><span class="at">for</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"diet_filter"</span>),</span>
<span id="cb5-211"><a href="#cb5-211" aria-hidden="true" tabindex="-1"></a>        bslib<span class="sc">::</span><span class="fu">tooltip</span>(</span>
<span id="cb5-212"><a href="#cb5-212" aria-hidden="true" tabindex="-1"></a>          <span class="fu">icon</span>(<span class="st">"circle-info"</span>),</span>
<span id="cb5-213"><a href="#cb5-213" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Diet types 1–4 represent different protein supplements. Select which diets to include in the analysis."</span>,</span>
<span id="cb5-214"><a href="#cb5-214" aria-hidden="true" tabindex="-1"></a>          <span class="at">placement =</span> <span class="st">"right"</span></span>
<span id="cb5-215"><a href="#cb5-215" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb5-216"><a href="#cb5-216" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb5-217"><a href="#cb5-217" aria-hidden="true" tabindex="-1"></a>      <span class="fu">checkboxGroupInput</span>(</span>
<span id="cb5-218"><a href="#cb5-218" aria-hidden="true" tabindex="-1"></a>        <span class="st">"diet_filter"</span>,</span>
<span id="cb5-219"><a href="#cb5-219" aria-hidden="true" tabindex="-1"></a>        <span class="at">label =</span> <span class="cn">NULL</span>,</span>
<span id="cb5-220"><a href="#cb5-220" aria-hidden="true" tabindex="-1"></a>        <span class="at">choices =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>,</span>
<span id="cb5-221"><a href="#cb5-221" aria-hidden="true" tabindex="-1"></a>        <span class="at">selected =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>,</span>
<span id="cb5-222"><a href="#cb5-222" aria-hidden="true" tabindex="-1"></a>        <span class="at">inline =</span> <span class="cn">TRUE</span></span>
<span id="cb5-223"><a href="#cb5-223" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb5-224"><a href="#cb5-224" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb5-225"><a href="#cb5-225" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Time range slider with tooltip</span></span>
<span id="cb5-226"><a href="#cb5-226" aria-hidden="true" tabindex="-1"></a>      <span class="fu">div</span>(</span>
<span id="cb5-227"><a href="#cb5-227" aria-hidden="true" tabindex="-1"></a>        <span class="at">style =</span> <span class="st">"display: flex; align-items: center; gap: 5px; margin-top: 15px;"</span>,</span>
<span id="cb5-228"><a href="#cb5-228" aria-hidden="true" tabindex="-1"></a>        tags<span class="sc">$</span><span class="fu">label</span>(<span class="st">"Time Range (days)"</span>, <span class="st">`</span><span class="at">for</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"time_range"</span>),</span>
<span id="cb5-229"><a href="#cb5-229" aria-hidden="true" tabindex="-1"></a>        bslib<span class="sc">::</span><span class="fu">tooltip</span>(</span>
<span id="cb5-230"><a href="#cb5-230" aria-hidden="true" tabindex="-1"></a>          <span class="fu">icon</span>(<span class="st">"circle-info"</span>),</span>
<span id="cb5-231"><a href="#cb5-231" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Drag to focus on a specific growth interval. All summaries and plots respect this time window."</span>,</span>
<span id="cb5-232"><a href="#cb5-232" aria-hidden="true" tabindex="-1"></a>          <span class="at">placement =</span> <span class="st">"right"</span></span>
<span id="cb5-233"><a href="#cb5-233" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb5-234"><a href="#cb5-234" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb5-235"><a href="#cb5-235" aria-hidden="true" tabindex="-1"></a>      <span class="fu">sliderInput</span>(</span>
<span id="cb5-236"><a href="#cb5-236" aria-hidden="true" tabindex="-1"></a>        <span class="st">"time_range"</span>,</span>
<span id="cb5-237"><a href="#cb5-237" aria-hidden="true" tabindex="-1"></a>        <span class="at">label =</span> <span class="cn">NULL</span>,</span>
<span id="cb5-238"><a href="#cb5-238" aria-hidden="true" tabindex="-1"></a>        <span class="at">min =</span> <span class="dv">0</span>,</span>
<span id="cb5-239"><a href="#cb5-239" aria-hidden="true" tabindex="-1"></a>        <span class="at">max =</span> <span class="dv">21</span>,</span>
<span id="cb5-240"><a href="#cb5-240" aria-hidden="true" tabindex="-1"></a>        <span class="at">value =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">21</span>),</span>
<span id="cb5-241"><a href="#cb5-241" aria-hidden="true" tabindex="-1"></a>        <span class="at">step =</span> <span class="dv">1</span></span>
<span id="cb5-242"><a href="#cb5-242" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb5-243"><a href="#cb5-243" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb5-244"><a href="#cb5-244" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Chick highlight with tooltip</span></span>
<span id="cb5-245"><a href="#cb5-245" aria-hidden="true" tabindex="-1"></a>      <span class="fu">div</span>(</span>
<span id="cb5-246"><a href="#cb5-246" aria-hidden="true" tabindex="-1"></a>        <span class="at">style =</span> <span class="st">"display: flex; align-items: center; gap: 5px; margin-top: 15px;"</span>,</span>
<span id="cb5-247"><a href="#cb5-247" aria-hidden="true" tabindex="-1"></a>        tags<span class="sc">$</span><span class="fu">label</span>(<span class="st">"Highlight Chicks"</span>, <span class="st">`</span><span class="at">for</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"chick_highlight"</span>),</span>
<span id="cb5-248"><a href="#cb5-248" aria-hidden="true" tabindex="-1"></a>        bslib<span class="sc">::</span><span class="fu">tooltip</span>(</span>
<span id="cb5-249"><a href="#cb5-249" aria-hidden="true" tabindex="-1"></a>          <span class="fu">icon</span>(<span class="st">"circle-info"</span>),</span>
<span id="cb5-250"><a href="#cb5-250" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Type to find a Chick ID. Selected chicks are emphasized in plots and highlighted in the table."</span>,</span>
<span id="cb5-251"><a href="#cb5-251" aria-hidden="true" tabindex="-1"></a>          <span class="at">placement =</span> <span class="st">"right"</span></span>
<span id="cb5-252"><a href="#cb5-252" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb5-253"><a href="#cb5-253" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb5-254"><a href="#cb5-254" aria-hidden="true" tabindex="-1"></a>      <span class="fu">selectizeInput</span>(</span>
<span id="cb5-255"><a href="#cb5-255" aria-hidden="true" tabindex="-1"></a>        <span class="st">"chick_highlight"</span>,</span>
<span id="cb5-256"><a href="#cb5-256" aria-hidden="true" tabindex="-1"></a>        <span class="at">label =</span> <span class="cn">NULL</span>,</span>
<span id="cb5-257"><a href="#cb5-257" aria-hidden="true" tabindex="-1"></a>        <span class="at">choices =</span> <span class="fu">unique</span>(ChickWeight<span class="sc">$</span>Chick),</span>
<span id="cb5-258"><a href="#cb5-258" aria-hidden="true" tabindex="-1"></a>        <span class="at">selected =</span> <span class="cn">NULL</span>,</span>
<span id="cb5-259"><a href="#cb5-259" aria-hidden="true" tabindex="-1"></a>        <span class="at">multiple =</span> <span class="cn">TRUE</span>,</span>
<span id="cb5-260"><a href="#cb5-260" aria-hidden="true" tabindex="-1"></a>        <span class="at">options =</span> <span class="fu">list</span>(<span class="at">placeholder =</span> <span class="st">"Select chick(s)..."</span>)</span>
<span id="cb5-261"><a href="#cb5-261" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb5-262"><a href="#cb5-262" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb5-263"><a href="#cb5-263" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Smoothing option with tooltip</span></span>
<span id="cb5-264"><a href="#cb5-264" aria-hidden="true" tabindex="-1"></a>      <span class="fu">div</span>(</span>
<span id="cb5-265"><a href="#cb5-265" aria-hidden="true" tabindex="-1"></a>        <span class="at">style =</span> <span class="st">"margin-top: 15px;"</span>,</span>
<span id="cb5-266"><a href="#cb5-266" aria-hidden="true" tabindex="-1"></a>        <span class="fu">checkboxInput</span>(</span>
<span id="cb5-267"><a href="#cb5-267" aria-hidden="true" tabindex="-1"></a>          <span class="st">"smoothing"</span>,</span>
<span id="cb5-268"><a href="#cb5-268" aria-hidden="true" tabindex="-1"></a>          <span class="at">label =</span> <span class="fu">div</span>(</span>
<span id="cb5-269"><a href="#cb5-269" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Add LOESS smoothing"</span>,</span>
<span id="cb5-270"><a href="#cb5-270" aria-hidden="true" tabindex="-1"></a>            bslib<span class="sc">::</span><span class="fu">tooltip</span>(</span>
<span id="cb5-271"><a href="#cb5-271" aria-hidden="true" tabindex="-1"></a>              <span class="fu">icon</span>(<span class="st">"circle-info"</span>),</span>
<span id="cb5-272"><a href="#cb5-272" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Show smoothed average trend by Diet with confidence ribbon. Use with caution for small sample sizes."</span>,</span>
<span id="cb5-273"><a href="#cb5-273" aria-hidden="true" tabindex="-1"></a>              <span class="at">placement =</span> <span class="st">"right"</span></span>
<span id="cb5-274"><a href="#cb5-274" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb5-275"><a href="#cb5-275" aria-hidden="true" tabindex="-1"></a>          ),</span>
<span id="cb5-276"><a href="#cb5-276" aria-hidden="true" tabindex="-1"></a>          <span class="at">value =</span> <span class="cn">FALSE</span></span>
<span id="cb5-277"><a href="#cb5-277" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb5-278"><a href="#cb5-278" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb5-279"><a href="#cb5-279" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb5-280"><a href="#cb5-280" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Scale option with tooltip</span></span>
<span id="cb5-281"><a href="#cb5-281" aria-hidden="true" tabindex="-1"></a>      <span class="fu">div</span>(</span>
<span id="cb5-282"><a href="#cb5-282" aria-hidden="true" tabindex="-1"></a>        <span class="at">style =</span> <span class="st">"margin-top: 15px;"</span>,</span>
<span id="cb5-283"><a href="#cb5-283" aria-hidden="true" tabindex="-1"></a>        tags<span class="sc">$</span><span class="fu">label</span>(<span class="st">"Y-axis Scale"</span>),</span>
<span id="cb5-284"><a href="#cb5-284" aria-hidden="true" tabindex="-1"></a>        bslib<span class="sc">::</span><span class="fu">tooltip</span>(</span>
<span id="cb5-285"><a href="#cb5-285" aria-hidden="true" tabindex="-1"></a>          <span class="fu">icon</span>(<span class="st">"circle-info"</span>),</span>
<span id="cb5-286"><a href="#cb5-286" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Log scale can reveal proportional growth patterns and reduce the influence of outliers."</span>,</span>
<span id="cb5-287"><a href="#cb5-287" aria-hidden="true" tabindex="-1"></a>          <span class="at">placement =</span> <span class="st">"right"</span></span>
<span id="cb5-288"><a href="#cb5-288" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb5-289"><a href="#cb5-289" aria-hidden="true" tabindex="-1"></a>        <span class="fu">radioButtons</span>(</span>
<span id="cb5-290"><a href="#cb5-290" aria-hidden="true" tabindex="-1"></a>          <span class="st">"scale"</span>,</span>
<span id="cb5-291"><a href="#cb5-291" aria-hidden="true" tabindex="-1"></a>          <span class="at">label =</span> <span class="cn">NULL</span>,</span>
<span id="cb5-292"><a href="#cb5-292" aria-hidden="true" tabindex="-1"></a>          <span class="at">choices =</span> <span class="fu">c</span>(<span class="st">"Linear"</span>, <span class="st">"Log10"</span>),</span>
<span id="cb5-293"><a href="#cb5-293" aria-hidden="true" tabindex="-1"></a>          <span class="at">selected =</span> <span class="st">"Linear"</span></span>
<span id="cb5-294"><a href="#cb5-294" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb5-295"><a href="#cb5-295" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb5-296"><a href="#cb5-296" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb5-297"><a href="#cb5-297" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Reset button</span></span>
<span id="cb5-298"><a href="#cb5-298" aria-hidden="true" tabindex="-1"></a>      <span class="fu">actionButton</span>(</span>
<span id="cb5-299"><a href="#cb5-299" aria-hidden="true" tabindex="-1"></a>        <span class="st">"reset"</span>,</span>
<span id="cb5-300"><a href="#cb5-300" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Reset Filters"</span>,</span>
<span id="cb5-301"><a href="#cb5-301" aria-hidden="true" tabindex="-1"></a>        <span class="at">class =</span> <span class="st">"btn-warning"</span>,</span>
<span id="cb5-302"><a href="#cb5-302" aria-hidden="true" tabindex="-1"></a>        <span class="at">style =</span> <span class="st">"margin-top: 20px; width: 100%;"</span></span>
<span id="cb5-303"><a href="#cb5-303" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb5-304"><a href="#cb5-304" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb5-305"><a href="#cb5-305" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-306"><a href="#cb5-306" aria-hidden="true" tabindex="-1"></a>    <span class="co"># --------------------------------------------------------------------------</span></span>
<span id="cb5-307"><a href="#cb5-307" aria-hidden="true" tabindex="-1"></a>    <span class="co"># MAIN PANEL: Tabset</span></span>
<span id="cb5-308"><a href="#cb5-308" aria-hidden="true" tabindex="-1"></a>    <span class="co"># --------------------------------------------------------------------------</span></span>
<span id="cb5-309"><a href="#cb5-309" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mainPanel</span>(</span>
<span id="cb5-310"><a href="#cb5-310" aria-hidden="true" tabindex="-1"></a>      <span class="at">width =</span> <span class="dv">9</span>,</span>
<span id="cb5-311"><a href="#cb5-311" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb5-312"><a href="#cb5-312" aria-hidden="true" tabindex="-1"></a>      <span class="fu">tabsetPanel</span>(</span>
<span id="cb5-313"><a href="#cb5-313" aria-hidden="true" tabindex="-1"></a>        <span class="at">id =</span> <span class="st">"tabs"</span>,</span>
<span id="cb5-314"><a href="#cb5-314" aria-hidden="true" tabindex="-1"></a>        <span class="at">type =</span> <span class="st">"pills"</span>,</span>
<span id="cb5-315"><a href="#cb5-315" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb5-316"><a href="#cb5-316" aria-hidden="true" tabindex="-1"></a>        <span class="co"># ---- Tab 1: Overview ----</span></span>
<span id="cb5-317"><a href="#cb5-317" aria-hidden="true" tabindex="-1"></a>        <span class="fu">tabPanel</span>(</span>
<span id="cb5-318"><a href="#cb5-318" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Overview"</span>,</span>
<span id="cb5-319"><a href="#cb5-319" aria-hidden="true" tabindex="-1"></a>          <span class="fu">br</span>(),</span>
<span id="cb5-320"><a href="#cb5-320" aria-hidden="true" tabindex="-1"></a>          <span class="fu">fluidRow</span>(</span>
<span id="cb5-321"><a href="#cb5-321" aria-hidden="true" tabindex="-1"></a>            <span class="fu">column</span>(<span class="dv">4</span>, <span class="fu">uiOutput</span>(<span class="st">"summary_chicks"</span>)),</span>
<span id="cb5-322"><a href="#cb5-322" aria-hidden="true" tabindex="-1"></a>            <span class="fu">column</span>(<span class="dv">4</span>, <span class="fu">uiOutput</span>(<span class="st">"summary_weight"</span>)),</span>
<span id="cb5-323"><a href="#cb5-323" aria-hidden="true" tabindex="-1"></a>            <span class="fu">column</span>(<span class="dv">4</span>, <span class="fu">uiOutput</span>(<span class="st">"summary_timepoints"</span>))</span>
<span id="cb5-324"><a href="#cb5-324" aria-hidden="true" tabindex="-1"></a>          ),</span>
<span id="cb5-325"><a href="#cb5-325" aria-hidden="true" tabindex="-1"></a>          <span class="fu">hr</span>(),</span>
<span id="cb5-326"><a href="#cb5-326" aria-hidden="true" tabindex="-1"></a>          <span class="fu">div</span>(</span>
<span id="cb5-327"><a href="#cb5-327" aria-hidden="true" tabindex="-1"></a>            <span class="fu">h4</span>(</span>
<span id="cb5-328"><a href="#cb5-328" aria-hidden="true" tabindex="-1"></a>              <span class="st">"About the Dataset"</span>,</span>
<span id="cb5-329"><a href="#cb5-329" aria-hidden="true" tabindex="-1"></a>              bslib<span class="sc">::</span><span class="fu">popover</span>(</span>
<span id="cb5-330"><a href="#cb5-330" aria-hidden="true" tabindex="-1"></a>                <span class="fu">icon</span>(<span class="st">"circle-info"</span>),</span>
<span id="cb5-331"><a href="#cb5-331" aria-hidden="true" tabindex="-1"></a>                <span class="at">title =</span> <span class="st">"Study Design"</span>,</span>
<span id="cb5-332"><a href="#cb5-332" aria-hidden="true" tabindex="-1"></a>                <span class="st">"This is a repeated-measures experiment tracking chick growth over time under four different diet regimens. Each chick is measured at regular intervals (days 0, 2, 4, ..., 21)."</span>,</span>
<span id="cb5-333"><a href="#cb5-333" aria-hidden="true" tabindex="-1"></a>                <span class="at">placement =</span> <span class="st">"right"</span></span>
<span id="cb5-334"><a href="#cb5-334" aria-hidden="true" tabindex="-1"></a>              )</span>
<span id="cb5-335"><a href="#cb5-335" aria-hidden="true" tabindex="-1"></a>            ),</span>
<span id="cb5-336"><a href="#cb5-336" aria-hidden="true" tabindex="-1"></a>            <span class="fu">p</span>(<span class="st">"The ChickWeight dataset contains measurements from an experiment on the effect of diet on early growth of chicks. </span></span>
<span id="cb5-337"><a href="#cb5-337" aria-hidden="true" tabindex="-1"></a><span class="st">              The body weights of chicks were measured at birth and every second day thereafter until day 21. </span></span>
<span id="cb5-338"><a href="#cb5-338" aria-hidden="true" tabindex="-1"></a><span class="st">              Four different protein diets were tested on different groups of newly hatched chicks."</span>),</span>
<span id="cb5-339"><a href="#cb5-339" aria-hidden="true" tabindex="-1"></a>            <span class="fu">p</span>(<span class="fu">strong</span>(<span class="st">"Variables:"</span>), <span class="st">"Weight (grams), Time (days), Chick (ID), Diet (1–4)"</span>),</span>
<span id="cb5-340"><a href="#cb5-340" aria-hidden="true" tabindex="-1"></a>            <span class="fu">p</span>(<span class="fu">strong</span>(<span class="st">"Sample size:"</span>), <span class="st">"50 chicks total across 4 diet groups"</span>),</span>
<span id="cb5-341"><a href="#cb5-341" aria-hidden="true" tabindex="-1"></a>            <span class="fu">p</span>(<span class="st">"Use the sidebar filters to focus on specific diets, time windows, or individual chicks. </span></span>
<span id="cb5-342"><a href="#cb5-342" aria-hidden="true" tabindex="-1"></a><span class="st">              All visualizations and summaries automatically update based on your selections."</span>)</span>
<span id="cb5-343"><a href="#cb5-343" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb5-344"><a href="#cb5-344" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb5-345"><a href="#cb5-345" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb5-346"><a href="#cb5-346" aria-hidden="true" tabindex="-1"></a>        <span class="co"># ---- Tab 2: Growth Curves ----</span></span>
<span id="cb5-347"><a href="#cb5-347" aria-hidden="true" tabindex="-1"></a>        <span class="fu">tabPanel</span>(</span>
<span id="cb5-348"><a href="#cb5-348" aria-hidden="true" tabindex="-1"></a>          <span class="fu">div</span>(</span>
<span id="cb5-349"><a href="#cb5-349" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Growth Curves"</span>,</span>
<span id="cb5-350"><a href="#cb5-350" aria-hidden="true" tabindex="-1"></a>            bslib<span class="sc">::</span><span class="fu">tooltip</span>(</span>
<span id="cb5-351"><a href="#cb5-351" aria-hidden="true" tabindex="-1"></a>              <span class="fu">icon</span>(<span class="st">"circle-info"</span>),</span>
<span id="cb5-352"><a href="#cb5-352" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Each line represents one chick's growth trajectory. Hover over lines to see details. Use the smoothing option to view average trends by diet."</span>,</span>
<span id="cb5-353"><a href="#cb5-353" aria-hidden="true" tabindex="-1"></a>              <span class="at">placement =</span> <span class="st">"top"</span></span>
<span id="cb5-354"><a href="#cb5-354" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb5-355"><a href="#cb5-355" aria-hidden="true" tabindex="-1"></a>          ),</span>
<span id="cb5-356"><a href="#cb5-356" aria-hidden="true" tabindex="-1"></a>          <span class="fu">br</span>(),</span>
<span id="cb5-357"><a href="#cb5-357" aria-hidden="true" tabindex="-1"></a>          <span class="fu">uiOutput</span>(<span class="st">"growth_empty_state"</span>),</span>
<span id="cb5-358"><a href="#cb5-358" aria-hidden="true" tabindex="-1"></a>          <span class="fu">plotlyOutput</span>(<span class="st">"growth_plot"</span>, <span class="at">height =</span> <span class="st">"600px"</span>)</span>
<span id="cb5-359"><a href="#cb5-359" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb5-360"><a href="#cb5-360" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb5-361"><a href="#cb5-361" aria-hidden="true" tabindex="-1"></a>        <span class="co"># ---- Tab 3: Diet Comparison ----</span></span>
<span id="cb5-362"><a href="#cb5-362" aria-hidden="true" tabindex="-1"></a>        <span class="fu">tabPanel</span>(</span>
<span id="cb5-363"><a href="#cb5-363" aria-hidden="true" tabindex="-1"></a>          <span class="fu">div</span>(</span>
<span id="cb5-364"><a href="#cb5-364" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Diet Comparison"</span>,</span>
<span id="cb5-365"><a href="#cb5-365" aria-hidden="true" tabindex="-1"></a>            bslib<span class="sc">::</span><span class="fu">tooltip</span>(</span>
<span id="cb5-366"><a href="#cb5-366" aria-hidden="true" tabindex="-1"></a>              <span class="fu">icon</span>(<span class="st">"circle-info"</span>),</span>
<span id="cb5-367"><a href="#cb5-367" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Final weight is defined as the maximum weight observed within the selected time window for each chick."</span>,</span>
<span id="cb5-368"><a href="#cb5-368" aria-hidden="true" tabindex="-1"></a>              <span class="at">placement =</span> <span class="st">"top"</span></span>
<span id="cb5-369"><a href="#cb5-369" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb5-370"><a href="#cb5-370" aria-hidden="true" tabindex="-1"></a>          ),</span>
<span id="cb5-371"><a href="#cb5-371" aria-hidden="true" tabindex="-1"></a>          <span class="fu">br</span>(),</span>
<span id="cb5-372"><a href="#cb5-372" aria-hidden="true" tabindex="-1"></a>          <span class="fu">uiOutput</span>(<span class="st">"diet_empty_state"</span>),</span>
<span id="cb5-373"><a href="#cb5-373" aria-hidden="true" tabindex="-1"></a>          <span class="fu">fluidRow</span>(</span>
<span id="cb5-374"><a href="#cb5-374" aria-hidden="true" tabindex="-1"></a>            <span class="fu">column</span>(<span class="dv">6</span>, <span class="fu">plotlyOutput</span>(<span class="st">"diet_boxplot"</span>, <span class="at">height =</span> <span class="st">"400px"</span>)),</span>
<span id="cb5-375"><a href="#cb5-375" aria-hidden="true" tabindex="-1"></a>            <span class="fu">column</span>(<span class="dv">6</span>, <span class="fu">plotlyOutput</span>(<span class="st">"diet_barplot"</span>, <span class="at">height =</span> <span class="st">"400px"</span>))</span>
<span id="cb5-376"><a href="#cb5-376" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb5-377"><a href="#cb5-377" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb5-378"><a href="#cb5-378" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb5-379"><a href="#cb5-379" aria-hidden="true" tabindex="-1"></a>        <span class="co"># ---- Tab 4: Chick Table ----</span></span>
<span id="cb5-380"><a href="#cb5-380" aria-hidden="true" tabindex="-1"></a>        <span class="fu">tabPanel</span>(</span>
<span id="cb5-381"><a href="#cb5-381" aria-hidden="true" tabindex="-1"></a>          <span class="fu">div</span>(</span>
<span id="cb5-382"><a href="#cb5-382" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Chick Table"</span>,</span>
<span id="cb5-383"><a href="#cb5-383" aria-hidden="true" tabindex="-1"></a>            bslib<span class="sc">::</span><span class="fu">tooltip</span>(</span>
<span id="cb5-384"><a href="#cb5-384" aria-hidden="true" tabindex="-1"></a>              <span class="fu">icon</span>(<span class="st">"circle-info"</span>),</span>
<span id="cb5-385"><a href="#cb5-385" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Click column headers to sort. Use the search box to filter rows. Select rows to highlight chicks in the Growth Curves tab."</span>,</span>
<span id="cb5-386"><a href="#cb5-386" aria-hidden="true" tabindex="-1"></a>              <span class="at">placement =</span> <span class="st">"top"</span></span>
<span id="cb5-387"><a href="#cb5-387" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb5-388"><a href="#cb5-388" aria-hidden="true" tabindex="-1"></a>          ),</span>
<span id="cb5-389"><a href="#cb5-389" aria-hidden="true" tabindex="-1"></a>          <span class="fu">br</span>(),</span>
<span id="cb5-390"><a href="#cb5-390" aria-hidden="true" tabindex="-1"></a>          <span class="fu">downloadButton</span>(<span class="st">"download_table"</span>, <span class="st">"Download CSV"</span>, <span class="at">class =</span> <span class="st">"btn-primary"</span>),</span>
<span id="cb5-391"><a href="#cb5-391" aria-hidden="true" tabindex="-1"></a>          <span class="fu">br</span>(), <span class="fu">br</span>(),</span>
<span id="cb5-392"><a href="#cb5-392" aria-hidden="true" tabindex="-1"></a>          <span class="fu">DTOutput</span>(<span class="st">"chick_table"</span>)</span>
<span id="cb5-393"><a href="#cb5-393" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb5-394"><a href="#cb5-394" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb5-395"><a href="#cb5-395" aria-hidden="true" tabindex="-1"></a>        <span class="co"># ---- Tab 5: About / Help ----</span></span>
<span id="cb5-396"><a href="#cb5-396" aria-hidden="true" tabindex="-1"></a>        <span class="fu">tabPanel</span>(</span>
<span id="cb5-397"><a href="#cb5-397" aria-hidden="true" tabindex="-1"></a>          <span class="st">"About / Help"</span>,</span>
<span id="cb5-398"><a href="#cb5-398" aria-hidden="true" tabindex="-1"></a>          <span class="fu">br</span>(),</span>
<span id="cb5-399"><a href="#cb5-399" aria-hidden="true" tabindex="-1"></a>          <span class="fu">h4</span>(<span class="st">"Interpretation Guide"</span>),</span>
<span id="cb5-400"><a href="#cb5-400" aria-hidden="true" tabindex="-1"></a>          <span class="fu">p</span>(<span class="st">"This app provides multiple perspectives on chick growth patterns:"</span>),</span>
<span id="cb5-401"><a href="#cb5-401" aria-hidden="true" tabindex="-1"></a>          tags<span class="sc">$</span><span class="fu">ul</span>(</span>
<span id="cb5-402"><a href="#cb5-402" aria-hidden="true" tabindex="-1"></a>            tags<span class="sc">$</span><span class="fu">li</span>(<span class="fu">strong</span>(<span class="st">"Growth Curves:"</span>), <span class="st">"Show individual trajectories. Look for parallel growth patterns, </span></span>
<span id="cb5-403"><a href="#cb5-403" aria-hidden="true" tabindex="-1"></a><span class="st">                    divergence over time, or individual outliers."</span>),</span>
<span id="cb5-404"><a href="#cb5-404" aria-hidden="true" tabindex="-1"></a>            tags<span class="sc">$</span><span class="fu">li</span>(<span class="fu">strong</span>(<span class="st">"Diet Comparison:"</span>), <span class="st">"Summarizes final outcomes. Boxplots reveal distribution shape and outliers; </span></span>
<span id="cb5-405"><a href="#cb5-405" aria-hidden="true" tabindex="-1"></a><span class="st">                    bar charts show average performance."</span>),</span>
<span id="cb5-406"><a href="#cb5-406" aria-hidden="true" tabindex="-1"></a>            tags<span class="sc">$</span><span class="fu">li</span>(<span class="fu">strong</span>(<span class="st">"Chick Table:"</span>), <span class="st">"Provides quantitative metrics including growth rate (slope) and total weight gain (Δweight)."</span>)</span>
<span id="cb5-407"><a href="#cb5-407" aria-hidden="true" tabindex="-1"></a>          ),</span>
<span id="cb5-408"><a href="#cb5-408" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb5-409"><a href="#cb5-409" aria-hidden="true" tabindex="-1"></a>          <span class="fu">hr</span>(),</span>
<span id="cb5-410"><a href="#cb5-410" aria-hidden="true" tabindex="-1"></a>          <span class="fu">h4</span>(</span>
<span id="cb5-411"><a href="#cb5-411" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Caveats"</span>,</span>
<span id="cb5-412"><a href="#cb5-412" aria-hidden="true" tabindex="-1"></a>            bslib<span class="sc">::</span><span class="fu">popover</span>(</span>
<span id="cb5-413"><a href="#cb5-413" aria-hidden="true" tabindex="-1"></a>              <span class="fu">icon</span>(<span class="st">"triangle-exclamation"</span>),</span>
<span id="cb5-414"><a href="#cb5-414" aria-hidden="true" tabindex="-1"></a>              <span class="at">title =</span> <span class="st">"Important Considerations"</span>,</span>
<span id="cb5-415"><a href="#cb5-415" aria-hidden="true" tabindex="-1"></a>              <span class="fu">HTML</span>(<span class="st">"&lt;ul&gt;</span></span>
<span id="cb5-416"><a href="#cb5-416" aria-hidden="true" tabindex="-1"></a><span class="st">                &lt;li&gt;Some chicks have missing measurements at later timepoints&lt;/li&gt;</span></span>
<span id="cb5-417"><a href="#cb5-417" aria-hidden="true" tabindex="-1"></a><span class="st">                &lt;li&gt;Sample sizes vary by diet group&lt;/li&gt;</span></span>
<span id="cb5-418"><a href="#cb5-418" aria-hidden="true" tabindex="-1"></a><span class="st">                &lt;li&gt;LOESS smoothing can be misleading with small sample sizes&lt;/li&gt;</span></span>
<span id="cb5-419"><a href="#cb5-419" aria-hidden="true" tabindex="-1"></a><span class="st">                &lt;li&gt;Log scale is only appropriate for positive weights&lt;/li&gt;</span></span>
<span id="cb5-420"><a href="#cb5-420" aria-hidden="true" tabindex="-1"></a><span class="st">                &lt;/ul&gt;"</span>),</span>
<span id="cb5-421"><a href="#cb5-421" aria-hidden="true" tabindex="-1"></a>              <span class="at">placement =</span> <span class="st">"right"</span></span>
<span id="cb5-422"><a href="#cb5-422" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb5-423"><a href="#cb5-423" aria-hidden="true" tabindex="-1"></a>          ),</span>
<span id="cb5-424"><a href="#cb5-424" aria-hidden="true" tabindex="-1"></a>          tags<span class="sc">$</span><span class="fu">ul</span>(</span>
<span id="cb5-425"><a href="#cb5-425" aria-hidden="true" tabindex="-1"></a>            tags<span class="sc">$</span><span class="fu">li</span>(<span class="fu">strong</span>(<span class="st">"Missing data:"</span>), <span class="st">"Not all chicks were measured at all timepoints. </span></span>
<span id="cb5-426"><a href="#cb5-426" aria-hidden="true" tabindex="-1"></a><span class="st">                    The 'final weight' is the maximum observed within your selected time window."</span>),</span>
<span id="cb5-427"><a href="#cb5-427" aria-hidden="true" tabindex="-1"></a>            tags<span class="sc">$</span><span class="fu">li</span>(<span class="fu">strong</span>(<span class="st">"Small samples:"</span>), <span class="st">"Some diet groups have fewer chicks. Be cautious when comparing groups of very different sizes."</span>),</span>
<span id="cb5-428"><a href="#cb5-428" aria-hidden="true" tabindex="-1"></a>            tags<span class="sc">$</span><span class="fu">li</span>(<span class="fu">strong</span>(<span class="st">"Smoothing caveats:"</span>), <span class="st">"LOESS smoothing assumes smooth, continuous growth. </span></span>
<span id="cb5-429"><a href="#cb5-429" aria-hidden="true" tabindex="-1"></a><span class="st">                    It may overfit with small samples or hide important individual variation."</span>),</span>
<span id="cb5-430"><a href="#cb5-430" aria-hidden="true" tabindex="-1"></a>            tags<span class="sc">$</span><span class="fu">li</span>(<span class="fu">strong</span>(<span class="st">"Log scale:"</span>), <span class="st">"Useful for comparing proportional growth rates across different starting weights. </span></span>
<span id="cb5-431"><a href="#cb5-431" aria-hidden="true" tabindex="-1"></a><span class="st">                    However, it can make small absolute differences appear large."</span>)</span>
<span id="cb5-432"><a href="#cb5-432" aria-hidden="true" tabindex="-1"></a>          ),</span>
<span id="cb5-433"><a href="#cb5-433" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb5-434"><a href="#cb5-434" aria-hidden="true" tabindex="-1"></a>          <span class="fu">hr</span>(),</span>
<span id="cb5-435"><a href="#cb5-435" aria-hidden="true" tabindex="-1"></a>          <span class="fu">h4</span>(<span class="st">"Tips"</span>),</span>
<span id="cb5-436"><a href="#cb5-436" aria-hidden="true" tabindex="-1"></a>          tags<span class="sc">$</span><span class="fu">ul</span>(</span>
<span id="cb5-437"><a href="#cb5-437" aria-hidden="true" tabindex="-1"></a>            tags<span class="sc">$</span><span class="fu">li</span>(<span class="st">"Start with all diets selected to get the full picture, then narrow down."</span>),</span>
<span id="cb5-438"><a href="#cb5-438" aria-hidden="true" tabindex="-1"></a>            tags<span class="sc">$</span><span class="fu">li</span>(<span class="st">"Use the time slider to focus on specific growth phases (e.g., days 10–21 for late growth)."</span>),</span>
<span id="cb5-439"><a href="#cb5-439" aria-hidden="true" tabindex="-1"></a>            tags<span class="sc">$</span><span class="fu">li</span>(<span class="st">"Highlight specific chicks to track individuals across multiple views."</span>),</span>
<span id="cb5-440"><a href="#cb5-440" aria-hidden="true" tabindex="-1"></a>            tags<span class="sc">$</span><span class="fu">li</span>(<span class="st">"Row selection in the table automatically highlights those chicks in the growth curves plot."</span>)</span>
<span id="cb5-441"><a href="#cb5-441" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb5-442"><a href="#cb5-442" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb5-443"><a href="#cb5-443" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb5-444"><a href="#cb5-444" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb5-445"><a href="#cb5-445" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb5-446"><a href="#cb5-446" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-447"><a href="#cb5-447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-448"><a href="#cb5-448" aria-hidden="true" tabindex="-1"></a><span class="co"># ==============================================================================</span></span>
<span id="cb5-449"><a href="#cb5-449" aria-hidden="true" tabindex="-1"></a><span class="co"># SERVER</span></span>
<span id="cb5-450"><a href="#cb5-450" aria-hidden="true" tabindex="-1"></a><span class="co"># ==============================================================================</span></span>
<span id="cb5-451"><a href="#cb5-451" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-452"><a href="#cb5-452" aria-hidden="true" tabindex="-1"></a>server <span class="ot">&lt;-</span> <span class="cf">function</span>(input, output, session) {</span>
<span id="cb5-453"><a href="#cb5-453" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-454"><a href="#cb5-454" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ----------------------------------------------------------------------------</span></span>
<span id="cb5-455"><a href="#cb5-455" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Reactive: Filtered Dataset</span></span>
<span id="cb5-456"><a href="#cb5-456" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ----------------------------------------------------------------------------</span></span>
<span id="cb5-457"><a href="#cb5-457" aria-hidden="true" tabindex="-1"></a>  filtered_data <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="cb5-458"><a href="#cb5-458" aria-hidden="true" tabindex="-1"></a>    <span class="fu">req</span>(input<span class="sc">$</span>diet_filter, input<span class="sc">$</span>time_range)</span>
<span id="cb5-459"><a href="#cb5-459" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-460"><a href="#cb5-460" aria-hidden="true" tabindex="-1"></a>    ChickWeight <span class="sc">%&gt;%</span></span>
<span id="cb5-461"><a href="#cb5-461" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(</span>
<span id="cb5-462"><a href="#cb5-462" aria-hidden="true" tabindex="-1"></a>        Diet <span class="sc">%in%</span> input<span class="sc">$</span>diet_filter,</span>
<span id="cb5-463"><a href="#cb5-463" aria-hidden="true" tabindex="-1"></a>        Time <span class="sc">&gt;=</span> input<span class="sc">$</span>time_range[<span class="dv">1</span>],</span>
<span id="cb5-464"><a href="#cb5-464" aria-hidden="true" tabindex="-1"></a>        Time <span class="sc">&lt;=</span> input<span class="sc">$</span>time_range[<span class="dv">2</span>]</span>
<span id="cb5-465"><a href="#cb5-465" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb5-466"><a href="#cb5-466" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb5-467"><a href="#cb5-467" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-468"><a href="#cb5-468" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ----------------------------------------------------------------------------</span></span>
<span id="cb5-469"><a href="#cb5-469" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Reactive: Highlighted Chicks (from sidebar OR table selection)</span></span>
<span id="cb5-470"><a href="#cb5-470" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ----------------------------------------------------------------------------</span></span>
<span id="cb5-471"><a href="#cb5-471" aria-hidden="true" tabindex="-1"></a>  highlighted_chicks <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="cb5-472"><a href="#cb5-472" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Combine sidebar selection and table row selection</span></span>
<span id="cb5-473"><a href="#cb5-473" aria-hidden="true" tabindex="-1"></a>    sidebar_selected <span class="ot">&lt;-</span> input<span class="sc">$</span>chick_highlight</span>
<span id="cb5-474"><a href="#cb5-474" aria-hidden="true" tabindex="-1"></a>    table_selected <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(input<span class="sc">$</span>chick_table_rows_selected)) {</span>
<span id="cb5-475"><a href="#cb5-475" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summary_table</span>()[input<span class="sc">$</span>chick_table_rows_selected, ]<span class="sc">$</span>Chick</span>
<span id="cb5-476"><a href="#cb5-476" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb5-477"><a href="#cb5-477" aria-hidden="true" tabindex="-1"></a>      <span class="cn">NULL</span></span>
<span id="cb5-478"><a href="#cb5-478" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb5-479"><a href="#cb5-479" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unique</span>(<span class="fu">c</span>(sidebar_selected, <span class="fu">as.character</span>(table_selected)))</span>
<span id="cb5-480"><a href="#cb5-480" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb5-481"><a href="#cb5-481" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-482"><a href="#cb5-482" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ----------------------------------------------------------------------------</span></span>
<span id="cb5-483"><a href="#cb5-483" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Reactive: Per-Chick Summary Metrics</span></span>
<span id="cb5-484"><a href="#cb5-484" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ----------------------------------------------------------------------------</span></span>
<span id="cb5-485"><a href="#cb5-485" aria-hidden="true" tabindex="-1"></a>  summary_table <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="cb5-486"><a href="#cb5-486" aria-hidden="true" tabindex="-1"></a>    <span class="fu">req</span>(<span class="fu">nrow</span>(<span class="fu">filtered_data</span>()) <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb5-487"><a href="#cb5-487" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-488"><a href="#cb5-488" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filtered_data</span>() <span class="sc">%&gt;%</span></span>
<span id="cb5-489"><a href="#cb5-489" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(Chick, Diet) <span class="sc">%&gt;%</span></span>
<span id="cb5-490"><a href="#cb5-490" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarise</span>(</span>
<span id="cb5-491"><a href="#cb5-491" aria-hidden="true" tabindex="-1"></a>        <span class="at">n_timepoints =</span> <span class="fu">n</span>(),</span>
<span id="cb5-492"><a href="#cb5-492" aria-hidden="true" tabindex="-1"></a>        <span class="at">first_weight =</span> <span class="fu">min</span>(weight, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb5-493"><a href="#cb5-493" aria-hidden="true" tabindex="-1"></a>        <span class="at">last_weight =</span> <span class="fu">max</span>(weight, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb5-494"><a href="#cb5-494" aria-hidden="true" tabindex="-1"></a>        <span class="at">delta_weight =</span> last_weight <span class="sc">-</span> first_weight,</span>
<span id="cb5-495"><a href="#cb5-495" aria-hidden="true" tabindex="-1"></a>        <span class="at">slope =</span> <span class="cf">if</span> (<span class="fu">n</span>() <span class="sc">&gt;</span> <span class="dv">1</span>) {</span>
<span id="cb5-496"><a href="#cb5-496" aria-hidden="true" tabindex="-1"></a>          <span class="fu">coef</span>(<span class="fu">lm</span>(weight <span class="sc">~</span> Time))[<span class="dv">2</span>]</span>
<span id="cb5-497"><a href="#cb5-497" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span> {</span>
<span id="cb5-498"><a href="#cb5-498" aria-hidden="true" tabindex="-1"></a>          <span class="cn">NA_real_</span></span>
<span id="cb5-499"><a href="#cb5-499" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="cb5-500"><a href="#cb5-500" aria-hidden="true" tabindex="-1"></a>        <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb5-501"><a href="#cb5-501" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span></span>
<span id="cb5-502"><a href="#cb5-502" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb5-503"><a href="#cb5-503" aria-hidden="true" tabindex="-1"></a>        <span class="at">slope =</span> <span class="fu">round</span>(slope, <span class="dv">2</span>),</span>
<span id="cb5-504"><a href="#cb5-504" aria-hidden="true" tabindex="-1"></a>        <span class="at">delta_weight =</span> <span class="fu">round</span>(delta_weight, <span class="dv">1</span>),</span>
<span id="cb5-505"><a href="#cb5-505" aria-hidden="true" tabindex="-1"></a>        <span class="at">first_weight =</span> <span class="fu">round</span>(first_weight, <span class="dv">1</span>),</span>
<span id="cb5-506"><a href="#cb5-506" aria-hidden="true" tabindex="-1"></a>        <span class="at">last_weight =</span> <span class="fu">round</span>(last_weight, <span class="dv">1</span>)</span>
<span id="cb5-507"><a href="#cb5-507" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb5-508"><a href="#cb5-508" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb5-509"><a href="#cb5-509" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-510"><a href="#cb5-510" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ----------------------------------------------------------------------------</span></span>
<span id="cb5-511"><a href="#cb5-511" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Observer: Reset Filters</span></span>
<span id="cb5-512"><a href="#cb5-512" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ----------------------------------------------------------------------------</span></span>
<span id="cb5-513"><a href="#cb5-513" aria-hidden="true" tabindex="-1"></a>  <span class="fu">observeEvent</span>(input<span class="sc">$</span>reset, {</span>
<span id="cb5-514"><a href="#cb5-514" aria-hidden="true" tabindex="-1"></a>    <span class="fu">updateCheckboxGroupInput</span>(session, <span class="st">"diet_filter"</span>, <span class="at">selected =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>)</span>
<span id="cb5-515"><a href="#cb5-515" aria-hidden="true" tabindex="-1"></a>    <span class="fu">updateSliderInput</span>(session, <span class="st">"time_range"</span>, <span class="at">value =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">21</span>))</span>
<span id="cb5-516"><a href="#cb5-516" aria-hidden="true" tabindex="-1"></a>    <span class="fu">updateSelectizeInput</span>(session, <span class="st">"chick_highlight"</span>, <span class="at">selected =</span> <span class="fu">character</span>(<span class="dv">0</span>))</span>
<span id="cb5-517"><a href="#cb5-517" aria-hidden="true" tabindex="-1"></a>    <span class="fu">updateCheckboxInput</span>(session, <span class="st">"smoothing"</span>, <span class="at">value =</span> <span class="cn">FALSE</span>)</span>
<span id="cb5-518"><a href="#cb5-518" aria-hidden="true" tabindex="-1"></a>    <span class="fu">updateRadioButtons</span>(session, <span class="st">"scale"</span>, <span class="at">selected =</span> <span class="st">"Linear"</span>)</span>
<span id="cb5-519"><a href="#cb5-519" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb5-520"><a href="#cb5-520" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-521"><a href="#cb5-521" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ----------------------------------------------------------------------------</span></span>
<span id="cb5-522"><a href="#cb5-522" aria-hidden="true" tabindex="-1"></a>  <span class="co"># TAB 1: Overview - Summary Cards</span></span>
<span id="cb5-523"><a href="#cb5-523" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ----------------------------------------------------------------------------</span></span>
<span id="cb5-524"><a href="#cb5-524" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>summary_chicks <span class="ot">&lt;-</span> <span class="fu">renderUI</span>({</span>
<span id="cb5-525"><a href="#cb5-525" aria-hidden="true" tabindex="-1"></a>    n_chicks <span class="ot">&lt;-</span> <span class="fu">filtered_data</span>() <span class="sc">%&gt;%</span> <span class="fu">pull</span>(Chick) <span class="sc">%&gt;%</span> <span class="fu">unique</span>() <span class="sc">%&gt;%</span> <span class="fu">length</span>()</span>
<span id="cb5-526"><a href="#cb5-526" aria-hidden="true" tabindex="-1"></a>    <span class="fu">div</span>(</span>
<span id="cb5-527"><a href="#cb5-527" aria-hidden="true" tabindex="-1"></a>      <span class="at">class =</span> <span class="st">"card text-center"</span>,</span>
<span id="cb5-528"><a href="#cb5-528" aria-hidden="true" tabindex="-1"></a>      <span class="at">style =</span> <span class="st">"background-color: #e3f2fd; padding: 20px;"</span>,</span>
<span id="cb5-529"><a href="#cb5-529" aria-hidden="true" tabindex="-1"></a>      <span class="fu">h3</span>(n_chicks, <span class="at">style =</span> <span class="st">"color: #1976d2; margin: 0;"</span>),</span>
<span id="cb5-530"><a href="#cb5-530" aria-hidden="true" tabindex="-1"></a>      <span class="fu">p</span>(<span class="st">"Visible Chicks"</span>, <span class="at">style =</span> <span class="st">"margin: 5px 0 0 0;"</span>)</span>
<span id="cb5-531"><a href="#cb5-531" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb5-532"><a href="#cb5-532" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb5-533"><a href="#cb5-533" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-534"><a href="#cb5-534" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>summary_weight <span class="ot">&lt;-</span> <span class="fu">renderUI</span>({</span>
<span id="cb5-535"><a href="#cb5-535" aria-hidden="true" tabindex="-1"></a>    avg_terminal <span class="ot">&lt;-</span> <span class="fu">filtered_data</span>() <span class="sc">%&gt;%</span></span>
<span id="cb5-536"><a href="#cb5-536" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(Chick) <span class="sc">%&gt;%</span></span>
<span id="cb5-537"><a href="#cb5-537" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarise</span>(<span class="at">terminal =</span> <span class="fu">max</span>(weight, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb5-538"><a href="#cb5-538" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(terminal) <span class="sc">%&gt;%</span></span>
<span id="cb5-539"><a href="#cb5-539" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mean</span>(<span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb5-540"><a href="#cb5-540" aria-hidden="true" tabindex="-1"></a>      <span class="fu">round</span>(<span class="dv">1</span>)</span>
<span id="cb5-541"><a href="#cb5-541" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-542"><a href="#cb5-542" aria-hidden="true" tabindex="-1"></a>    <span class="fu">div</span>(</span>
<span id="cb5-543"><a href="#cb5-543" aria-hidden="true" tabindex="-1"></a>      <span class="at">class =</span> <span class="st">"card text-center"</span>,</span>
<span id="cb5-544"><a href="#cb5-544" aria-hidden="true" tabindex="-1"></a>      <span class="at">style =</span> <span class="st">"background-color: #f3e5f5; padding: 20px;"</span>,</span>
<span id="cb5-545"><a href="#cb5-545" aria-hidden="true" tabindex="-1"></a>      <span class="fu">h3</span>(<span class="fu">paste0</span>(avg_terminal, <span class="st">" g"</span>), <span class="at">style =</span> <span class="st">"color: #7b1fa2; margin: 0;"</span>),</span>
<span id="cb5-546"><a href="#cb5-546" aria-hidden="true" tabindex="-1"></a>      <span class="fu">p</span>(<span class="st">"Avg Terminal Weight"</span>, <span class="at">style =</span> <span class="st">"margin: 5px 0 0 0;"</span>)</span>
<span id="cb5-547"><a href="#cb5-547" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb5-548"><a href="#cb5-548" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb5-549"><a href="#cb5-549" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-550"><a href="#cb5-550" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>summary_timepoints <span class="ot">&lt;-</span> <span class="fu">renderUI</span>({</span>
<span id="cb5-551"><a href="#cb5-551" aria-hidden="true" tabindex="-1"></a>    n_points <span class="ot">&lt;-</span> <span class="fu">filtered_data</span>() <span class="sc">%&gt;%</span> <span class="fu">pull</span>(Time) <span class="sc">%&gt;%</span> <span class="fu">unique</span>() <span class="sc">%&gt;%</span> <span class="fu">length</span>()</span>
<span id="cb5-552"><a href="#cb5-552" aria-hidden="true" tabindex="-1"></a>    <span class="fu">div</span>(</span>
<span id="cb5-553"><a href="#cb5-553" aria-hidden="true" tabindex="-1"></a>      <span class="at">class =</span> <span class="st">"card text-center"</span>,</span>
<span id="cb5-554"><a href="#cb5-554" aria-hidden="true" tabindex="-1"></a>      <span class="at">style =</span> <span class="st">"background-color: #e8f5e9; padding: 20px;"</span>,</span>
<span id="cb5-555"><a href="#cb5-555" aria-hidden="true" tabindex="-1"></a>      <span class="fu">h3</span>(n_points, <span class="at">style =</span> <span class="st">"color: #388e3c; margin: 0;"</span>),</span>
<span id="cb5-556"><a href="#cb5-556" aria-hidden="true" tabindex="-1"></a>      <span class="fu">p</span>(<span class="st">"Timepoints in Window"</span>, <span class="at">style =</span> <span class="st">"margin: 5px 0 0 0;"</span>)</span>
<span id="cb5-557"><a href="#cb5-557" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb5-558"><a href="#cb5-558" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb5-559"><a href="#cb5-559" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-560"><a href="#cb5-560" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ----------------------------------------------------------------------------</span></span>
<span id="cb5-561"><a href="#cb5-561" aria-hidden="true" tabindex="-1"></a>  <span class="co"># TAB 2: Growth Curves Plot</span></span>
<span id="cb5-562"><a href="#cb5-562" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ----------------------------------------------------------------------------</span></span>
<span id="cb5-563"><a href="#cb5-563" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>growth_empty_state <span class="ot">&lt;-</span> <span class="fu">renderUI</span>({</span>
<span id="cb5-564"><a href="#cb5-564" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">nrow</span>(<span class="fu">filtered_data</span>()) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb5-565"><a href="#cb5-565" aria-hidden="true" tabindex="-1"></a>      <span class="fu">div</span>(</span>
<span id="cb5-566"><a href="#cb5-566" aria-hidden="true" tabindex="-1"></a>        <span class="at">class =</span> <span class="st">"alert alert-warning"</span>,</span>
<span id="cb5-567"><a href="#cb5-567" aria-hidden="true" tabindex="-1"></a>        <span class="fu">icon</span>(<span class="st">"triangle-exclamation"</span>),</span>
<span id="cb5-568"><a href="#cb5-568" aria-hidden="true" tabindex="-1"></a>        <span class="st">" No data available with current filter settings. Try adjusting the filters."</span></span>
<span id="cb5-569"><a href="#cb5-569" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb5-570"><a href="#cb5-570" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb5-571"><a href="#cb5-571" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb5-572"><a href="#cb5-572" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-573"><a href="#cb5-573" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>growth_plot <span class="ot">&lt;-</span> <span class="fu">renderPlotly</span>({</span>
<span id="cb5-574"><a href="#cb5-574" aria-hidden="true" tabindex="-1"></a>    <span class="fu">req</span>(<span class="fu">nrow</span>(<span class="fu">filtered_data</span>()) <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb5-575"><a href="#cb5-575" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-576"><a href="#cb5-576" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Prepare data with highlighting</span></span>
<span id="cb5-577"><a href="#cb5-577" aria-hidden="true" tabindex="-1"></a>    plot_data <span class="ot">&lt;-</span> <span class="fu">filtered_data</span>() <span class="sc">%&gt;%</span></span>
<span id="cb5-578"><a href="#cb5-578" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb5-579"><a href="#cb5-579" aria-hidden="true" tabindex="-1"></a>        <span class="at">highlight =</span> <span class="cf">if</span> (<span class="fu">length</span>(<span class="fu">highlighted_chicks</span>()) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb5-580"><a href="#cb5-580" aria-hidden="true" tabindex="-1"></a>          Chick <span class="sc">%in%</span> <span class="fu">highlighted_chicks</span>()</span>
<span id="cb5-581"><a href="#cb5-581" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span> {</span>
<span id="cb5-582"><a href="#cb5-582" aria-hidden="true" tabindex="-1"></a>          <span class="cn">FALSE</span></span>
<span id="cb5-583"><a href="#cb5-583" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="cb5-584"><a href="#cb5-584" aria-hidden="true" tabindex="-1"></a>        <span class="at">alpha_val =</span> <span class="fu">ifelse</span>(highlight, <span class="dv">1</span>, <span class="fl">0.4</span>),</span>
<span id="cb5-585"><a href="#cb5-585" aria-hidden="true" tabindex="-1"></a>        <span class="at">size_val =</span> <span class="fu">ifelse</span>(highlight, <span class="fl">1.2</span>, <span class="fl">0.6</span>)</span>
<span id="cb5-586"><a href="#cb5-586" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb5-587"><a href="#cb5-587" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-588"><a href="#cb5-588" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add slope to hover text</span></span>
<span id="cb5-589"><a href="#cb5-589" aria-hidden="true" tabindex="-1"></a>    slope_data <span class="ot">&lt;-</span> <span class="fu">summary_table</span>() <span class="sc">%&gt;%</span></span>
<span id="cb5-590"><a href="#cb5-590" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(Chick, slope)</span>
<span id="cb5-591"><a href="#cb5-591" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-592"><a href="#cb5-592" aria-hidden="true" tabindex="-1"></a>    plot_data <span class="ot">&lt;-</span> plot_data <span class="sc">%&gt;%</span></span>
<span id="cb5-593"><a href="#cb5-593" aria-hidden="true" tabindex="-1"></a>      <span class="fu">left_join</span>(slope_data, <span class="at">by =</span> <span class="st">"Chick"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb5-594"><a href="#cb5-594" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb5-595"><a href="#cb5-595" aria-hidden="true" tabindex="-1"></a>        <span class="at">hover_text =</span> <span class="fu">paste0</span>(</span>
<span id="cb5-596"><a href="#cb5-596" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Chick: "</span>, Chick, <span class="st">"&lt;br&gt;"</span>,</span>
<span id="cb5-597"><a href="#cb5-597" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Diet: "</span>, Diet, <span class="st">"&lt;br&gt;"</span>,</span>
<span id="cb5-598"><a href="#cb5-598" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Time: "</span>, Time, <span class="st">" days&lt;br&gt;"</span>,</span>
<span id="cb5-599"><a href="#cb5-599" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Weight: "</span>, <span class="fu">round</span>(weight, <span class="dv">1</span>), <span class="st">" g&lt;br&gt;"</span>,</span>
<span id="cb5-600"><a href="#cb5-600" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Slope: "</span>, <span class="fu">ifelse</span>(<span class="sc">!</span><span class="fu">is.na</span>(slope), <span class="fu">paste0</span>(slope, <span class="st">" g/day"</span>), <span class="st">"N/A"</span>)</span>
<span id="cb5-601"><a href="#cb5-601" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb5-602"><a href="#cb5-602" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb5-603"><a href="#cb5-603" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-604"><a href="#cb5-604" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Base plot</span></span>
<span id="cb5-605"><a href="#cb5-605" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(plot_data, <span class="fu">aes</span>(<span class="at">x =</span> Time, <span class="at">y =</span> weight, <span class="at">group =</span> Chick, <span class="at">color =</span> <span class="fu">factor</span>(Diet))) <span class="sc">+</span></span>
<span id="cb5-606"><a href="#cb5-606" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">alpha =</span> alpha_val, <span class="at">size =</span> size_val, <span class="at">text =</span> hover_text)) <span class="sc">+</span></span>
<span id="cb5-607"><a href="#cb5-607" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_alpha_identity</span>() <span class="sc">+</span></span>
<span id="cb5-608"><a href="#cb5-608" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_size_identity</span>() <span class="sc">+</span></span>
<span id="cb5-609"><a href="#cb5-609" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">"Set1"</span>, <span class="at">name =</span> <span class="st">"Diet"</span>) <span class="sc">+</span></span>
<span id="cb5-610"><a href="#cb5-610" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(</span>
<span id="cb5-611"><a href="#cb5-611" aria-hidden="true" tabindex="-1"></a>        <span class="at">title =</span> <span class="st">"Chick Growth Trajectories"</span>,</span>
<span id="cb5-612"><a href="#cb5-612" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="st">"Time (days)"</span>,</span>
<span id="cb5-613"><a href="#cb5-613" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> <span class="st">"Weight (grams)"</span></span>
<span id="cb5-614"><a href="#cb5-614" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb5-615"><a href="#cb5-615" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span></span>
<span id="cb5-616"><a href="#cb5-616" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"right"</span>)</span>
<span id="cb5-617"><a href="#cb5-617" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-618"><a href="#cb5-618" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add LOESS smoothing if requested</span></span>
<span id="cb5-619"><a href="#cb5-619" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (input<span class="sc">$</span>smoothing) {</span>
<span id="cb5-620"><a href="#cb5-620" aria-hidden="true" tabindex="-1"></a>      p <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">geom_smooth</span>(</span>
<span id="cb5-621"><a href="#cb5-621" aria-hidden="true" tabindex="-1"></a>        <span class="fu">aes</span>(<span class="at">group =</span> Diet, <span class="at">color =</span> <span class="fu">factor</span>(Diet)),</span>
<span id="cb5-622"><a href="#cb5-622" aria-hidden="true" tabindex="-1"></a>        <span class="at">method =</span> <span class="st">"loess"</span>,</span>
<span id="cb5-623"><a href="#cb5-623" aria-hidden="true" tabindex="-1"></a>        <span class="at">se =</span> <span class="cn">TRUE</span>,</span>
<span id="cb5-624"><a href="#cb5-624" aria-hidden="true" tabindex="-1"></a>        <span class="at">alpha =</span> <span class="fl">0.2</span>,</span>
<span id="cb5-625"><a href="#cb5-625" aria-hidden="true" tabindex="-1"></a>        <span class="at">linewidth =</span> <span class="fl">1.5</span>,</span>
<span id="cb5-626"><a href="#cb5-626" aria-hidden="true" tabindex="-1"></a>        <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>,</span>
<span id="cb5-627"><a href="#cb5-627" aria-hidden="true" tabindex="-1"></a>        <span class="at">data =</span> <span class="fu">filtered_data</span>() <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Diet =</span> <span class="fu">factor</span>(Diet))</span>
<span id="cb5-628"><a href="#cb5-628" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb5-629"><a href="#cb5-629" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb5-630"><a href="#cb5-630" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-631"><a href="#cb5-631" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Apply scale transformation</span></span>
<span id="cb5-632"><a href="#cb5-632" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (input<span class="sc">$</span>scale <span class="sc">==</span> <span class="st">"Log10"</span>) {</span>
<span id="cb5-633"><a href="#cb5-633" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Filter out non-positive weights for log scale</span></span>
<span id="cb5-634"><a href="#cb5-634" aria-hidden="true" tabindex="-1"></a>      plot_data_log <span class="ot">&lt;-</span> plot_data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(weight <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb5-635"><a href="#cb5-635" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="fu">nrow</span>(plot_data_log) <span class="sc">&lt;</span> <span class="fu">nrow</span>(plot_data)) {</span>
<span id="cb5-636"><a href="#cb5-636" aria-hidden="true" tabindex="-1"></a>        <span class="fu">showNotification</span>(<span class="st">"Some weights ≤ 0 were excluded for log scale."</span>, <span class="at">type =</span> <span class="st">"warning"</span>)</span>
<span id="cb5-637"><a href="#cb5-637" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb5-638"><a href="#cb5-638" aria-hidden="true" tabindex="-1"></a>      p <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">scale_y_log10</span>()</span>
<span id="cb5-639"><a href="#cb5-639" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb5-640"><a href="#cb5-640" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-641"><a href="#cb5-641" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert to plotly for interactivity</span></span>
<span id="cb5-642"><a href="#cb5-642" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplotly</span>(p, <span class="at">tooltip =</span> <span class="st">"text"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb5-643"><a href="#cb5-643" aria-hidden="true" tabindex="-1"></a>      <span class="fu">layout</span>(<span class="at">hovermode =</span> <span class="st">"closest"</span>)</span>
<span id="cb5-644"><a href="#cb5-644" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb5-645"><a href="#cb5-645" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-646"><a href="#cb5-646" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ----------------------------------------------------------------------------</span></span>
<span id="cb5-647"><a href="#cb5-647" aria-hidden="true" tabindex="-1"></a>  <span class="co"># TAB 3: Diet Comparison</span></span>
<span id="cb5-648"><a href="#cb5-648" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ----------------------------------------------------------------------------</span></span>
<span id="cb5-649"><a href="#cb5-649" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>diet_empty_state <span class="ot">&lt;-</span> <span class="fu">renderUI</span>({</span>
<span id="cb5-650"><a href="#cb5-650" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">nrow</span>(<span class="fu">filtered_data</span>()) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb5-651"><a href="#cb5-651" aria-hidden="true" tabindex="-1"></a>      <span class="fu">div</span>(</span>
<span id="cb5-652"><a href="#cb5-652" aria-hidden="true" tabindex="-1"></a>        <span class="at">class =</span> <span class="st">"alert alert-warning"</span>,</span>
<span id="cb5-653"><a href="#cb5-653" aria-hidden="true" tabindex="-1"></a>        <span class="fu">icon</span>(<span class="st">"triangle-exclamation"</span>),</span>
<span id="cb5-654"><a href="#cb5-654" aria-hidden="true" tabindex="-1"></a>        <span class="st">" No data available with current filter settings. Try adjusting the filters."</span></span>
<span id="cb5-655"><a href="#cb5-655" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb5-656"><a href="#cb5-656" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb5-657"><a href="#cb5-657" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb5-658"><a href="#cb5-658" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-659"><a href="#cb5-659" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>diet_boxplot <span class="ot">&lt;-</span> <span class="fu">renderPlotly</span>({</span>
<span id="cb5-660"><a href="#cb5-660" aria-hidden="true" tabindex="-1"></a>    <span class="fu">req</span>(<span class="fu">nrow</span>(<span class="fu">filtered_data</span>()) <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb5-661"><a href="#cb5-661" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-662"><a href="#cb5-662" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get final weight per chick</span></span>
<span id="cb5-663"><a href="#cb5-663" aria-hidden="true" tabindex="-1"></a>    final_weights <span class="ot">&lt;-</span> <span class="fu">filtered_data</span>() <span class="sc">%&gt;%</span></span>
<span id="cb5-664"><a href="#cb5-664" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(Chick, Diet) <span class="sc">%&gt;%</span></span>
<span id="cb5-665"><a href="#cb5-665" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarise</span>(<span class="at">final_weight =</span> <span class="fu">max</span>(weight, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb5-666"><a href="#cb5-666" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-667"><a href="#cb5-667" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(final_weights, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">factor</span>(Diet), <span class="at">y =</span> final_weight, <span class="at">fill =</span> <span class="fu">factor</span>(Diet))) <span class="sc">+</span></span>
<span id="cb5-668"><a href="#cb5-668" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_violin</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb5-669"><a href="#cb5-669" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_boxplot</span>(<span class="at">width =</span> <span class="fl">0.2</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>, <span class="at">outlier.shape =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb5-670"><a href="#cb5-670" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_jitter</span>(<span class="at">width =</span> <span class="fl">0.1</span>, <span class="at">alpha =</span> <span class="fl">0.4</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb5-671"><a href="#cb5-671" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">"Set1"</span>, <span class="at">name =</span> <span class="st">"Diet"</span>) <span class="sc">+</span></span>
<span id="cb5-672"><a href="#cb5-672" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(</span>
<span id="cb5-673"><a href="#cb5-673" aria-hidden="true" tabindex="-1"></a>        <span class="at">title =</span> <span class="st">"Final Weight Distribution by Diet"</span>,</span>
<span id="cb5-674"><a href="#cb5-674" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="st">"Diet"</span>,</span>
<span id="cb5-675"><a href="#cb5-675" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> <span class="st">"Final Weight (grams)"</span></span>
<span id="cb5-676"><a href="#cb5-676" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb5-677"><a href="#cb5-677" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span></span>
<span id="cb5-678"><a href="#cb5-678" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb5-679"><a href="#cb5-679" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-680"><a href="#cb5-680" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplotly</span>(p) <span class="sc">%&gt;%</span></span>
<span id="cb5-681"><a href="#cb5-681" aria-hidden="true" tabindex="-1"></a>      <span class="fu">layout</span>(<span class="at">hovermode =</span> <span class="st">"closest"</span>)</span>
<span id="cb5-682"><a href="#cb5-682" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb5-683"><a href="#cb5-683" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-684"><a href="#cb5-684" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>diet_barplot <span class="ot">&lt;-</span> <span class="fu">renderPlotly</span>({</span>
<span id="cb5-685"><a href="#cb5-685" aria-hidden="true" tabindex="-1"></a>    <span class="fu">req</span>(<span class="fu">nrow</span>(<span class="fu">filtered_data</span>()) <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb5-686"><a href="#cb5-686" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-687"><a href="#cb5-687" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Mean delta weight by diet</span></span>
<span id="cb5-688"><a href="#cb5-688" aria-hidden="true" tabindex="-1"></a>    diet_summary <span class="ot">&lt;-</span> <span class="fu">summary_table</span>() <span class="sc">%&gt;%</span></span>
<span id="cb5-689"><a href="#cb5-689" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(Diet) <span class="sc">%&gt;%</span></span>
<span id="cb5-690"><a href="#cb5-690" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarise</span>(</span>
<span id="cb5-691"><a href="#cb5-691" aria-hidden="true" tabindex="-1"></a>        <span class="at">mean_delta =</span> <span class="fu">mean</span>(delta_weight, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb5-692"><a href="#cb5-692" aria-hidden="true" tabindex="-1"></a>        <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb5-693"><a href="#cb5-693" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span></span>
<span id="cb5-694"><a href="#cb5-694" aria-hidden="true" tabindex="-1"></a>      <span class="fu">arrange</span>(<span class="fu">desc</span>(mean_delta))</span>
<span id="cb5-695"><a href="#cb5-695" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-696"><a href="#cb5-696" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(diet_summary, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(<span class="fu">factor</span>(Diet), mean_delta), <span class="at">y =</span> mean_delta, <span class="at">fill =</span> <span class="fu">factor</span>(Diet))) <span class="sc">+</span></span>
<span id="cb5-697"><a href="#cb5-697" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_col</span>(<span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb5-698"><a href="#cb5-698" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">round</span>(mean_delta, <span class="dv">1</span>)), <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb5-699"><a href="#cb5-699" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">"Set1"</span>, <span class="at">name =</span> <span class="st">"Diet"</span>) <span class="sc">+</span></span>
<span id="cb5-700"><a href="#cb5-700" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(</span>
<span id="cb5-701"><a href="#cb5-701" aria-hidden="true" tabindex="-1"></a>        <span class="at">title =</span> <span class="st">"Mean Weight Gain by Diet"</span>,</span>
<span id="cb5-702"><a href="#cb5-702" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="st">"Diet (ranked)"</span>,</span>
<span id="cb5-703"><a href="#cb5-703" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> <span class="st">"Mean Δ Weight (grams)"</span></span>
<span id="cb5-704"><a href="#cb5-704" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb5-705"><a href="#cb5-705" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span></span>
<span id="cb5-706"><a href="#cb5-706" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb5-707"><a href="#cb5-707" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-708"><a href="#cb5-708" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplotly</span>(p) <span class="sc">%&gt;%</span></span>
<span id="cb5-709"><a href="#cb5-709" aria-hidden="true" tabindex="-1"></a>      <span class="fu">layout</span>(<span class="at">hovermode =</span> <span class="st">"closest"</span>)</span>
<span id="cb5-710"><a href="#cb5-710" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb5-711"><a href="#cb5-711" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-712"><a href="#cb5-712" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ----------------------------------------------------------------------------</span></span>
<span id="cb5-713"><a href="#cb5-713" aria-hidden="true" tabindex="-1"></a>  <span class="co"># TAB 4: Chick Table</span></span>
<span id="cb5-714"><a href="#cb5-714" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ----------------------------------------------------------------------------</span></span>
<span id="cb5-715"><a href="#cb5-715" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>chick_table <span class="ot">&lt;-</span> <span class="fu">renderDT</span>({</span>
<span id="cb5-716"><a href="#cb5-716" aria-hidden="true" tabindex="-1"></a>    <span class="fu">req</span>(<span class="fu">nrow</span>(<span class="fu">summary_table</span>()) <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb5-717"><a href="#cb5-717" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-718"><a href="#cb5-718" aria-hidden="true" tabindex="-1"></a>    <span class="fu">datatable</span>(</span>
<span id="cb5-719"><a href="#cb5-719" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summary_table</span>(),</span>
<span id="cb5-720"><a href="#cb5-720" aria-hidden="true" tabindex="-1"></a>      <span class="at">options =</span> <span class="fu">list</span>(</span>
<span id="cb5-721"><a href="#cb5-721" aria-hidden="true" tabindex="-1"></a>        <span class="at">pageLength =</span> <span class="dv">15</span>,</span>
<span id="cb5-722"><a href="#cb5-722" aria-hidden="true" tabindex="-1"></a>        <span class="at">searching =</span> <span class="cn">TRUE</span>,</span>
<span id="cb5-723"><a href="#cb5-723" aria-hidden="true" tabindex="-1"></a>        <span class="at">ordering =</span> <span class="cn">TRUE</span>,</span>
<span id="cb5-724"><a href="#cb5-724" aria-hidden="true" tabindex="-1"></a>        <span class="at">dom =</span> <span class="st">'frtip'</span></span>
<span id="cb5-725"><a href="#cb5-725" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb5-726"><a href="#cb5-726" aria-hidden="true" tabindex="-1"></a>      <span class="at">selection =</span> <span class="st">"multiple"</span>,</span>
<span id="cb5-727"><a href="#cb5-727" aria-hidden="true" tabindex="-1"></a>      <span class="at">rownames =</span> <span class="cn">FALSE</span>,</span>
<span id="cb5-728"><a href="#cb5-728" aria-hidden="true" tabindex="-1"></a>      <span class="at">colnames =</span> <span class="fu">c</span>(</span>
<span id="cb5-729"><a href="#cb5-729" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Chick"</span>, <span class="st">"Diet"</span>, <span class="st">"N Timepoints"</span>, <span class="st">"First Weight (g)"</span>,</span>
<span id="cb5-730"><a href="#cb5-730" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Last Weight (g)"</span>, <span class="st">"Δ Weight (g)"</span>, <span class="st">"Slope (g/day)"</span></span>
<span id="cb5-731"><a href="#cb5-731" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb5-732"><a href="#cb5-732" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb5-733"><a href="#cb5-733" aria-hidden="true" tabindex="-1"></a>      <span class="fu">formatStyle</span>(</span>
<span id="cb5-734"><a href="#cb5-734" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Chick"</span>,</span>
<span id="cb5-735"><a href="#cb5-735" aria-hidden="true" tabindex="-1"></a>        <span class="at">target =</span> <span class="st">"row"</span>,</span>
<span id="cb5-736"><a href="#cb5-736" aria-hidden="true" tabindex="-1"></a>        <span class="at">backgroundColor =</span> <span class="fu">styleEqual</span>(</span>
<span id="cb5-737"><a href="#cb5-737" aria-hidden="true" tabindex="-1"></a>          <span class="fu">highlighted_chicks</span>(),</span>
<span id="cb5-738"><a href="#cb5-738" aria-hidden="true" tabindex="-1"></a>          <span class="fu">rep</span>(<span class="st">"lightyellow"</span>, <span class="fu">length</span>(<span class="fu">highlighted_chicks</span>()))</span>
<span id="cb5-739"><a href="#cb5-739" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb5-740"><a href="#cb5-740" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb5-741"><a href="#cb5-741" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb5-742"><a href="#cb5-742" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-743"><a href="#cb5-743" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Download handler for table</span></span>
<span id="cb5-744"><a href="#cb5-744" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>download_table <span class="ot">&lt;-</span> <span class="fu">downloadHandler</span>(</span>
<span id="cb5-745"><a href="#cb5-745" aria-hidden="true" tabindex="-1"></a>    <span class="at">filename =</span> <span class="cf">function</span>() {</span>
<span id="cb5-746"><a href="#cb5-746" aria-hidden="true" tabindex="-1"></a>      <span class="fu">paste0</span>(<span class="st">"chick_summary_"</span>, <span class="fu">Sys.Date</span>(), <span class="st">".csv"</span>)</span>
<span id="cb5-747"><a href="#cb5-747" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb5-748"><a href="#cb5-748" aria-hidden="true" tabindex="-1"></a>    <span class="at">content =</span> <span class="cf">function</span>(file) {</span>
<span id="cb5-749"><a href="#cb5-749" aria-hidden="true" tabindex="-1"></a>      <span class="fu">write.csv</span>(<span class="fu">summary_table</span>(), file, <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span>
<span id="cb5-750"><a href="#cb5-750" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb5-751"><a href="#cb5-751" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb5-752"><a href="#cb5-752" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-753"><a href="#cb5-753" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-754"><a href="#cb5-754" aria-hidden="true" tabindex="-1"></a><span class="co"># ==============================================================================</span></span>
<span id="cb5-755"><a href="#cb5-755" aria-hidden="true" tabindex="-1"></a><span class="co"># Run the App</span></span>
<span id="cb5-756"><a href="#cb5-756" aria-hidden="true" tabindex="-1"></a><span class="co"># ==============================================================================</span></span>
<span id="cb5-757"><a href="#cb5-757" aria-hidden="true" tabindex="-1"></a><span class="fu">shinyApp</span>(<span class="at">ui =</span> ui, <span class="at">server =</span> server)</span>
<span id="cb5-758"><a href="#cb5-758" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-759"><a href="#cb5-759" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb5-760"><a href="#cb5-760" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-761"><a href="#cb5-761" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb5-762"><a href="#cb5-762" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-763"><a href="#cb5-763" aria-hidden="true" tabindex="-1"></a><span class="fu">### Screenshots of ChickWeight App</span></span>
<span id="cb5-764"><a href="#cb5-764" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-765"><a href="#cb5-765" aria-hidden="true" tabindex="-1"></a>::: {.callout-note collapse="true"}</span>
<span id="cb5-766"><a href="#cb5-766" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-767"><a href="#cb5-767" aria-hidden="true" tabindex="-1"></a><span class="fu">## First tab: Overview</span></span>
<span id="cb5-768"><a href="#cb5-768" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-769"><a href="#cb5-769" aria-hidden="true" tabindex="-1"></a><span class="al">![](screenshots/cw_0.png)</span>{fig-align="center"}</span>
<span id="cb5-770"><a href="#cb5-770" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-771"><a href="#cb5-771" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb5-772"><a href="#cb5-772" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-773"><a href="#cb5-773" aria-hidden="true" tabindex="-1"></a>::: {.callout-note collapse="true"}</span>
<span id="cb5-774"><a href="#cb5-774" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-775"><a href="#cb5-775" aria-hidden="true" tabindex="-1"></a><span class="fu">## Second tab: Growth Curves</span></span>
<span id="cb5-776"><a href="#cb5-776" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-777"><a href="#cb5-777" aria-hidden="true" tabindex="-1"></a><span class="al">![](screenshots/cw_1.png)</span>{fig-align="center"}</span>
<span id="cb5-778"><a href="#cb5-778" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-779"><a href="#cb5-779" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb5-780"><a href="#cb5-780" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-781"><a href="#cb5-781" aria-hidden="true" tabindex="-1"></a>::: {.callout-note collapse="true"}</span>
<span id="cb5-782"><a href="#cb5-782" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-783"><a href="#cb5-783" aria-hidden="true" tabindex="-1"></a><span class="fu">## Third tab: Diet Comparison Plots</span></span>
<span id="cb5-784"><a href="#cb5-784" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-785"><a href="#cb5-785" aria-hidden="true" tabindex="-1"></a><span class="al">![](screenshots/cw_2.png)</span>{fig-align="center"}</span>
<span id="cb5-786"><a href="#cb5-786" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-787"><a href="#cb5-787" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb5-788"><a href="#cb5-788" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-789"><a href="#cb5-789" aria-hidden="true" tabindex="-1"></a>::: {.callout-note collapse="true"}</span>
<span id="cb5-790"><a href="#cb5-790" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-791"><a href="#cb5-791" aria-hidden="true" tabindex="-1"></a><span class="fu">## Fourth tab: CSV Download</span></span>
<span id="cb5-792"><a href="#cb5-792" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-793"><a href="#cb5-793" aria-hidden="true" tabindex="-1"></a><span class="al">![](screenshots/cw_3.png)</span>{fig-align="center"}</span>
<span id="cb5-794"><a href="#cb5-794" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-795"><a href="#cb5-795" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb5-796"><a href="#cb5-796" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-797"><a href="#cb5-797" aria-hidden="true" tabindex="-1"></a>::: {.callout-note collapse="true"}</span>
<span id="cb5-798"><a href="#cb5-798" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-799"><a href="#cb5-799" aria-hidden="true" tabindex="-1"></a><span class="fu">## Fifth tab: About/Help Page</span></span>
<span id="cb5-800"><a href="#cb5-800" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-801"><a href="#cb5-801" aria-hidden="true" tabindex="-1"></a><span class="al">![](screenshots/cw_4.png)</span>{fig-align="center"}</span>
<span id="cb5-802"><a href="#cb5-802" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-803"><a href="#cb5-803" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb5-804"><a href="#cb5-804" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-805"><a href="#cb5-805" aria-hidden="true" tabindex="-1"></a><span class="fu">## Integrating LLM Calls in an App</span></span>
<span id="cb5-806"><a href="#cb5-806" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-807"><a href="#cb5-807" aria-hidden="true" tabindex="-1"></a>Now let's pull together a few of the things you learned today and build an app that integrates calling an LLM! This purpose of this simple app is to help educators / test developers generate items given certain parameters - student grade level and school subject.</span>
<span id="cb5-808"><a href="#cb5-808" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-809"><a href="#cb5-809" aria-hidden="true" tabindex="-1"></a>When developing a prompt for vibe coding, I often ask a model to help me improve my first prompt.</span>
<span id="cb5-810"><a href="#cb5-810" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-811"><a href="#cb5-811" aria-hidden="true" tabindex="-1"></a>::: {.callout-note collapse="true"}</span>
<span id="cb5-812"><a href="#cb5-812" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-813"><a href="#cb5-813" aria-hidden="true" tabindex="-1"></a><span class="fu">## Initial Prompt that I wrote:</span></span>
<span id="cb5-814"><a href="#cb5-814" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-815"><a href="#cb5-815" aria-hidden="true" tabindex="-1"></a>Prompt:</span>
<span id="cb5-816"><a href="#cb5-816" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-817"><a href="#cb5-817" aria-hidden="true" tabindex="-1"></a>I want to make an R Shiny app to facilitate making multiple-choice questions for a variety of grade levels for a variety of subjects. </span>
<span id="cb5-818"><a href="#cb5-818" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-819"><a href="#cb5-819" aria-hidden="true" tabindex="-1"></a>On the left is a drop-down menu is has two selectable options: grade level (1st, 3rd, 5th, 7th) and topic (geography, science, social studies). </span>
<span id="cb5-820"><a href="#cb5-820" aria-hidden="true" tabindex="-1"></a>This will serve to an input for a function that will call a generative AI model to generate a multiple-choice item based on the selected topic that is appropriate for the selected grade level. </span>
<span id="cb5-821"><a href="#cb5-821" aria-hidden="true" tabindex="-1"></a>The generative AI model will return a question <span class="co">[</span><span class="ot">question</span><span class="co">]</span>, 5 answer options <span class="co">[</span><span class="ot">option A : option E</span><span class="co">]</span>, and the repeat the correct answer option <span class="co">[</span><span class="ot">correct answer : </span><span class="co">]</span>. Here is an example:</span>
<span id="cb5-822"><a href="#cb5-822" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-823"><a href="#cb5-823" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">Question : What is the main source of energy for the water cycle?</span><span class="co">]</span>\n<span class="co">[</span><span class="ot">Option A : The Moon</span><span class="co">]</span>\n<span class="co">[</span><span class="ot">Option B : The Sun</span><span class="co">]</span>\n<span class="co">[</span><span class="ot">Option C : The Wind</span><span class="co">]</span>\n<span class="co">[</span><span class="ot">Option D : The Earth's Core</span><span class="co">]</span>\n<span class="co">[</span><span class="ot">Option E : Ocean Currents</span><span class="co">]</span>\n<span class="co">[</span><span class="ot">Correct Answer : Option B : The Sun</span><span class="co">]</span></span>
<span id="cb5-824"><a href="#cb5-824" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-825"><a href="#cb5-825" aria-hidden="true" tabindex="-1"></a>In the second column: Those responses will each populate in a different text box column that corresponds to the LLM output (question, option A, option B, option C, option D, option E, correct answer) with instructions to the user to "change the item as desired". </span>
<span id="cb5-826"><a href="#cb5-826" aria-hidden="true" tabindex="-1"></a>The user can then makes changes if they would like, and then re-submit the item. </span>
<span id="cb5-827"><a href="#cb5-827" aria-hidden="true" tabindex="-1"></a>Alternatively, if the user does not want to make changes or is happy with the submitted changes, the user can select "submit item" which will then save the item to a certain location on the computer.</span>
<span id="cb5-828"><a href="#cb5-828" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-829"><a href="#cb5-829" aria-hidden="true" tabindex="-1"></a>I want the user to ask the app to re-generate parts of an MCQ question. So the user can "save" or "lock" aspects of the LLM response (such as the item stem or some of the responses). I also want the user to be able to provide instructions to the LLM when asking for the item to be re-generated. So if the item is on volcanos and the LLM make an item about their location, the user can say "focus the question on lava" and the LLM will take this information and re-generate the item.</span>
<span id="cb5-830"><a href="#cb5-830" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-831"><a href="#cb5-831" aria-hidden="true" tabindex="-1"></a>There should be two user input option buttons after finishing the task. "Update item" where the submitted information becomes the pre-populated item info, or "Save Item" when the information is satisfactory and should be saved.</span>
<span id="cb5-832"><a href="#cb5-832" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-833"><a href="#cb5-833" aria-hidden="true" tabindex="-1"></a>Once the user selects "Save Item" when the item is finished, I would like this information saved to a list in R. </span>
<span id="cb5-834"><a href="#cb5-834" aria-hidden="true" tabindex="-1"></a>So whatever is in the "Question" text box is written to a list entry called question, whatever is in the "Option A" text box is written to a list called optionA, and so on.</span>
<span id="cb5-835"><a href="#cb5-835" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-836"><a href="#cb5-836" aria-hidden="true" tabindex="-1"></a>Write that syntax.</span>
<span id="cb5-837"><a href="#cb5-837" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-838"><a href="#cb5-838" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb5-839"><a href="#cb5-839" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-840"><a href="#cb5-840" aria-hidden="true" tabindex="-1"></a>::: {.callout-note collapse="true"}</span>
<span id="cb5-841"><a href="#cb5-841" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-842"><a href="#cb5-842" aria-hidden="true" tabindex="-1"></a><span class="fu">## The prompt to the LLM to improve the prompt</span></span>
<span id="cb5-843"><a href="#cb5-843" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-844"><a href="#cb5-844" aria-hidden="true" tabindex="-1"></a>Here's a prompt to ask an LLM to build an app that I'd like to include as an example for my workshop. Your task is to review the prompt and make improvements to it's organization, language, and structure so it's more appropriate to serve as an LLM prompt. Please ask clarifying questions after reviewing the prompt if it will help you in your refinement. The prompt:</span>
<span id="cb5-845"><a href="#cb5-845" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-846"><a href="#cb5-846" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb5-847"><a href="#cb5-847" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-848"><a href="#cb5-848" aria-hidden="true" tabindex="-1"></a>::: {.callout-note collapse="true"}</span>
<span id="cb5-849"><a href="#cb5-849" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-850"><a href="#cb5-850" aria-hidden="true" tabindex="-1"></a><span class="fu">## Final LLM-assisted Prompt</span></span>
<span id="cb5-851"><a href="#cb5-851" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-852"><a href="#cb5-852" aria-hidden="true" tabindex="-1"></a>You are an expert R Shiny developer.</span>
<span id="cb5-853"><a href="#cb5-853" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-854"><a href="#cb5-854" aria-hidden="true" tabindex="-1"></a>Build a complete, runnable single-file R Shiny app (app.R) that helps users generate, edit, and save multiple-choice questions (MCQs) by grade level and subject.</span>
<span id="cb5-855"><a href="#cb5-855" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-856"><a href="#cb5-856" aria-hidden="true" tabindex="-1"></a>**🎯 Goals**</span>
<span id="cb5-857"><a href="#cb5-857" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-858"><a href="#cb5-858" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Let users select a Grade Level and Subject.</span>
<span id="cb5-859"><a href="#cb5-859" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Call a generative AI helper function to produce a question and five answer options (A–E), plus the correct answer.</span>
<span id="cb5-860"><a href="#cb5-860" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Display the generated text in editable text boxes so users can make changes.</span>
<span id="cb5-861"><a href="#cb5-861" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Provide two buttons:</span>
<span id="cb5-862"><a href="#cb5-862" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>"Update item" – commits edited text to the current item.</span>
<span id="cb5-863"><a href="#cb5-863" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>"Save item" – appends the finalized item to a persistent list stored in the app's working directory.</span>
<span id="cb5-864"><a href="#cb5-864" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Store all items (including Grade and Subject metadata) in an .rds file named saved_items.rds.</span>
<span id="cb5-865"><a href="#cb5-865" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-866"><a href="#cb5-866" aria-hidden="true" tabindex="-1"></a>**⚙️ App Specifications**</span>
<span id="cb5-867"><a href="#cb5-867" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-868"><a href="#cb5-868" aria-hidden="true" tabindex="-1"></a>**UI**</span>
<span id="cb5-869"><a href="#cb5-869" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-870"><a href="#cb5-870" aria-hidden="true" tabindex="-1"></a>**Left sidebar:**</span>
<span id="cb5-871"><a href="#cb5-871" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-872"><a href="#cb5-872" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`selectInput("grade", "Grade Level", choices = c("1st", "3rd", "5th", "7th"))`</span></span>
<span id="cb5-873"><a href="#cb5-873" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`selectInput("subject", "Subject", choices = c("Geography", "Science", "Social Studies"))`</span></span>
<span id="cb5-874"><a href="#cb5-874" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`actionButton("generate", "Generate Item")`</span></span>
<span id="cb5-875"><a href="#cb5-875" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-876"><a href="#cb5-876" aria-hidden="true" tabindex="-1"></a>**Main panel:**</span>
<span id="cb5-877"><a href="#cb5-877" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-878"><a href="#cb5-878" aria-hidden="true" tabindex="-1"></a>Editable text boxes for:</span>
<span id="cb5-879"><a href="#cb5-879" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-880"><a href="#cb5-880" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Question</span>
<span id="cb5-881"><a href="#cb5-881" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Option A</span>
<span id="cb5-882"><a href="#cb5-882" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Option B</span>
<span id="cb5-883"><a href="#cb5-883" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Option C</span>
<span id="cb5-884"><a href="#cb5-884" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Option D</span>
<span id="cb5-885"><a href="#cb5-885" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Option E</span>
<span id="cb5-886"><a href="#cb5-886" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Correct Answer</span>
<span id="cb5-887"><a href="#cb5-887" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-888"><a href="#cb5-888" aria-hidden="true" tabindex="-1"></a>(Each labeled clearly with a hint: "Change the item as desired.")</span>
<span id="cb5-889"><a href="#cb5-889" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-890"><a href="#cb5-890" aria-hidden="true" tabindex="-1"></a>**Action buttons:**</span>
<span id="cb5-891"><a href="#cb5-891" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-892"><a href="#cb5-892" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`actionButton("update_item", "Update Item")`</span></span>
<span id="cb5-893"><a href="#cb5-893" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`actionButton("save_item", "Save Item")`</span></span>
<span id="cb5-894"><a href="#cb5-894" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-895"><a href="#cb5-895" aria-hidden="true" tabindex="-1"></a>**Display area showing:**</span>
<span id="cb5-896"><a href="#cb5-896" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-897"><a href="#cb5-897" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>A message or notification confirming updates/saves</span>
<span id="cb5-898"><a href="#cb5-898" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>A summary table (<span class="in">`renderTable`</span>) listing saved items (Grade, Subject, Question stem, Timestamp)</span>
<span id="cb5-899"><a href="#cb5-899" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-900"><a href="#cb5-900" aria-hidden="true" tabindex="-1"></a>**Server Logic**</span>
<span id="cb5-901"><a href="#cb5-901" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-902"><a href="#cb5-902" aria-hidden="true" tabindex="-1"></a>Maintain a <span class="in">`reactiveValues()`</span> object named <span class="in">`current_item`</span> containing:</span>
<span id="cb5-903"><a href="#cb5-903" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-904"><a href="#cb5-904" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>grade, subject, question, optionA, optionB, optionC, optionD, optionE, correctAnswer, and timestamp.</span>
<span id="cb5-905"><a href="#cb5-905" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-906"><a href="#cb5-906" aria-hidden="true" tabindex="-1"></a>**Generate Item**</span>
<span id="cb5-907"><a href="#cb5-907" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-908"><a href="#cb5-908" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Use <span class="in">`observeEvent(input$generate, ...)`</span> to call a helper function <span class="in">`generate_item_via_ai(grade, subject)`</span>.</span>
<span id="cb5-909"><a href="#cb5-909" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The helper function returns a named list of 7 fields based on the AI output format below.</span>
<span id="cb5-910"><a href="#cb5-910" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Populate each text input area with the returned values.</span>
<span id="cb5-911"><a href="#cb5-911" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-912"><a href="#cb5-912" aria-hidden="true" tabindex="-1"></a>**AI Output Format**</span>
<span id="cb5-913"><a href="#cb5-913" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-914"><a href="#cb5-914" aria-hidden="true" tabindex="-1"></a>The model should return text formatted exactly as:</span>
<span id="cb5-915"><a href="#cb5-915" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-916"><a href="#cb5-916" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb5-917"><a href="#cb5-917" aria-hidden="true" tabindex="-1"></a><span class="in">Question: &lt;text&gt;</span></span>
<span id="cb5-918"><a href="#cb5-918" aria-hidden="true" tabindex="-1"></a><span class="in">Option A: &lt;text&gt;</span></span>
<span id="cb5-919"><a href="#cb5-919" aria-hidden="true" tabindex="-1"></a><span class="in">Option B: &lt;text&gt;</span></span>
<span id="cb5-920"><a href="#cb5-920" aria-hidden="true" tabindex="-1"></a><span class="in">Option C: &lt;text&gt;</span></span>
<span id="cb5-921"><a href="#cb5-921" aria-hidden="true" tabindex="-1"></a><span class="in">Option D: &lt;text&gt;</span></span>
<span id="cb5-922"><a href="#cb5-922" aria-hidden="true" tabindex="-1"></a><span class="in">Option E: &lt;text&gt;</span></span>
<span id="cb5-923"><a href="#cb5-923" aria-hidden="true" tabindex="-1"></a><span class="in">Correct Answer: Option &lt;A|B|C|D|E&gt;: &lt;repeat the correct option text verbatim&gt;</span></span>
<span id="cb5-924"><a href="#cb5-924" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb5-925"><a href="#cb5-925" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-926"><a href="#cb5-926" aria-hidden="true" tabindex="-1"></a>**Example:**</span>
<span id="cb5-927"><a href="#cb5-927" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-928"><a href="#cb5-928" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb5-929"><a href="#cb5-929" aria-hidden="true" tabindex="-1"></a><span class="in">Question: What is the main source of energy for the water cycle?</span></span>
<span id="cb5-930"><a href="#cb5-930" aria-hidden="true" tabindex="-1"></a><span class="in">Option A: The Moon</span></span>
<span id="cb5-931"><a href="#cb5-931" aria-hidden="true" tabindex="-1"></a><span class="in">Option B: The Sun</span></span>
<span id="cb5-932"><a href="#cb5-932" aria-hidden="true" tabindex="-1"></a><span class="in">Option C: The Wind</span></span>
<span id="cb5-933"><a href="#cb5-933" aria-hidden="true" tabindex="-1"></a><span class="in">Option D: The Earth's Core</span></span>
<span id="cb5-934"><a href="#cb5-934" aria-hidden="true" tabindex="-1"></a><span class="in">Option E: Ocean Currents</span></span>
<span id="cb5-935"><a href="#cb5-935" aria-hidden="true" tabindex="-1"></a><span class="in">Correct Answer: Option B: The Sun</span></span>
<span id="cb5-936"><a href="#cb5-936" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb5-937"><a href="#cb5-937" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-938"><a href="#cb5-938" aria-hidden="true" tabindex="-1"></a>**Helper Function**</span>
<span id="cb5-939"><a href="#cb5-939" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-940"><a href="#cb5-940" aria-hidden="true" tabindex="-1"></a>Implement <span class="in">`generate_item_via_ai()`</span> with a live model call to an Anthropic model.</span>
<span id="cb5-941"><a href="#cb5-941" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-942"><a href="#cb5-942" aria-hidden="true" tabindex="-1"></a>**Update Item**</span>
<span id="cb5-943"><a href="#cb5-943" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-944"><a href="#cb5-944" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>When "Update Item" is clicked, read all text inputs and overwrite the <span class="in">`current_item`</span> values.</span>
<span id="cb5-945"><a href="#cb5-945" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Validate that all fields are filled and that exactly five options (A–E) exist.</span>
<span id="cb5-946"><a href="#cb5-946" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-947"><a href="#cb5-947" aria-hidden="true" tabindex="-1"></a>**Save Item**</span>
<span id="cb5-948"><a href="#cb5-948" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-949"><a href="#cb5-949" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Validate fields again before saving.</span>
<span id="cb5-950"><a href="#cb5-950" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Append <span class="in">`current_item`</span> to a reactive list <span class="in">`saved_items()`</span> (using <span class="in">`reactiveVal`</span>).</span>
<span id="cb5-951"><a href="#cb5-951" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Include metadata fields: Grade, Subject, and Timestamp.</span>
<span id="cb5-952"><a href="#cb5-952" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Save the entire list as an .rds file (<span class="in">`saveRDS(saved_items(), "saved_items.rds")`</span>) in the working directory.</span>
<span id="cb5-953"><a href="#cb5-953" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>On app startup, if "saved_items.rds" exists, load it with <span class="in">`readRDS()`</span>.</span>
<span id="cb5-954"><a href="#cb5-954" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-955"><a href="#cb5-955" aria-hidden="true" tabindex="-1"></a>**Feedback**</span>
<span id="cb5-956"><a href="#cb5-956" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-957"><a href="#cb5-957" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Use <span class="in">`showNotification()`</span> for user feedback (e.g., "Item saved successfully!" or "Missing correct answer.").</span>
<span id="cb5-958"><a href="#cb5-958" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Display a summary table of all saved items.</span>
<span id="cb5-959"><a href="#cb5-959" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-960"><a href="#cb5-960" aria-hidden="true" tabindex="-1"></a>**🧩 Implementation Details**</span>
<span id="cb5-961"><a href="#cb5-961" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-962"><a href="#cb5-962" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Use base shiny and bslib (optional for theming).</span>
<span id="cb5-963"><a href="#cb5-963" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Keep code in one self-contained file (app.R).</span>
<span id="cb5-964"><a href="#cb5-964" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Comment each section clearly to support learning (especially reactivity).</span>
<span id="cb5-965"><a href="#cb5-965" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Enforce exactly five options (A–E) at all times.</span>
<span id="cb5-966"><a href="#cb5-966" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Save items to the working directory only—no external path handling.</span>
<span id="cb5-967"><a href="#cb5-967" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Maintain minimal accessibility (no additional ARIA labeling for this demo).</span>
<span id="cb5-968"><a href="#cb5-968" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-969"><a href="#cb5-969" aria-hidden="true" tabindex="-1"></a>**✅ Deliverable**</span>
<span id="cb5-970"><a href="#cb5-970" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-971"><a href="#cb5-971" aria-hidden="true" tabindex="-1"></a>Output only a fully runnable app.R file in one code block.</span>
<span id="cb5-972"><a href="#cb5-972" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-973"><a href="#cb5-973" aria-hidden="true" tabindex="-1"></a>The app should work immediately when run with <span class="in">`shiny::runApp()`</span>.</span>
<span id="cb5-974"><a href="#cb5-974" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-975"><a href="#cb5-975" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb5-976"><a href="#cb5-976" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-977"><a href="#cb5-977" aria-hidden="true" tabindex="-1"></a><span class="fu">### Working App with LLM Integration</span></span>
<span id="cb5-978"><a href="#cb5-978" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-979"><a href="#cb5-979" aria-hidden="true" tabindex="-1"></a>You can either download the app below, or copy and paste the chunk of code in a new .R file.</span>
<span id="cb5-980"><a href="#cb5-980" aria-hidden="true" tabindex="-1"></a>Then highlight and execute the text.</span>
<span id="cb5-981"><a href="#cb5-981" aria-hidden="true" tabindex="-1"></a>It may take a minute or two the first time the app runs for it to be built, but a new window should open and the app should run.</span>
<span id="cb5-982"><a href="#cb5-982" aria-hidden="true" tabindex="-1"></a>In the background the app is using the ANTHROPIC_API_KEY that was provided to you as part of the workshop. </span>
<span id="cb5-983"><a href="#cb5-983" aria-hidden="true" tabindex="-1"></a>You'll have to <span class="co">[</span><span class="ot">get your own Anthropic API Key</span><span class="co">](@sec-api-keys)</span> to continue running the app outside of the workshop hours.</span>
<span id="cb5-984"><a href="#cb5-984" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-985"><a href="#cb5-985" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">a</span><span class="ot"> href</span><span class="op">=</span><span class="st">"downloads/mcq_maker_app.R"</span><span class="ot"> download style</span><span class="op">=</span><span class="st">"display: inline-block; padding: 10px 20px; background-color: #4A90E2; color: black; text-decoration: none; border-radius: 5px;"</span><span class="dt">&gt;</span></span>
<span id="cb5-986"><a href="#cb5-986" aria-hidden="true" tabindex="-1"></a>  📥 Download <span class="in">`mcq_maker_app`</span></span>
<span id="cb5-987"><a href="#cb5-987" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">a</span><span class="dt">&gt;</span></span>
<span id="cb5-988"><a href="#cb5-988" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-989"><a href="#cb5-989" aria-hidden="true" tabindex="-1"></a>::: {.callout-note collapse="true"}</span>
<span id="cb5-990"><a href="#cb5-990" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-991"><a href="#cb5-991" aria-hidden="true" tabindex="-1"></a><span class="fu">## View the App Code Generated by Claude</span></span>
<span id="cb5-992"><a href="#cb5-992" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-993"><a href="#cb5-993" aria-hidden="true" tabindex="-1"></a>Given the prompt above, here is what Claude produced:</span>
<span id="cb5-994"><a href="#cb5-994" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-995"><a href="#cb5-995" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = FALSE}</span></span>
<span id="cb5-996"><a href="#cb5-996" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-997"><a href="#cb5-997" aria-hidden="true" tabindex="-1"></a><span class="co"># MCQ Generator Shiny App</span></span>
<span id="cb5-998"><a href="#cb5-998" aria-hidden="true" tabindex="-1"></a><span class="co"># Single-file app with field locking and AI-powered regeneration</span></span>
<span id="cb5-999"><a href="#cb5-999" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-1000"><a href="#cb5-1000" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(shiny)</span>
<span id="cb5-1001"><a href="#cb5-1001" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(bslib)</span>
<span id="cb5-1002"><a href="#cb5-1002" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(httr2)</span>
<span id="cb5-1003"><a href="#cb5-1003" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-1004"><a href="#cb5-1004" aria-hidden="true" tabindex="-1"></a><span class="co"># ==============================================================================</span></span>
<span id="cb5-1005"><a href="#cb5-1005" aria-hidden="true" tabindex="-1"></a><span class="co"># AI HELPER FUNCTIONS</span></span>
<span id="cb5-1006"><a href="#cb5-1006" aria-hidden="true" tabindex="-1"></a><span class="co"># ==============================================================================</span></span>
<span id="cb5-1007"><a href="#cb5-1007" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-1008"><a href="#cb5-1008" aria-hidden="true" tabindex="-1"></a><span class="co">#' Generate a complete MCQ item via AI</span></span>
<span id="cb5-1009"><a href="#cb5-1009" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb5-1010"><a href="#cb5-1010" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param grade Grade level (e.g., "1st", "3rd", "5th", "7th")</span></span>
<span id="cb5-1011"><a href="#cb5-1011" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param subject Subject (e.g., "Geography", "Science", "Social Studies")</span></span>
<span id="cb5-1012"><a href="#cb5-1012" aria-hidden="true" tabindex="-1"></a><span class="co">#' @return Named list with: question, optionA, optionB, optionC, optionD, optionE, correctAnswer</span></span>
<span id="cb5-1013"><a href="#cb5-1013" aria-hidden="true" tabindex="-1"></a>generate_item_via_ai <span class="ot">&lt;-</span> <span class="cf">function</span>(grade, subject) {</span>
<span id="cb5-1014"><a href="#cb5-1014" aria-hidden="true" tabindex="-1"></a>  api_key <span class="ot">&lt;-</span> <span class="fu">Sys.getenv</span>(<span class="st">"ANTHROPIC_API_KEY"</span>)</span>
<span id="cb5-1015"><a href="#cb5-1015" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (api_key <span class="sc">==</span> <span class="st">""</span>) {</span>
<span id="cb5-1016"><a href="#cb5-1016" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"ANTHROPIC_API_KEY not found in .Renviron"</span>)</span>
<span id="cb5-1017"><a href="#cb5-1017" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-1018"><a href="#cb5-1018" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-1019"><a href="#cb5-1019" aria-hidden="true" tabindex="-1"></a>  system_prompt <span class="ot">&lt;-</span> <span class="st">"You are an expert assessment item writer. Produce age-appropriate MCQs with exactly five options (A-E) and a single correct answer. Follow the output format strictly."</span></span>
<span id="cb5-1020"><a href="#cb5-1020" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-1021"><a href="#cb5-1021" aria-hidden="true" tabindex="-1"></a>  user_prompt <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(</span>
<span id="cb5-1022"><a href="#cb5-1022" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Context: Grade = %s, Subject = %s</span><span class="sc">\n\n</span><span class="st">Generate a multiple-choice question suitable for this grade level and subject.</span><span class="sc">\n\n</span><span class="st">Output Format (required):</span><span class="sc">\n</span><span class="st">Question: &lt;text&gt;</span><span class="sc">\n</span><span class="st">Option A: &lt;text&gt;</span><span class="sc">\n</span><span class="st">Option B: &lt;text&gt;</span><span class="sc">\n</span><span class="st">Option C: &lt;text&gt;</span><span class="sc">\n</span><span class="st">Option D: &lt;text&gt;</span><span class="sc">\n</span><span class="st">Option E: &lt;text&gt;</span><span class="sc">\n</span><span class="st">Correct Answer: Option &lt;A|B|C|D|E&gt;: &lt;repeat the correct option text verbatim&gt;</span><span class="sc">\n\n</span><span class="st">Ensure the correct answer key and text match one of A-E. Keep language at the specified grade level."</span>,</span>
<span id="cb5-1023"><a href="#cb5-1023" aria-hidden="true" tabindex="-1"></a>    grade, subject</span>
<span id="cb5-1024"><a href="#cb5-1024" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb5-1025"><a href="#cb5-1025" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-1026"><a href="#cb5-1026" aria-hidden="true" tabindex="-1"></a>  response <span class="ot">&lt;-</span> <span class="fu">request</span>(<span class="st">"https://api.anthropic.com/v1/messages"</span>) <span class="sc">|&gt;</span></span>
<span id="cb5-1027"><a href="#cb5-1027" aria-hidden="true" tabindex="-1"></a>    <span class="fu">req_headers</span>(</span>
<span id="cb5-1028"><a href="#cb5-1028" aria-hidden="true" tabindex="-1"></a>      <span class="st">"x-api-key"</span> <span class="ot">=</span> api_key,</span>
<span id="cb5-1029"><a href="#cb5-1029" aria-hidden="true" tabindex="-1"></a>      <span class="st">"anthropic-version"</span> <span class="ot">=</span> <span class="st">"2023-06-01"</span>,</span>
<span id="cb5-1030"><a href="#cb5-1030" aria-hidden="true" tabindex="-1"></a>      <span class="st">"content-type"</span> <span class="ot">=</span> <span class="st">"application/json"</span></span>
<span id="cb5-1031"><a href="#cb5-1031" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb5-1032"><a href="#cb5-1032" aria-hidden="true" tabindex="-1"></a>    <span class="fu">req_body_json</span>(<span class="fu">list</span>(</span>
<span id="cb5-1033"><a href="#cb5-1033" aria-hidden="true" tabindex="-1"></a>      <span class="at">model =</span> <span class="st">"claude-sonnet-4-20250514"</span>,</span>
<span id="cb5-1034"><a href="#cb5-1034" aria-hidden="true" tabindex="-1"></a>      <span class="at">max_tokens =</span> <span class="dv">1024</span>,</span>
<span id="cb5-1035"><a href="#cb5-1035" aria-hidden="true" tabindex="-1"></a>      <span class="at">system =</span> system_prompt,</span>
<span id="cb5-1036"><a href="#cb5-1036" aria-hidden="true" tabindex="-1"></a>      <span class="at">messages =</span> <span class="fu">list</span>(</span>
<span id="cb5-1037"><a href="#cb5-1037" aria-hidden="true" tabindex="-1"></a>        <span class="fu">list</span>(<span class="at">role =</span> <span class="st">"user"</span>, <span class="at">content =</span> user_prompt)</span>
<span id="cb5-1038"><a href="#cb5-1038" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb5-1039"><a href="#cb5-1039" aria-hidden="true" tabindex="-1"></a>    )) <span class="sc">|&gt;</span></span>
<span id="cb5-1040"><a href="#cb5-1040" aria-hidden="true" tabindex="-1"></a>    <span class="fu">req_perform</span>() <span class="sc">|&gt;</span></span>
<span id="cb5-1041"><a href="#cb5-1041" aria-hidden="true" tabindex="-1"></a>    <span class="fu">resp_body_json</span>()</span>
<span id="cb5-1042"><a href="#cb5-1042" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-1043"><a href="#cb5-1043" aria-hidden="true" tabindex="-1"></a>  content_text <span class="ot">&lt;-</span> response<span class="sc">$</span>content[[<span class="dv">1</span>]]<span class="sc">$</span>text</span>
<span id="cb5-1044"><a href="#cb5-1044" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">parse_ai_output</span>(content_text))</span>
<span id="cb5-1045"><a href="#cb5-1045" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-1046"><a href="#cb5-1046" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-1047"><a href="#cb5-1047" aria-hidden="true" tabindex="-1"></a><span class="co">#' Re-generate an MCQ item via AI with locked fields</span></span>
<span id="cb5-1048"><a href="#cb5-1048" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb5-1049"><a href="#cb5-1049" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param grade Grade level</span></span>
<span id="cb5-1050"><a href="#cb5-1050" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param subject Subject</span></span>
<span id="cb5-1051"><a href="#cb5-1051" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param instructions Free-text instructions for regeneration</span></span>
<span id="cb5-1052"><a href="#cb5-1052" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param locked_values Named list of locked fields (subset of: question, optionA-E, correctAnswer)</span></span>
<span id="cb5-1053"><a href="#cb5-1053" aria-hidden="true" tabindex="-1"></a><span class="co">#' @return Named list with all 7 fields (locked fields unchanged)</span></span>
<span id="cb5-1054"><a href="#cb5-1054" aria-hidden="true" tabindex="-1"></a>regenerate_item_via_ai <span class="ot">&lt;-</span> <span class="cf">function</span>(grade, subject, instructions, locked_values) {</span>
<span id="cb5-1055"><a href="#cb5-1055" aria-hidden="true" tabindex="-1"></a>  api_key <span class="ot">&lt;-</span> <span class="fu">Sys.getenv</span>(<span class="st">"ANTHROPIC_API_KEY"</span>)</span>
<span id="cb5-1056"><a href="#cb5-1056" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (api_key <span class="sc">==</span> <span class="st">""</span>) {</span>
<span id="cb5-1057"><a href="#cb5-1057" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"ANTHROPIC_API_KEY not found in .Renviron"</span>)</span>
<span id="cb5-1058"><a href="#cb5-1058" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-1059"><a href="#cb5-1059" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-1060"><a href="#cb5-1060" aria-hidden="true" tabindex="-1"></a>  system_prompt <span class="ot">&lt;-</span> <span class="st">"You are an expert assessment item writer. Produce age-appropriate MCQs with exactly five options (A-E) and a single correct answer. Follow the output format strictly."</span></span>
<span id="cb5-1061"><a href="#cb5-1061" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-1062"><a href="#cb5-1062" aria-hidden="true" tabindex="-1"></a>  locked_fields_text <span class="ot">&lt;-</span> <span class="st">""</span></span>
<span id="cb5-1063"><a href="#cb5-1063" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(locked_values) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb5-1064"><a href="#cb5-1064" aria-hidden="true" tabindex="-1"></a>    locked_fields_text <span class="ot">&lt;-</span> <span class="st">"</span><span class="sc">\n\n</span><span class="st">Locked fields (echo these unchanged):</span><span class="sc">\n</span><span class="st">"</span></span>
<span id="cb5-1065"><a href="#cb5-1065" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (field_name <span class="cf">in</span> <span class="fu">names</span>(locked_values)) {</span>
<span id="cb5-1066"><a href="#cb5-1066" aria-hidden="true" tabindex="-1"></a>      locked_fields_text <span class="ot">&lt;-</span> <span class="fu">paste0</span>(locked_fields_text, field_name, <span class="st">": "</span>, locked_values[[field_name]], <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb5-1067"><a href="#cb5-1067" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb5-1068"><a href="#cb5-1068" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-1069"><a href="#cb5-1069" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-1070"><a href="#cb5-1070" aria-hidden="true" tabindex="-1"></a>  instructions_text <span class="ot">&lt;-</span> <span class="st">""</span></span>
<span id="cb5-1071"><a href="#cb5-1071" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(instructions) <span class="sc">&amp;&amp;</span> <span class="fu">nchar</span>(<span class="fu">trimws</span>(instructions)) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb5-1072"><a href="#cb5-1072" aria-hidden="true" tabindex="-1"></a>    instructions_text <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"</span><span class="sc">\n\n</span><span class="st">Instructions: "</span>, instructions)</span>
<span id="cb5-1073"><a href="#cb5-1073" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-1074"><a href="#cb5-1074" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-1075"><a href="#cb5-1075" aria-hidden="true" tabindex="-1"></a>  user_prompt <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(</span>
<span id="cb5-1076"><a href="#cb5-1076" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Context: Grade = %s, Subject = %s%s%s</span><span class="sc">\n\n</span><span class="st">Re-generate a multiple-choice question. Echo all locked fields unchanged. Generate new content for unlocked fields that is consistent with locked fields, grade, subject, and instructions.</span><span class="sc">\n\n</span><span class="st">Output Format (required):</span><span class="sc">\n</span><span class="st">Question: &lt;text&gt;</span><span class="sc">\n</span><span class="st">Option A: &lt;text&gt;</span><span class="sc">\n</span><span class="st">Option B: &lt;text&gt;</span><span class="sc">\n</span><span class="st">Option C: &lt;text&gt;</span><span class="sc">\n</span><span class="st">Option D: &lt;text&gt;</span><span class="sc">\n</span><span class="st">Option E: &lt;text&gt;</span><span class="sc">\n</span><span class="st">Correct Answer: Option &lt;A|B|C|D|E&gt;: &lt;repeat the correct option text verbatim&gt;</span><span class="sc">\n\n</span><span class="st">Return all fields. Ensure the correct answer key and text match one of A-E. Keep language at the specified grade level."</span>,</span>
<span id="cb5-1077"><a href="#cb5-1077" aria-hidden="true" tabindex="-1"></a>    grade, subject, locked_fields_text, instructions_text</span>
<span id="cb5-1078"><a href="#cb5-1078" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb5-1079"><a href="#cb5-1079" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-1080"><a href="#cb5-1080" aria-hidden="true" tabindex="-1"></a>  response <span class="ot">&lt;-</span> <span class="fu">request</span>(<span class="st">"https://api.anthropic.com/v1/messages"</span>) <span class="sc">|&gt;</span></span>
<span id="cb5-1081"><a href="#cb5-1081" aria-hidden="true" tabindex="-1"></a>    <span class="fu">req_headers</span>(</span>
<span id="cb5-1082"><a href="#cb5-1082" aria-hidden="true" tabindex="-1"></a>      <span class="st">"x-api-key"</span> <span class="ot">=</span> api_key,</span>
<span id="cb5-1083"><a href="#cb5-1083" aria-hidden="true" tabindex="-1"></a>      <span class="st">"anthropic-version"</span> <span class="ot">=</span> <span class="st">"2023-06-01"</span>,</span>
<span id="cb5-1084"><a href="#cb5-1084" aria-hidden="true" tabindex="-1"></a>      <span class="st">"content-type"</span> <span class="ot">=</span> <span class="st">"application/json"</span></span>
<span id="cb5-1085"><a href="#cb5-1085" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb5-1086"><a href="#cb5-1086" aria-hidden="true" tabindex="-1"></a>    <span class="fu">req_body_json</span>(<span class="fu">list</span>(</span>
<span id="cb5-1087"><a href="#cb5-1087" aria-hidden="true" tabindex="-1"></a>      <span class="at">model =</span> <span class="st">"claude-sonnet-4-20250514"</span>,</span>
<span id="cb5-1088"><a href="#cb5-1088" aria-hidden="true" tabindex="-1"></a>      <span class="at">max_tokens =</span> <span class="dv">1024</span>,</span>
<span id="cb5-1089"><a href="#cb5-1089" aria-hidden="true" tabindex="-1"></a>      <span class="at">system =</span> system_prompt,</span>
<span id="cb5-1090"><a href="#cb5-1090" aria-hidden="true" tabindex="-1"></a>      <span class="at">messages =</span> <span class="fu">list</span>(</span>
<span id="cb5-1091"><a href="#cb5-1091" aria-hidden="true" tabindex="-1"></a>        <span class="fu">list</span>(<span class="at">role =</span> <span class="st">"user"</span>, <span class="at">content =</span> user_prompt)</span>
<span id="cb5-1092"><a href="#cb5-1092" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb5-1093"><a href="#cb5-1093" aria-hidden="true" tabindex="-1"></a>    )) <span class="sc">|&gt;</span></span>
<span id="cb5-1094"><a href="#cb5-1094" aria-hidden="true" tabindex="-1"></a>    <span class="fu">req_perform</span>() <span class="sc">|&gt;</span></span>
<span id="cb5-1095"><a href="#cb5-1095" aria-hidden="true" tabindex="-1"></a>    <span class="fu">resp_body_json</span>()</span>
<span id="cb5-1096"><a href="#cb5-1096" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-1097"><a href="#cb5-1097" aria-hidden="true" tabindex="-1"></a>  content_text <span class="ot">&lt;-</span> response<span class="sc">$</span>content[[<span class="dv">1</span>]]<span class="sc">$</span>text</span>
<span id="cb5-1098"><a href="#cb5-1098" aria-hidden="true" tabindex="-1"></a>  parsed <span class="ot">&lt;-</span> <span class="fu">parse_ai_output</span>(content_text)</span>
<span id="cb5-1099"><a href="#cb5-1099" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-1100"><a href="#cb5-1100" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Validate locked fields</span></span>
<span id="cb5-1101"><a href="#cb5-1101" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (field_name <span class="cf">in</span> <span class="fu">names</span>(locked_values)) {</span>
<span id="cb5-1102"><a href="#cb5-1102" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">identical</span>(parsed[[field_name]], locked_values[[field_name]])) {</span>
<span id="cb5-1103"><a href="#cb5-1103" aria-hidden="true" tabindex="-1"></a>      <span class="fu">warning</span>(<span class="fu">paste</span>(<span class="st">"AI violated lock on field:"</span>, field_name))</span>
<span id="cb5-1104"><a href="#cb5-1104" aria-hidden="true" tabindex="-1"></a>      parsed[[field_name]] <span class="ot">&lt;-</span> locked_values[[field_name]]</span>
<span id="cb5-1105"><a href="#cb5-1105" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb5-1106"><a href="#cb5-1106" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-1107"><a href="#cb5-1107" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-1108"><a href="#cb5-1108" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(parsed)</span>
<span id="cb5-1109"><a href="#cb5-1109" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-1110"><a href="#cb5-1110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-1111"><a href="#cb5-1111" aria-hidden="true" tabindex="-1"></a><span class="co">#' Parse AI output text into structured format</span></span>
<span id="cb5-1112"><a href="#cb5-1112" aria-hidden="true" tabindex="-1"></a>parse_ai_output <span class="ot">&lt;-</span> <span class="cf">function</span>(text) {</span>
<span id="cb5-1113"><a href="#cb5-1113" aria-hidden="true" tabindex="-1"></a>  lines <span class="ot">&lt;-</span> <span class="fu">strsplit</span>(text, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)[[<span class="dv">1</span>]]</span>
<span id="cb5-1114"><a href="#cb5-1114" aria-hidden="true" tabindex="-1"></a>  lines <span class="ot">&lt;-</span> <span class="fu">trimws</span>(lines)</span>
<span id="cb5-1115"><a href="#cb5-1115" aria-hidden="true" tabindex="-1"></a>  lines <span class="ot">&lt;-</span> lines[<span class="fu">nchar</span>(lines) <span class="sc">&gt;</span> <span class="dv">0</span>]</span>
<span id="cb5-1116"><a href="#cb5-1116" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-1117"><a href="#cb5-1117" aria-hidden="true" tabindex="-1"></a>  result <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb5-1118"><a href="#cb5-1118" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-1119"><a href="#cb5-1119" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (line <span class="cf">in</span> lines) {</span>
<span id="cb5-1120"><a href="#cb5-1120" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">grepl</span>(<span class="st">"^Question:"</span>, line, <span class="at">ignore.case =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb5-1121"><a href="#cb5-1121" aria-hidden="true" tabindex="-1"></a>      result<span class="sc">$</span>question <span class="ot">&lt;-</span> <span class="fu">trimws</span>(<span class="fu">sub</span>(<span class="st">"^Question:"</span>, <span class="st">""</span>, line, <span class="at">ignore.case =</span> <span class="cn">TRUE</span>))</span>
<span id="cb5-1122"><a href="#cb5-1122" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (<span class="fu">grepl</span>(<span class="st">"^Option A:"</span>, line, <span class="at">ignore.case =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb5-1123"><a href="#cb5-1123" aria-hidden="true" tabindex="-1"></a>      result<span class="sc">$</span>optionA <span class="ot">&lt;-</span> <span class="fu">trimws</span>(<span class="fu">sub</span>(<span class="st">"^Option A:"</span>, <span class="st">""</span>, line, <span class="at">ignore.case =</span> <span class="cn">TRUE</span>))</span>
<span id="cb5-1124"><a href="#cb5-1124" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (<span class="fu">grepl</span>(<span class="st">"^Option B:"</span>, line, <span class="at">ignore.case =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb5-1125"><a href="#cb5-1125" aria-hidden="true" tabindex="-1"></a>      result<span class="sc">$</span>optionB <span class="ot">&lt;-</span> <span class="fu">trimws</span>(<span class="fu">sub</span>(<span class="st">"^Option B:"</span>, <span class="st">""</span>, line, <span class="at">ignore.case =</span> <span class="cn">TRUE</span>))</span>
<span id="cb5-1126"><a href="#cb5-1126" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (<span class="fu">grepl</span>(<span class="st">"^Option C:"</span>, line, <span class="at">ignore.case =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb5-1127"><a href="#cb5-1127" aria-hidden="true" tabindex="-1"></a>      result<span class="sc">$</span>optionC <span class="ot">&lt;-</span> <span class="fu">trimws</span>(<span class="fu">sub</span>(<span class="st">"^Option C:"</span>, <span class="st">""</span>, line, <span class="at">ignore.case =</span> <span class="cn">TRUE</span>))</span>
<span id="cb5-1128"><a href="#cb5-1128" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (<span class="fu">grepl</span>(<span class="st">"^Option D:"</span>, line, <span class="at">ignore.case =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb5-1129"><a href="#cb5-1129" aria-hidden="true" tabindex="-1"></a>      result<span class="sc">$</span>optionD <span class="ot">&lt;-</span> <span class="fu">trimws</span>(<span class="fu">sub</span>(<span class="st">"^Option D:"</span>, <span class="st">""</span>, line, <span class="at">ignore.case =</span> <span class="cn">TRUE</span>))</span>
<span id="cb5-1130"><a href="#cb5-1130" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (<span class="fu">grepl</span>(<span class="st">"^Option E:"</span>, line, <span class="at">ignore.case =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb5-1131"><a href="#cb5-1131" aria-hidden="true" tabindex="-1"></a>      result<span class="sc">$</span>optionE <span class="ot">&lt;-</span> <span class="fu">trimws</span>(<span class="fu">sub</span>(<span class="st">"^Option E:"</span>, <span class="st">""</span>, line, <span class="at">ignore.case =</span> <span class="cn">TRUE</span>))</span>
<span id="cb5-1132"><a href="#cb5-1132" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (<span class="fu">grepl</span>(<span class="st">"^Correct Answer:"</span>, line, <span class="at">ignore.case =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb5-1133"><a href="#cb5-1133" aria-hidden="true" tabindex="-1"></a>      result<span class="sc">$</span>correctAnswer <span class="ot">&lt;-</span> <span class="fu">trimws</span>(<span class="fu">sub</span>(<span class="st">"^Correct Answer:"</span>, <span class="st">""</span>, line, <span class="at">ignore.case =</span> <span class="cn">TRUE</span>))</span>
<span id="cb5-1134"><a href="#cb5-1134" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb5-1135"><a href="#cb5-1135" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-1136"><a href="#cb5-1136" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-1137"><a href="#cb5-1137" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(result)</span>
<span id="cb5-1138"><a href="#cb5-1138" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-1139"><a href="#cb5-1139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-1140"><a href="#cb5-1140" aria-hidden="true" tabindex="-1"></a><span class="co"># ==============================================================================</span></span>
<span id="cb5-1141"><a href="#cb5-1141" aria-hidden="true" tabindex="-1"></a><span class="co"># VALIDATION FUNCTIONS</span></span>
<span id="cb5-1142"><a href="#cb5-1142" aria-hidden="true" tabindex="-1"></a><span class="co"># ==============================================================================</span></span>
<span id="cb5-1143"><a href="#cb5-1143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-1144"><a href="#cb5-1144" aria-hidden="true" tabindex="-1"></a>validate_item <span class="ot">&lt;-</span> <span class="cf">function</span>(item) {</span>
<span id="cb5-1145"><a href="#cb5-1145" aria-hidden="true" tabindex="-1"></a>  errors <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb5-1146"><a href="#cb5-1146" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-1147"><a href="#cb5-1147" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Check question</span></span>
<span id="cb5-1148"><a href="#cb5-1148" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(item<span class="sc">$</span>question) <span class="sc">||</span> <span class="fu">nchar</span>(<span class="fu">trimws</span>(item<span class="sc">$</span>question)) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb5-1149"><a href="#cb5-1149" aria-hidden="true" tabindex="-1"></a>    errors <span class="ot">&lt;-</span> <span class="fu">c</span>(errors, <span class="st">"Question cannot be empty"</span>)</span>
<span id="cb5-1150"><a href="#cb5-1150" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-1151"><a href="#cb5-1151" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-1152"><a href="#cb5-1152" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Check all options</span></span>
<span id="cb5-1153"><a href="#cb5-1153" aria-hidden="true" tabindex="-1"></a>  required_options <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"optionA"</span>, <span class="st">"optionB"</span>, <span class="st">"optionC"</span>, <span class="st">"optionD"</span>, <span class="st">"optionE"</span>)</span>
<span id="cb5-1154"><a href="#cb5-1154" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (opt <span class="cf">in</span> required_options) {</span>
<span id="cb5-1155"><a href="#cb5-1155" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">is.null</span>(item[[opt]]) <span class="sc">||</span> <span class="fu">nchar</span>(<span class="fu">trimws</span>(item[[opt]])) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb5-1156"><a href="#cb5-1156" aria-hidden="true" tabindex="-1"></a>      errors <span class="ot">&lt;-</span> <span class="fu">c</span>(errors, <span class="fu">paste</span>(<span class="st">"Option"</span>, <span class="fu">substr</span>(opt, <span class="dv">7</span>, <span class="dv">7</span>), <span class="st">"cannot be empty"</span>))</span>
<span id="cb5-1157"><a href="#cb5-1157" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb5-1158"><a href="#cb5-1158" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-1159"><a href="#cb5-1159" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-1160"><a href="#cb5-1160" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Check correct answer format</span></span>
<span id="cb5-1161"><a href="#cb5-1161" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(item<span class="sc">$</span>correctAnswer) <span class="sc">||</span> <span class="fu">nchar</span>(<span class="fu">trimws</span>(item<span class="sc">$</span>correctAnswer)) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb5-1162"><a href="#cb5-1162" aria-hidden="true" tabindex="-1"></a>    errors <span class="ot">&lt;-</span> <span class="fu">c</span>(errors, <span class="st">"Correct Answer cannot be empty"</span>)</span>
<span id="cb5-1163"><a href="#cb5-1163" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb5-1164"><a href="#cb5-1164" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract key (A-E)</span></span>
<span id="cb5-1165"><a href="#cb5-1165" aria-hidden="true" tabindex="-1"></a>    correct_key <span class="ot">&lt;-</span> <span class="fu">extract_correct_key</span>(item<span class="sc">$</span>correctAnswer)</span>
<span id="cb5-1166"><a href="#cb5-1166" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">is.na</span>(correct_key)) {</span>
<span id="cb5-1167"><a href="#cb5-1167" aria-hidden="true" tabindex="-1"></a>      errors <span class="ot">&lt;-</span> <span class="fu">c</span>(errors, <span class="st">"Correct Answer must start with 'Option A:', 'Option B:', etc."</span>)</span>
<span id="cb5-1168"><a href="#cb5-1168" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb5-1169"><a href="#cb5-1169" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Verify the text matches the option</span></span>
<span id="cb5-1170"><a href="#cb5-1170" aria-hidden="true" tabindex="-1"></a>      option_field <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"option"</span>, correct_key)</span>
<span id="cb5-1171"><a href="#cb5-1171" aria-hidden="true" tabindex="-1"></a>      expected_text <span class="ot">&lt;-</span> item[[option_field]]</span>
<span id="cb5-1172"><a href="#cb5-1172" aria-hidden="true" tabindex="-1"></a>      actual_text <span class="ot">&lt;-</span> <span class="fu">extract_correct_text</span>(item<span class="sc">$</span>correctAnswer)</span>
<span id="cb5-1173"><a href="#cb5-1173" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb5-1174"><a href="#cb5-1174" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="sc">!</span><span class="fu">identical</span>(<span class="fu">trimws</span>(expected_text), <span class="fu">trimws</span>(actual_text))) {</span>
<span id="cb5-1175"><a href="#cb5-1175" aria-hidden="true" tabindex="-1"></a>        errors <span class="ot">&lt;-</span> <span class="fu">c</span>(errors, <span class="fu">paste0</span>(<span class="st">"Correct Answer text must match Option "</span>, correct_key, <span class="st">" exactly"</span>))</span>
<span id="cb5-1176"><a href="#cb5-1176" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb5-1177"><a href="#cb5-1177" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb5-1178"><a href="#cb5-1178" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-1179"><a href="#cb5-1179" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-1180"><a href="#cb5-1180" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(errors) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb5-1181"><a href="#cb5-1181" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">valid =</span> <span class="cn">FALSE</span>, <span class="at">errors =</span> errors))</span>
<span id="cb5-1182"><a href="#cb5-1182" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb5-1183"><a href="#cb5-1183" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">valid =</span> <span class="cn">TRUE</span>, <span class="at">errors =</span> <span class="cn">NULL</span>))</span>
<span id="cb5-1184"><a href="#cb5-1184" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-1185"><a href="#cb5-1185" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-1186"><a href="#cb5-1186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-1187"><a href="#cb5-1187" aria-hidden="true" tabindex="-1"></a>extract_correct_key <span class="ot">&lt;-</span> <span class="cf">function</span>(correct_answer) {</span>
<span id="cb5-1188"><a href="#cb5-1188" aria-hidden="true" tabindex="-1"></a>  match <span class="ot">&lt;-</span> <span class="fu">regexpr</span>(<span class="st">"Option ([A-E]):"</span>, correct_answer, <span class="at">ignore.case =</span> <span class="cn">TRUE</span>)</span>
<span id="cb5-1189"><a href="#cb5-1189" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (match <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb5-1190"><a href="#cb5-1190" aria-hidden="true" tabindex="-1"></a>    key_text <span class="ot">&lt;-</span> <span class="fu">regmatches</span>(correct_answer, match)</span>
<span id="cb5-1191"><a href="#cb5-1191" aria-hidden="true" tabindex="-1"></a>    key <span class="ot">&lt;-</span> <span class="fu">sub</span>(<span class="st">"Option ([A-E]):.*"</span>, <span class="st">"</span><span class="sc">\\</span><span class="st">1"</span>, key_text, <span class="at">ignore.case =</span> <span class="cn">TRUE</span>)</span>
<span id="cb5-1192"><a href="#cb5-1192" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">toupper</span>(key))</span>
<span id="cb5-1193"><a href="#cb5-1193" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-1194"><a href="#cb5-1194" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="cn">NA</span>)</span>
<span id="cb5-1195"><a href="#cb5-1195" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-1196"><a href="#cb5-1196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-1197"><a href="#cb5-1197" aria-hidden="true" tabindex="-1"></a>extract_correct_text <span class="ot">&lt;-</span> <span class="cf">function</span>(correct_answer) {</span>
<span id="cb5-1198"><a href="#cb5-1198" aria-hidden="true" tabindex="-1"></a>  text <span class="ot">&lt;-</span> <span class="fu">sub</span>(<span class="st">"^Option [A-E]:</span><span class="sc">\\</span><span class="st">s*"</span>, <span class="st">""</span>, correct_answer, <span class="at">ignore.case =</span> <span class="cn">TRUE</span>)</span>
<span id="cb5-1199"><a href="#cb5-1199" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">trimws</span>(text))</span>
<span id="cb5-1200"><a href="#cb5-1200" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-1201"><a href="#cb5-1201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-1202"><a href="#cb5-1202" aria-hidden="true" tabindex="-1"></a><span class="co"># ==============================================================================</span></span>
<span id="cb5-1203"><a href="#cb5-1203" aria-hidden="true" tabindex="-1"></a><span class="co"># UI</span></span>
<span id="cb5-1204"><a href="#cb5-1204" aria-hidden="true" tabindex="-1"></a><span class="co"># ==============================================================================</span></span>
<span id="cb5-1205"><a href="#cb5-1205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-1206"><a href="#cb5-1206" aria-hidden="true" tabindex="-1"></a>ui <span class="ot">&lt;-</span> <span class="fu">page_sidebar</span>(</span>
<span id="cb5-1207"><a href="#cb5-1207" aria-hidden="true" tabindex="-1"></a>  <span class="at">title =</span> <span class="st">"MCQ Generator"</span>,</span>
<span id="cb5-1208"><a href="#cb5-1208" aria-hidden="true" tabindex="-1"></a>  <span class="at">theme =</span> <span class="fu">bs_theme</span>(<span class="at">version =</span> <span class="dv">5</span>, <span class="at">bootswatch =</span> <span class="st">"flatly"</span>),</span>
<span id="cb5-1209"><a href="#cb5-1209" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-1210"><a href="#cb5-1210" aria-hidden="true" tabindex="-1"></a>  <span class="at">sidebar =</span> <span class="fu">sidebar</span>(</span>
<span id="cb5-1211"><a href="#cb5-1211" aria-hidden="true" tabindex="-1"></a>    <span class="at">width =</span> <span class="dv">300</span>,</span>
<span id="cb5-1212"><a href="#cb5-1212" aria-hidden="true" tabindex="-1"></a>    <span class="fu">h4</span>(<span class="st">"Configuration"</span>),</span>
<span id="cb5-1213"><a href="#cb5-1213" aria-hidden="true" tabindex="-1"></a>    <span class="fu">selectInput</span>(</span>
<span id="cb5-1214"><a href="#cb5-1214" aria-hidden="true" tabindex="-1"></a>      <span class="st">"grade"</span>,</span>
<span id="cb5-1215"><a href="#cb5-1215" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Grade Level"</span>,</span>
<span id="cb5-1216"><a href="#cb5-1216" aria-hidden="true" tabindex="-1"></a>      <span class="at">choices =</span> <span class="fu">c</span>(<span class="st">"1st"</span>, <span class="st">"3rd"</span>, <span class="st">"5th"</span>, <span class="st">"7th"</span>),</span>
<span id="cb5-1217"><a href="#cb5-1217" aria-hidden="true" tabindex="-1"></a>      <span class="at">selected =</span> <span class="st">"3rd"</span></span>
<span id="cb5-1218"><a href="#cb5-1218" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb5-1219"><a href="#cb5-1219" aria-hidden="true" tabindex="-1"></a>    <span class="fu">selectInput</span>(</span>
<span id="cb5-1220"><a href="#cb5-1220" aria-hidden="true" tabindex="-1"></a>      <span class="st">"subject"</span>,</span>
<span id="cb5-1221"><a href="#cb5-1221" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Subject"</span>,</span>
<span id="cb5-1222"><a href="#cb5-1222" aria-hidden="true" tabindex="-1"></a>      <span class="at">choices =</span> <span class="fu">c</span>(<span class="st">"Geography"</span>, <span class="st">"Science"</span>, <span class="st">"Social Studies"</span>),</span>
<span id="cb5-1223"><a href="#cb5-1223" aria-hidden="true" tabindex="-1"></a>      <span class="at">selected =</span> <span class="st">"Science"</span></span>
<span id="cb5-1224"><a href="#cb5-1224" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb5-1225"><a href="#cb5-1225" aria-hidden="true" tabindex="-1"></a>    <span class="fu">actionButton</span>(</span>
<span id="cb5-1226"><a href="#cb5-1226" aria-hidden="true" tabindex="-1"></a>      <span class="st">"generate"</span>,</span>
<span id="cb5-1227"><a href="#cb5-1227" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Generate Item"</span>,</span>
<span id="cb5-1228"><a href="#cb5-1228" aria-hidden="true" tabindex="-1"></a>      <span class="at">icon =</span> <span class="fu">icon</span>(<span class="st">"wand-magic-sparkles"</span>),</span>
<span id="cb5-1229"><a href="#cb5-1229" aria-hidden="true" tabindex="-1"></a>      <span class="at">class =</span> <span class="st">"btn-primary w-100 mb-3"</span></span>
<span id="cb5-1230"><a href="#cb5-1230" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb5-1231"><a href="#cb5-1231" aria-hidden="true" tabindex="-1"></a>    <span class="fu">hr</span>(),</span>
<span id="cb5-1232"><a href="#cb5-1232" aria-hidden="true" tabindex="-1"></a>    <span class="fu">h4</span>(<span class="st">"Re-generation"</span>),</span>
<span id="cb5-1233"><a href="#cb5-1233" aria-hidden="true" tabindex="-1"></a>    <span class="fu">textAreaInput</span>(</span>
<span id="cb5-1234"><a href="#cb5-1234" aria-hidden="true" tabindex="-1"></a>      <span class="st">"regen_instructions"</span>,</span>
<span id="cb5-1235"><a href="#cb5-1235" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Re-generation Instructions (optional)"</span>,</span>
<span id="cb5-1236"><a href="#cb5-1236" aria-hidden="true" tabindex="-1"></a>      <span class="at">placeholder =</span> <span class="st">"e.g., focus the question on lava; make distractors conceptually distinct"</span>,</span>
<span id="cb5-1237"><a href="#cb5-1237" aria-hidden="true" tabindex="-1"></a>      <span class="at">rows =</span> <span class="dv">3</span></span>
<span id="cb5-1238"><a href="#cb5-1238" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb5-1239"><a href="#cb5-1239" aria-hidden="true" tabindex="-1"></a>    <span class="fu">actionButton</span>(</span>
<span id="cb5-1240"><a href="#cb5-1240" aria-hidden="true" tabindex="-1"></a>      <span class="st">"regen_unlocked"</span>,</span>
<span id="cb5-1241"><a href="#cb5-1241" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Re-generate Unlocked Fields"</span>,</span>
<span id="cb5-1242"><a href="#cb5-1242" aria-hidden="true" tabindex="-1"></a>      <span class="at">icon =</span> <span class="fu">icon</span>(<span class="st">"rotate"</span>),</span>
<span id="cb5-1243"><a href="#cb5-1243" aria-hidden="true" tabindex="-1"></a>      <span class="at">class =</span> <span class="st">"btn-warning w-100"</span></span>
<span id="cb5-1244"><a href="#cb5-1244" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb5-1245"><a href="#cb5-1245" aria-hidden="true" tabindex="-1"></a>    <span class="fu">helpText</span>(<span class="st">"Locked fields will remain unchanged. Unlocked fields will be re-generated."</span>)</span>
<span id="cb5-1246"><a href="#cb5-1246" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb5-1247"><a href="#cb5-1247" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-1248"><a href="#cb5-1248" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Main content</span></span>
<span id="cb5-1249"><a href="#cb5-1249" aria-hidden="true" tabindex="-1"></a>  <span class="fu">div</span>(</span>
<span id="cb5-1250"><a href="#cb5-1250" aria-hidden="true" tabindex="-1"></a>    <span class="at">class =</span> <span class="st">"container-fluid"</span>,</span>
<span id="cb5-1251"><a href="#cb5-1251" aria-hidden="true" tabindex="-1"></a>    <span class="fu">h3</span>(<span class="st">"Edit Item"</span>),</span>
<span id="cb5-1252"><a href="#cb5-1252" aria-hidden="true" tabindex="-1"></a>    <span class="fu">helpText</span>(<span class="st">"Change the item as desired. Lock fields you want to preserve before re-generation."</span>),</span>
<span id="cb5-1253"><a href="#cb5-1253" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-1254"><a href="#cb5-1254" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Question</span></span>
<span id="cb5-1255"><a href="#cb5-1255" aria-hidden="true" tabindex="-1"></a>    <span class="fu">div</span>(</span>
<span id="cb5-1256"><a href="#cb5-1256" aria-hidden="true" tabindex="-1"></a>      <span class="at">class =</span> <span class="st">"row mb-3"</span>,</span>
<span id="cb5-1257"><a href="#cb5-1257" aria-hidden="true" tabindex="-1"></a>      <span class="fu">div</span>(</span>
<span id="cb5-1258"><a href="#cb5-1258" aria-hidden="true" tabindex="-1"></a>        <span class="at">class =</span> <span class="st">"col-md-10"</span>,</span>
<span id="cb5-1259"><a href="#cb5-1259" aria-hidden="true" tabindex="-1"></a>        <span class="fu">textAreaInput</span>(</span>
<span id="cb5-1260"><a href="#cb5-1260" aria-hidden="true" tabindex="-1"></a>          <span class="st">"question"</span>,</span>
<span id="cb5-1261"><a href="#cb5-1261" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Question"</span>,</span>
<span id="cb5-1262"><a href="#cb5-1262" aria-hidden="true" tabindex="-1"></a>          <span class="at">value =</span> <span class="st">""</span>,</span>
<span id="cb5-1263"><a href="#cb5-1263" aria-hidden="true" tabindex="-1"></a>          <span class="at">rows =</span> <span class="dv">3</span>,</span>
<span id="cb5-1264"><a href="#cb5-1264" aria-hidden="true" tabindex="-1"></a>          <span class="at">width =</span> <span class="st">"100%"</span></span>
<span id="cb5-1265"><a href="#cb5-1265" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb5-1266"><a href="#cb5-1266" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb5-1267"><a href="#cb5-1267" aria-hidden="true" tabindex="-1"></a>      <span class="fu">div</span>(</span>
<span id="cb5-1268"><a href="#cb5-1268" aria-hidden="true" tabindex="-1"></a>        <span class="at">class =</span> <span class="st">"col-md-2"</span>,</span>
<span id="cb5-1269"><a href="#cb5-1269" aria-hidden="true" tabindex="-1"></a>        <span class="fu">br</span>(),</span>
<span id="cb5-1270"><a href="#cb5-1270" aria-hidden="true" tabindex="-1"></a>        <span class="fu">checkboxInput</span>(<span class="st">"lock_question"</span>, <span class="st">"Lock"</span>, <span class="cn">FALSE</span>)</span>
<span id="cb5-1271"><a href="#cb5-1271" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb5-1272"><a href="#cb5-1272" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb5-1273"><a href="#cb5-1273" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-1274"><a href="#cb5-1274" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Options A-E</span></span>
<span id="cb5-1275"><a href="#cb5-1275" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lapply</span>(LETTERS[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>], <span class="cf">function</span>(letter) {</span>
<span id="cb5-1276"><a href="#cb5-1276" aria-hidden="true" tabindex="-1"></a>      <span class="fu">div</span>(</span>
<span id="cb5-1277"><a href="#cb5-1277" aria-hidden="true" tabindex="-1"></a>        <span class="at">class =</span> <span class="st">"row mb-2"</span>,</span>
<span id="cb5-1278"><a href="#cb5-1278" aria-hidden="true" tabindex="-1"></a>        <span class="fu">div</span>(</span>
<span id="cb5-1279"><a href="#cb5-1279" aria-hidden="true" tabindex="-1"></a>          <span class="at">class =</span> <span class="st">"col-md-10"</span>,</span>
<span id="cb5-1280"><a href="#cb5-1280" aria-hidden="true" tabindex="-1"></a>          <span class="fu">textInput</span>(</span>
<span id="cb5-1281"><a href="#cb5-1281" aria-hidden="true" tabindex="-1"></a>            <span class="fu">paste0</span>(<span class="st">"option"</span>, letter),</span>
<span id="cb5-1282"><a href="#cb5-1282" aria-hidden="true" tabindex="-1"></a>            <span class="fu">paste</span>(<span class="st">"Option"</span>, letter),</span>
<span id="cb5-1283"><a href="#cb5-1283" aria-hidden="true" tabindex="-1"></a>            <span class="at">value =</span> <span class="st">""</span>,</span>
<span id="cb5-1284"><a href="#cb5-1284" aria-hidden="true" tabindex="-1"></a>            <span class="at">width =</span> <span class="st">"100%"</span></span>
<span id="cb5-1285"><a href="#cb5-1285" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb5-1286"><a href="#cb5-1286" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb5-1287"><a href="#cb5-1287" aria-hidden="true" tabindex="-1"></a>        <span class="fu">div</span>(</span>
<span id="cb5-1288"><a href="#cb5-1288" aria-hidden="true" tabindex="-1"></a>          <span class="at">class =</span> <span class="st">"col-md-2"</span>,</span>
<span id="cb5-1289"><a href="#cb5-1289" aria-hidden="true" tabindex="-1"></a>          <span class="fu">br</span>(),</span>
<span id="cb5-1290"><a href="#cb5-1290" aria-hidden="true" tabindex="-1"></a>          <span class="fu">checkboxInput</span>(<span class="fu">paste0</span>(<span class="st">"lock_option"</span>, letter), <span class="st">"Lock"</span>, <span class="cn">FALSE</span>)</span>
<span id="cb5-1291"><a href="#cb5-1291" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb5-1292"><a href="#cb5-1292" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb5-1293"><a href="#cb5-1293" aria-hidden="true" tabindex="-1"></a>    }),</span>
<span id="cb5-1294"><a href="#cb5-1294" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-1295"><a href="#cb5-1295" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Correct Answer</span></span>
<span id="cb5-1296"><a href="#cb5-1296" aria-hidden="true" tabindex="-1"></a>    <span class="fu">div</span>(</span>
<span id="cb5-1297"><a href="#cb5-1297" aria-hidden="true" tabindex="-1"></a>      <span class="at">class =</span> <span class="st">"row mb-3"</span>,</span>
<span id="cb5-1298"><a href="#cb5-1298" aria-hidden="true" tabindex="-1"></a>      <span class="fu">div</span>(</span>
<span id="cb5-1299"><a href="#cb5-1299" aria-hidden="true" tabindex="-1"></a>        <span class="at">class =</span> <span class="st">"col-md-10"</span>,</span>
<span id="cb5-1300"><a href="#cb5-1300" aria-hidden="true" tabindex="-1"></a>        <span class="fu">textInput</span>(</span>
<span id="cb5-1301"><a href="#cb5-1301" aria-hidden="true" tabindex="-1"></a>          <span class="st">"correctAnswer"</span>,</span>
<span id="cb5-1302"><a href="#cb5-1302" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Correct Answer (format: Option X: text)"</span>,</span>
<span id="cb5-1303"><a href="#cb5-1303" aria-hidden="true" tabindex="-1"></a>          <span class="at">value =</span> <span class="st">""</span>,</span>
<span id="cb5-1304"><a href="#cb5-1304" aria-hidden="true" tabindex="-1"></a>          <span class="at">width =</span> <span class="st">"100%"</span>,</span>
<span id="cb5-1305"><a href="#cb5-1305" aria-hidden="true" tabindex="-1"></a>          <span class="at">placeholder =</span> <span class="st">"e.g., Option A: Pacific Ocean"</span></span>
<span id="cb5-1306"><a href="#cb5-1306" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb5-1307"><a href="#cb5-1307" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb5-1308"><a href="#cb5-1308" aria-hidden="true" tabindex="-1"></a>      <span class="fu">div</span>(</span>
<span id="cb5-1309"><a href="#cb5-1309" aria-hidden="true" tabindex="-1"></a>        <span class="at">class =</span> <span class="st">"col-md-2"</span>,</span>
<span id="cb5-1310"><a href="#cb5-1310" aria-hidden="true" tabindex="-1"></a>        <span class="fu">br</span>(),</span>
<span id="cb5-1311"><a href="#cb5-1311" aria-hidden="true" tabindex="-1"></a>        <span class="fu">checkboxInput</span>(<span class="st">"lock_correctAnswer"</span>, <span class="st">"Lock"</span>, <span class="cn">FALSE</span>)</span>
<span id="cb5-1312"><a href="#cb5-1312" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb5-1313"><a href="#cb5-1313" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb5-1314"><a href="#cb5-1314" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-1315"><a href="#cb5-1315" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Action buttons</span></span>
<span id="cb5-1316"><a href="#cb5-1316" aria-hidden="true" tabindex="-1"></a>    <span class="fu">div</span>(</span>
<span id="cb5-1317"><a href="#cb5-1317" aria-hidden="true" tabindex="-1"></a>      <span class="at">class =</span> <span class="st">"row mb-4"</span>,</span>
<span id="cb5-1318"><a href="#cb5-1318" aria-hidden="true" tabindex="-1"></a>      <span class="fu">div</span>(</span>
<span id="cb5-1319"><a href="#cb5-1319" aria-hidden="true" tabindex="-1"></a>        <span class="at">class =</span> <span class="st">"col-md-6"</span>,</span>
<span id="cb5-1320"><a href="#cb5-1320" aria-hidden="true" tabindex="-1"></a>        <span class="fu">actionButton</span>(</span>
<span id="cb5-1321"><a href="#cb5-1321" aria-hidden="true" tabindex="-1"></a>          <span class="st">"update_item"</span>,</span>
<span id="cb5-1322"><a href="#cb5-1322" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Update Item"</span>,</span>
<span id="cb5-1323"><a href="#cb5-1323" aria-hidden="true" tabindex="-1"></a>          <span class="at">icon =</span> <span class="fu">icon</span>(<span class="st">"check"</span>),</span>
<span id="cb5-1324"><a href="#cb5-1324" aria-hidden="true" tabindex="-1"></a>          <span class="at">class =</span> <span class="st">"btn-success w-100"</span></span>
<span id="cb5-1325"><a href="#cb5-1325" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb5-1326"><a href="#cb5-1326" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb5-1327"><a href="#cb5-1327" aria-hidden="true" tabindex="-1"></a>      <span class="fu">div</span>(</span>
<span id="cb5-1328"><a href="#cb5-1328" aria-hidden="true" tabindex="-1"></a>        <span class="at">class =</span> <span class="st">"col-md-6"</span>,</span>
<span id="cb5-1329"><a href="#cb5-1329" aria-hidden="true" tabindex="-1"></a>        <span class="fu">actionButton</span>(</span>
<span id="cb5-1330"><a href="#cb5-1330" aria-hidden="true" tabindex="-1"></a>          <span class="st">"save_item"</span>,</span>
<span id="cb5-1331"><a href="#cb5-1331" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Save Item"</span>,</span>
<span id="cb5-1332"><a href="#cb5-1332" aria-hidden="true" tabindex="-1"></a>          <span class="at">icon =</span> <span class="fu">icon</span>(<span class="st">"save"</span>),</span>
<span id="cb5-1333"><a href="#cb5-1333" aria-hidden="true" tabindex="-1"></a>          <span class="at">class =</span> <span class="st">"btn-info w-100"</span></span>
<span id="cb5-1334"><a href="#cb5-1334" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb5-1335"><a href="#cb5-1335" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb5-1336"><a href="#cb5-1336" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb5-1337"><a href="#cb5-1337" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-1338"><a href="#cb5-1338" aria-hidden="true" tabindex="-1"></a>    <span class="fu">hr</span>(),</span>
<span id="cb5-1339"><a href="#cb5-1339" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-1340"><a href="#cb5-1340" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Feedback area</span></span>
<span id="cb5-1341"><a href="#cb5-1341" aria-hidden="true" tabindex="-1"></a>    <span class="fu">h3</span>(<span class="st">"Saved Items"</span>),</span>
<span id="cb5-1342"><a href="#cb5-1342" aria-hidden="true" tabindex="-1"></a>    <span class="fu">uiOutput</span>(<span class="st">"feedback_message"</span>),</span>
<span id="cb5-1343"><a href="#cb5-1343" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tableOutput</span>(<span class="st">"saved_items_table"</span>)</span>
<span id="cb5-1344"><a href="#cb5-1344" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb5-1345"><a href="#cb5-1345" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-1346"><a href="#cb5-1346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-1347"><a href="#cb5-1347" aria-hidden="true" tabindex="-1"></a><span class="co"># ==============================================================================</span></span>
<span id="cb5-1348"><a href="#cb5-1348" aria-hidden="true" tabindex="-1"></a><span class="co"># SERVER</span></span>
<span id="cb5-1349"><a href="#cb5-1349" aria-hidden="true" tabindex="-1"></a><span class="co"># ==============================================================================</span></span>
<span id="cb5-1350"><a href="#cb5-1350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-1351"><a href="#cb5-1351" aria-hidden="true" tabindex="-1"></a>server <span class="ot">&lt;-</span> <span class="cf">function</span>(input, output, session) {</span>
<span id="cb5-1352"><a href="#cb5-1352" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-1353"><a href="#cb5-1353" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Reactive values for current item</span></span>
<span id="cb5-1354"><a href="#cb5-1354" aria-hidden="true" tabindex="-1"></a>  current_item <span class="ot">&lt;-</span> <span class="fu">reactiveValues</span>(</span>
<span id="cb5-1355"><a href="#cb5-1355" aria-hidden="true" tabindex="-1"></a>    <span class="at">grade =</span> <span class="cn">NULL</span>,</span>
<span id="cb5-1356"><a href="#cb5-1356" aria-hidden="true" tabindex="-1"></a>    <span class="at">subject =</span> <span class="cn">NULL</span>,</span>
<span id="cb5-1357"><a href="#cb5-1357" aria-hidden="true" tabindex="-1"></a>    <span class="at">question =</span> <span class="st">""</span>,</span>
<span id="cb5-1358"><a href="#cb5-1358" aria-hidden="true" tabindex="-1"></a>    <span class="at">optionA =</span> <span class="st">""</span>,</span>
<span id="cb5-1359"><a href="#cb5-1359" aria-hidden="true" tabindex="-1"></a>    <span class="at">optionB =</span> <span class="st">""</span>,</span>
<span id="cb5-1360"><a href="#cb5-1360" aria-hidden="true" tabindex="-1"></a>    <span class="at">optionC =</span> <span class="st">""</span>,</span>
<span id="cb5-1361"><a href="#cb5-1361" aria-hidden="true" tabindex="-1"></a>    <span class="at">optionD =</span> <span class="st">""</span>,</span>
<span id="cb5-1362"><a href="#cb5-1362" aria-hidden="true" tabindex="-1"></a>    <span class="at">optionE =</span> <span class="st">""</span>,</span>
<span id="cb5-1363"><a href="#cb5-1363" aria-hidden="true" tabindex="-1"></a>    <span class="at">correctAnswer =</span> <span class="st">""</span>,</span>
<span id="cb5-1364"><a href="#cb5-1364" aria-hidden="true" tabindex="-1"></a>    <span class="at">timestamp =</span> <span class="cn">NULL</span></span>
<span id="cb5-1365"><a href="#cb5-1365" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb5-1366"><a href="#cb5-1366" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-1367"><a href="#cb5-1367" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Saved items list</span></span>
<span id="cb5-1368"><a href="#cb5-1368" aria-hidden="true" tabindex="-1"></a>  saved_items <span class="ot">&lt;-</span> <span class="fu">reactiveVal</span>(<span class="fu">list</span>())</span>
<span id="cb5-1369"><a href="#cb5-1369" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-1370"><a href="#cb5-1370" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Load saved items on startup</span></span>
<span id="cb5-1371"><a href="#cb5-1371" aria-hidden="true" tabindex="-1"></a>  <span class="fu">observe</span>({</span>
<span id="cb5-1372"><a href="#cb5-1372" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">file.exists</span>(<span class="st">"saved_items.rds"</span>)) {</span>
<span id="cb5-1373"><a href="#cb5-1373" aria-hidden="true" tabindex="-1"></a>      <span class="fu">tryCatch</span>({</span>
<span id="cb5-1374"><a href="#cb5-1374" aria-hidden="true" tabindex="-1"></a>        loaded <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"saved_items.rds"</span>)</span>
<span id="cb5-1375"><a href="#cb5-1375" aria-hidden="true" tabindex="-1"></a>        <span class="fu">saved_items</span>(loaded)</span>
<span id="cb5-1376"><a href="#cb5-1376" aria-hidden="true" tabindex="-1"></a>        <span class="fu">showNotification</span>(</span>
<span id="cb5-1377"><a href="#cb5-1377" aria-hidden="true" tabindex="-1"></a>          <span class="fu">paste</span>(<span class="st">"Loaded"</span>, <span class="fu">length</span>(loaded), <span class="st">"saved items"</span>),</span>
<span id="cb5-1378"><a href="#cb5-1378" aria-hidden="true" tabindex="-1"></a>          <span class="at">type =</span> <span class="st">"message"</span></span>
<span id="cb5-1379"><a href="#cb5-1379" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb5-1380"><a href="#cb5-1380" aria-hidden="true" tabindex="-1"></a>      }, <span class="at">error =</span> <span class="cf">function</span>(e) {</span>
<span id="cb5-1381"><a href="#cb5-1381" aria-hidden="true" tabindex="-1"></a>        <span class="fu">showNotification</span>(</span>
<span id="cb5-1382"><a href="#cb5-1382" aria-hidden="true" tabindex="-1"></a>          <span class="fu">paste</span>(<span class="st">"Error loading saved items:"</span>, e<span class="sc">$</span>message),</span>
<span id="cb5-1383"><a href="#cb5-1383" aria-hidden="true" tabindex="-1"></a>          <span class="at">type =</span> <span class="st">"error"</span></span>
<span id="cb5-1384"><a href="#cb5-1384" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb5-1385"><a href="#cb5-1385" aria-hidden="true" tabindex="-1"></a>      })</span>
<span id="cb5-1386"><a href="#cb5-1386" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb5-1387"><a href="#cb5-1387" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb5-1388"><a href="#cb5-1388" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-1389"><a href="#cb5-1389" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Generate Item</span></span>
<span id="cb5-1390"><a href="#cb5-1390" aria-hidden="true" tabindex="-1"></a>  <span class="fu">observeEvent</span>(input<span class="sc">$</span>generate, {</span>
<span id="cb5-1391"><a href="#cb5-1391" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tryCatch</span>({</span>
<span id="cb5-1392"><a href="#cb5-1392" aria-hidden="true" tabindex="-1"></a>      <span class="fu">showNotification</span>(<span class="st">"Generating item..."</span>, <span class="at">type =</span> <span class="st">"message"</span>, <span class="at">duration =</span> <span class="dv">2</span>)</span>
<span id="cb5-1393"><a href="#cb5-1393" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb5-1394"><a href="#cb5-1394" aria-hidden="true" tabindex="-1"></a>      item <span class="ot">&lt;-</span> <span class="fu">generate_item_via_ai</span>(input<span class="sc">$</span>grade, input<span class="sc">$</span>subject)</span>
<span id="cb5-1395"><a href="#cb5-1395" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb5-1396"><a href="#cb5-1396" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Update UI fields</span></span>
<span id="cb5-1397"><a href="#cb5-1397" aria-hidden="true" tabindex="-1"></a>      <span class="fu">updateTextAreaInput</span>(session, <span class="st">"question"</span>, <span class="at">value =</span> item<span class="sc">$</span>question)</span>
<span id="cb5-1398"><a href="#cb5-1398" aria-hidden="true" tabindex="-1"></a>      <span class="fu">updateTextInput</span>(session, <span class="st">"optionA"</span>, <span class="at">value =</span> item<span class="sc">$</span>optionA)</span>
<span id="cb5-1399"><a href="#cb5-1399" aria-hidden="true" tabindex="-1"></a>      <span class="fu">updateTextInput</span>(session, <span class="st">"optionB"</span>, <span class="at">value =</span> item<span class="sc">$</span>optionB)</span>
<span id="cb5-1400"><a href="#cb5-1400" aria-hidden="true" tabindex="-1"></a>      <span class="fu">updateTextInput</span>(session, <span class="st">"optionC"</span>, <span class="at">value =</span> item<span class="sc">$</span>optionC)</span>
<span id="cb5-1401"><a href="#cb5-1401" aria-hidden="true" tabindex="-1"></a>      <span class="fu">updateTextInput</span>(session, <span class="st">"optionD"</span>, <span class="at">value =</span> item<span class="sc">$</span>optionD)</span>
<span id="cb5-1402"><a href="#cb5-1402" aria-hidden="true" tabindex="-1"></a>      <span class="fu">updateTextInput</span>(session, <span class="st">"optionE"</span>, <span class="at">value =</span> item<span class="sc">$</span>optionE)</span>
<span id="cb5-1403"><a href="#cb5-1403" aria-hidden="true" tabindex="-1"></a>      <span class="fu">updateTextInput</span>(session, <span class="st">"correctAnswer"</span>, <span class="at">value =</span> item<span class="sc">$</span>correctAnswer)</span>
<span id="cb5-1404"><a href="#cb5-1404" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb5-1405"><a href="#cb5-1405" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Update current_item</span></span>
<span id="cb5-1406"><a href="#cb5-1406" aria-hidden="true" tabindex="-1"></a>      current_item<span class="sc">$</span>grade <span class="ot">&lt;-</span> input<span class="sc">$</span>grade</span>
<span id="cb5-1407"><a href="#cb5-1407" aria-hidden="true" tabindex="-1"></a>      current_item<span class="sc">$</span>subject <span class="ot">&lt;-</span> input<span class="sc">$</span>subject</span>
<span id="cb5-1408"><a href="#cb5-1408" aria-hidden="true" tabindex="-1"></a>      current_item<span class="sc">$</span>question <span class="ot">&lt;-</span> item<span class="sc">$</span>question</span>
<span id="cb5-1409"><a href="#cb5-1409" aria-hidden="true" tabindex="-1"></a>      current_item<span class="sc">$</span>optionA <span class="ot">&lt;-</span> item<span class="sc">$</span>optionA</span>
<span id="cb5-1410"><a href="#cb5-1410" aria-hidden="true" tabindex="-1"></a>      current_item<span class="sc">$</span>optionB <span class="ot">&lt;-</span> item<span class="sc">$</span>optionB</span>
<span id="cb5-1411"><a href="#cb5-1411" aria-hidden="true" tabindex="-1"></a>      current_item<span class="sc">$</span>optionC <span class="ot">&lt;-</span> item<span class="sc">$</span>optionC</span>
<span id="cb5-1412"><a href="#cb5-1412" aria-hidden="true" tabindex="-1"></a>      current_item<span class="sc">$</span>optionD <span class="ot">&lt;-</span> item<span class="sc">$</span>optionD</span>
<span id="cb5-1413"><a href="#cb5-1413" aria-hidden="true" tabindex="-1"></a>      current_item<span class="sc">$</span>optionE <span class="ot">&lt;-</span> item<span class="sc">$</span>optionE</span>
<span id="cb5-1414"><a href="#cb5-1414" aria-hidden="true" tabindex="-1"></a>      current_item<span class="sc">$</span>correctAnswer <span class="ot">&lt;-</span> item<span class="sc">$</span>correctAnswer</span>
<span id="cb5-1415"><a href="#cb5-1415" aria-hidden="true" tabindex="-1"></a>      current_item<span class="sc">$</span>timestamp <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb5-1416"><a href="#cb5-1416" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb5-1417"><a href="#cb5-1417" aria-hidden="true" tabindex="-1"></a>      <span class="fu">showNotification</span>(<span class="st">"Item generated successfully!"</span>, <span class="at">type =</span> <span class="st">"message"</span>)</span>
<span id="cb5-1418"><a href="#cb5-1418" aria-hidden="true" tabindex="-1"></a>    }, <span class="at">error =</span> <span class="cf">function</span>(e) {</span>
<span id="cb5-1419"><a href="#cb5-1419" aria-hidden="true" tabindex="-1"></a>      <span class="fu">showNotification</span>(</span>
<span id="cb5-1420"><a href="#cb5-1420" aria-hidden="true" tabindex="-1"></a>        <span class="fu">paste</span>(<span class="st">"Error generating item:"</span>, e<span class="sc">$</span>message),</span>
<span id="cb5-1421"><a href="#cb5-1421" aria-hidden="true" tabindex="-1"></a>        <span class="at">type =</span> <span class="st">"error"</span>,</span>
<span id="cb5-1422"><a href="#cb5-1422" aria-hidden="true" tabindex="-1"></a>        <span class="at">duration =</span> <span class="dv">5</span></span>
<span id="cb5-1423"><a href="#cb5-1423" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb5-1424"><a href="#cb5-1424" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb5-1425"><a href="#cb5-1425" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb5-1426"><a href="#cb5-1426" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-1427"><a href="#cb5-1427" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Re-generate Unlocked Fields</span></span>
<span id="cb5-1428"><a href="#cb5-1428" aria-hidden="true" tabindex="-1"></a>  <span class="fu">observeEvent</span>(input<span class="sc">$</span>regen_unlocked, {</span>
<span id="cb5-1429"><a href="#cb5-1429" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tryCatch</span>({</span>
<span id="cb5-1430"><a href="#cb5-1430" aria-hidden="true" tabindex="-1"></a>      <span class="fu">showNotification</span>(<span class="st">"Re-generating unlocked fields..."</span>, <span class="at">type =</span> <span class="st">"message"</span>, <span class="at">duration =</span> <span class="dv">2</span>)</span>
<span id="cb5-1431"><a href="#cb5-1431" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb5-1432"><a href="#cb5-1432" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Build locked_values from checkbox states</span></span>
<span id="cb5-1433"><a href="#cb5-1433" aria-hidden="true" tabindex="-1"></a>      locked_values <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb5-1434"><a href="#cb5-1434" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb5-1435"><a href="#cb5-1435" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (input<span class="sc">$</span>lock_question) {</span>
<span id="cb5-1436"><a href="#cb5-1436" aria-hidden="true" tabindex="-1"></a>        locked_values<span class="sc">$</span>question <span class="ot">&lt;-</span> input<span class="sc">$</span>question</span>
<span id="cb5-1437"><a href="#cb5-1437" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb5-1438"><a href="#cb5-1438" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (input<span class="sc">$</span>lock_optionA) {</span>
<span id="cb5-1439"><a href="#cb5-1439" aria-hidden="true" tabindex="-1"></a>        locked_values<span class="sc">$</span>optionA <span class="ot">&lt;-</span> input<span class="sc">$</span>optionA</span>
<span id="cb5-1440"><a href="#cb5-1440" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb5-1441"><a href="#cb5-1441" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (input<span class="sc">$</span>lock_optionB) {</span>
<span id="cb5-1442"><a href="#cb5-1442" aria-hidden="true" tabindex="-1"></a>        locked_values<span class="sc">$</span>optionB <span class="ot">&lt;-</span> input<span class="sc">$</span>optionB</span>
<span id="cb5-1443"><a href="#cb5-1443" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb5-1444"><a href="#cb5-1444" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (input<span class="sc">$</span>lock_optionC) {</span>
<span id="cb5-1445"><a href="#cb5-1445" aria-hidden="true" tabindex="-1"></a>        locked_values<span class="sc">$</span>optionC <span class="ot">&lt;-</span> input<span class="sc">$</span>optionC</span>
<span id="cb5-1446"><a href="#cb5-1446" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb5-1447"><a href="#cb5-1447" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (input<span class="sc">$</span>lock_optionD) {</span>
<span id="cb5-1448"><a href="#cb5-1448" aria-hidden="true" tabindex="-1"></a>        locked_values<span class="sc">$</span>optionD <span class="ot">&lt;-</span> input<span class="sc">$</span>optionD</span>
<span id="cb5-1449"><a href="#cb5-1449" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb5-1450"><a href="#cb5-1450" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (input<span class="sc">$</span>lock_optionE) {</span>
<span id="cb5-1451"><a href="#cb5-1451" aria-hidden="true" tabindex="-1"></a>        locked_values<span class="sc">$</span>optionE <span class="ot">&lt;-</span> input<span class="sc">$</span>optionE</span>
<span id="cb5-1452"><a href="#cb5-1452" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb5-1453"><a href="#cb5-1453" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (input<span class="sc">$</span>lock_correctAnswer) {</span>
<span id="cb5-1454"><a href="#cb5-1454" aria-hidden="true" tabindex="-1"></a>        locked_values<span class="sc">$</span>correctAnswer <span class="ot">&lt;-</span> input<span class="sc">$</span>correctAnswer</span>
<span id="cb5-1455"><a href="#cb5-1455" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb5-1456"><a href="#cb5-1456" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb5-1457"><a href="#cb5-1457" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Call regeneration</span></span>
<span id="cb5-1458"><a href="#cb5-1458" aria-hidden="true" tabindex="-1"></a>      item <span class="ot">&lt;-</span> <span class="fu">regenerate_item_via_ai</span>(</span>
<span id="cb5-1459"><a href="#cb5-1459" aria-hidden="true" tabindex="-1"></a>        input<span class="sc">$</span>grade,</span>
<span id="cb5-1460"><a href="#cb5-1460" aria-hidden="true" tabindex="-1"></a>        input<span class="sc">$</span>subject,</span>
<span id="cb5-1461"><a href="#cb5-1461" aria-hidden="true" tabindex="-1"></a>        input<span class="sc">$</span>regen_instructions,</span>
<span id="cb5-1462"><a href="#cb5-1462" aria-hidden="true" tabindex="-1"></a>        locked_values</span>
<span id="cb5-1463"><a href="#cb5-1463" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb5-1464"><a href="#cb5-1464" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb5-1465"><a href="#cb5-1465" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Validate that locked fields were respected</span></span>
<span id="cb5-1466"><a href="#cb5-1466" aria-hidden="true" tabindex="-1"></a>      violated_locks <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb5-1467"><a href="#cb5-1467" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (field <span class="cf">in</span> <span class="fu">names</span>(locked_values)) {</span>
<span id="cb5-1468"><a href="#cb5-1468" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="sc">!</span><span class="fu">identical</span>(<span class="fu">trimws</span>(item[[field]]), <span class="fu">trimws</span>(locked_values[[field]]))) {</span>
<span id="cb5-1469"><a href="#cb5-1469" aria-hidden="true" tabindex="-1"></a>          violated_locks <span class="ot">&lt;-</span> <span class="fu">c</span>(violated_locks, field)</span>
<span id="cb5-1470"><a href="#cb5-1470" aria-hidden="true" tabindex="-1"></a>          <span class="co"># Restore locked value</span></span>
<span id="cb5-1471"><a href="#cb5-1471" aria-hidden="true" tabindex="-1"></a>          item[[field]] <span class="ot">&lt;-</span> locked_values[[field]]</span>
<span id="cb5-1472"><a href="#cb5-1472" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb5-1473"><a href="#cb5-1473" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb5-1474"><a href="#cb5-1474" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb5-1475"><a href="#cb5-1475" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="fu">length</span>(violated_locks) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb5-1476"><a href="#cb5-1476" aria-hidden="true" tabindex="-1"></a>        <span class="fu">showNotification</span>(</span>
<span id="cb5-1477"><a href="#cb5-1477" aria-hidden="true" tabindex="-1"></a>          <span class="fu">paste</span>(<span class="st">"Warning: AI violated locks on:"</span>, <span class="fu">paste</span>(violated_locks, <span class="at">collapse =</span> <span class="st">", "</span>), <span class="st">". Values restored."</span>),</span>
<span id="cb5-1478"><a href="#cb5-1478" aria-hidden="true" tabindex="-1"></a>          <span class="at">type =</span> <span class="st">"warning"</span>,</span>
<span id="cb5-1479"><a href="#cb5-1479" aria-hidden="true" tabindex="-1"></a>          <span class="at">duration =</span> <span class="dv">5</span></span>
<span id="cb5-1480"><a href="#cb5-1480" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb5-1481"><a href="#cb5-1481" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb5-1482"><a href="#cb5-1482" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb5-1483"><a href="#cb5-1483" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Update UI fields</span></span>
<span id="cb5-1484"><a href="#cb5-1484" aria-hidden="true" tabindex="-1"></a>      <span class="fu">updateTextAreaInput</span>(session, <span class="st">"question"</span>, <span class="at">value =</span> item<span class="sc">$</span>question)</span>
<span id="cb5-1485"><a href="#cb5-1485" aria-hidden="true" tabindex="-1"></a>      <span class="fu">updateTextInput</span>(session, <span class="st">"optionA"</span>, <span class="at">value =</span> item<span class="sc">$</span>optionA)</span>
<span id="cb5-1486"><a href="#cb5-1486" aria-hidden="true" tabindex="-1"></a>      <span class="fu">updateTextInput</span>(session, <span class="st">"optionB"</span>, <span class="at">value =</span> item<span class="sc">$</span>optionB)</span>
<span id="cb5-1487"><a href="#cb5-1487" aria-hidden="true" tabindex="-1"></a>      <span class="fu">updateTextInput</span>(session, <span class="st">"optionC"</span>, <span class="at">value =</span> item<span class="sc">$</span>optionC)</span>
<span id="cb5-1488"><a href="#cb5-1488" aria-hidden="true" tabindex="-1"></a>      <span class="fu">updateTextInput</span>(session, <span class="st">"optionD"</span>, <span class="at">value =</span> item<span class="sc">$</span>optionD)</span>
<span id="cb5-1489"><a href="#cb5-1489" aria-hidden="true" tabindex="-1"></a>      <span class="fu">updateTextInput</span>(session, <span class="st">"optionE"</span>, <span class="at">value =</span> item<span class="sc">$</span>optionE)</span>
<span id="cb5-1490"><a href="#cb5-1490" aria-hidden="true" tabindex="-1"></a>      <span class="fu">updateTextInput</span>(session, <span class="st">"correctAnswer"</span>, <span class="at">value =</span> item<span class="sc">$</span>correctAnswer)</span>
<span id="cb5-1491"><a href="#cb5-1491" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb5-1492"><a href="#cb5-1492" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Update current_item</span></span>
<span id="cb5-1493"><a href="#cb5-1493" aria-hidden="true" tabindex="-1"></a>      current_item<span class="sc">$</span>grade <span class="ot">&lt;-</span> input<span class="sc">$</span>grade</span>
<span id="cb5-1494"><a href="#cb5-1494" aria-hidden="true" tabindex="-1"></a>      current_item<span class="sc">$</span>subject <span class="ot">&lt;-</span> input<span class="sc">$</span>subject</span>
<span id="cb5-1495"><a href="#cb5-1495" aria-hidden="true" tabindex="-1"></a>      current_item<span class="sc">$</span>question <span class="ot">&lt;-</span> item<span class="sc">$</span>question</span>
<span id="cb5-1496"><a href="#cb5-1496" aria-hidden="true" tabindex="-1"></a>      current_item<span class="sc">$</span>optionA <span class="ot">&lt;-</span> item<span class="sc">$</span>optionA</span>
<span id="cb5-1497"><a href="#cb5-1497" aria-hidden="true" tabindex="-1"></a>      current_item<span class="sc">$</span>optionB <span class="ot">&lt;-</span> item<span class="sc">$</span>optionB</span>
<span id="cb5-1498"><a href="#cb5-1498" aria-hidden="true" tabindex="-1"></a>      current_item<span class="sc">$</span>optionC <span class="ot">&lt;-</span> item<span class="sc">$</span>optionC</span>
<span id="cb5-1499"><a href="#cb5-1499" aria-hidden="true" tabindex="-1"></a>      current_item<span class="sc">$</span>optionD <span class="ot">&lt;-</span> item<span class="sc">$</span>optionD</span>
<span id="cb5-1500"><a href="#cb5-1500" aria-hidden="true" tabindex="-1"></a>      current_item<span class="sc">$</span>optionE <span class="ot">&lt;-</span> item<span class="sc">$</span>optionE</span>
<span id="cb5-1501"><a href="#cb5-1501" aria-hidden="true" tabindex="-1"></a>      current_item<span class="sc">$</span>correctAnswer <span class="ot">&lt;-</span> item<span class="sc">$</span>correctAnswer</span>
<span id="cb5-1502"><a href="#cb5-1502" aria-hidden="true" tabindex="-1"></a>      current_item<span class="sc">$</span>timestamp <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb5-1503"><a href="#cb5-1503" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb5-1504"><a href="#cb5-1504" aria-hidden="true" tabindex="-1"></a>      <span class="fu">showNotification</span>(<span class="st">"Item re-generated successfully!"</span>, <span class="at">type =</span> <span class="st">"message"</span>)</span>
<span id="cb5-1505"><a href="#cb5-1505" aria-hidden="true" tabindex="-1"></a>    }, <span class="at">error =</span> <span class="cf">function</span>(e) {</span>
<span id="cb5-1506"><a href="#cb5-1506" aria-hidden="true" tabindex="-1"></a>      <span class="fu">showNotification</span>(</span>
<span id="cb5-1507"><a href="#cb5-1507" aria-hidden="true" tabindex="-1"></a>        <span class="fu">paste</span>(<span class="st">"Error re-generating item:"</span>, e<span class="sc">$</span>message),</span>
<span id="cb5-1508"><a href="#cb5-1508" aria-hidden="true" tabindex="-1"></a>        <span class="at">type =</span> <span class="st">"error"</span>,</span>
<span id="cb5-1509"><a href="#cb5-1509" aria-hidden="true" tabindex="-1"></a>        <span class="at">duration =</span> <span class="dv">5</span></span>
<span id="cb5-1510"><a href="#cb5-1510" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb5-1511"><a href="#cb5-1511" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb5-1512"><a href="#cb5-1512" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb5-1513"><a href="#cb5-1513" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-1514"><a href="#cb5-1514" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Update Item</span></span>
<span id="cb5-1515"><a href="#cb5-1515" aria-hidden="true" tabindex="-1"></a>  <span class="fu">observeEvent</span>(input<span class="sc">$</span>update_item, {</span>
<span id="cb5-1516"><a href="#cb5-1516" aria-hidden="true" tabindex="-1"></a>    item <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb5-1517"><a href="#cb5-1517" aria-hidden="true" tabindex="-1"></a>      <span class="at">question =</span> input<span class="sc">$</span>question,</span>
<span id="cb5-1518"><a href="#cb5-1518" aria-hidden="true" tabindex="-1"></a>      <span class="at">optionA =</span> input<span class="sc">$</span>optionA,</span>
<span id="cb5-1519"><a href="#cb5-1519" aria-hidden="true" tabindex="-1"></a>      <span class="at">optionB =</span> input<span class="sc">$</span>optionB,</span>
<span id="cb5-1520"><a href="#cb5-1520" aria-hidden="true" tabindex="-1"></a>      <span class="at">optionC =</span> input<span class="sc">$</span>optionC,</span>
<span id="cb5-1521"><a href="#cb5-1521" aria-hidden="true" tabindex="-1"></a>      <span class="at">optionD =</span> input<span class="sc">$</span>optionD,</span>
<span id="cb5-1522"><a href="#cb5-1522" aria-hidden="true" tabindex="-1"></a>      <span class="at">optionE =</span> input<span class="sc">$</span>optionE,</span>
<span id="cb5-1523"><a href="#cb5-1523" aria-hidden="true" tabindex="-1"></a>      <span class="at">correctAnswer =</span> input<span class="sc">$</span>correctAnswer</span>
<span id="cb5-1524"><a href="#cb5-1524" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb5-1525"><a href="#cb5-1525" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-1526"><a href="#cb5-1526" aria-hidden="true" tabindex="-1"></a>    validation <span class="ot">&lt;-</span> <span class="fu">validate_item</span>(item)</span>
<span id="cb5-1527"><a href="#cb5-1527" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-1528"><a href="#cb5-1528" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span>validation<span class="sc">$</span>valid) {</span>
<span id="cb5-1529"><a href="#cb5-1529" aria-hidden="true" tabindex="-1"></a>      <span class="fu">showNotification</span>(</span>
<span id="cb5-1530"><a href="#cb5-1530" aria-hidden="true" tabindex="-1"></a>        <span class="fu">paste</span>(<span class="st">"Validation errors:"</span>, <span class="fu">paste</span>(validation<span class="sc">$</span>errors, <span class="at">collapse =</span> <span class="st">"; "</span>)),</span>
<span id="cb5-1531"><a href="#cb5-1531" aria-hidden="true" tabindex="-1"></a>        <span class="at">type =</span> <span class="st">"error"</span>,</span>
<span id="cb5-1532"><a href="#cb5-1532" aria-hidden="true" tabindex="-1"></a>        <span class="at">duration =</span> <span class="dv">5</span></span>
<span id="cb5-1533"><a href="#cb5-1533" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb5-1534"><a href="#cb5-1534" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb5-1535"><a href="#cb5-1535" aria-hidden="true" tabindex="-1"></a>      current_item<span class="sc">$</span>grade <span class="ot">&lt;-</span> input<span class="sc">$</span>grade</span>
<span id="cb5-1536"><a href="#cb5-1536" aria-hidden="true" tabindex="-1"></a>      current_item<span class="sc">$</span>subject <span class="ot">&lt;-</span> input<span class="sc">$</span>subject</span>
<span id="cb5-1537"><a href="#cb5-1537" aria-hidden="true" tabindex="-1"></a>      current_item<span class="sc">$</span>question <span class="ot">&lt;-</span> item<span class="sc">$</span>question</span>
<span id="cb5-1538"><a href="#cb5-1538" aria-hidden="true" tabindex="-1"></a>      current_item<span class="sc">$</span>optionA <span class="ot">&lt;-</span> item<span class="sc">$</span>optionA</span>
<span id="cb5-1539"><a href="#cb5-1539" aria-hidden="true" tabindex="-1"></a>      current_item<span class="sc">$</span>optionB <span class="ot">&lt;-</span> item<span class="sc">$</span>optionB</span>
<span id="cb5-1540"><a href="#cb5-1540" aria-hidden="true" tabindex="-1"></a>      current_item<span class="sc">$</span>optionC <span class="ot">&lt;-</span> item<span class="sc">$</span>optionC</span>
<span id="cb5-1541"><a href="#cb5-1541" aria-hidden="true" tabindex="-1"></a>      current_item<span class="sc">$</span>optionD <span class="ot">&lt;-</span> item<span class="sc">$</span>optionD</span>
<span id="cb5-1542"><a href="#cb5-1542" aria-hidden="true" tabindex="-1"></a>      current_item<span class="sc">$</span>optionE <span class="ot">&lt;-</span> item<span class="sc">$</span>optionE</span>
<span id="cb5-1543"><a href="#cb5-1543" aria-hidden="true" tabindex="-1"></a>      current_item<span class="sc">$</span>correctAnswer <span class="ot">&lt;-</span> item<span class="sc">$</span>correctAnswer</span>
<span id="cb5-1544"><a href="#cb5-1544" aria-hidden="true" tabindex="-1"></a>      current_item<span class="sc">$</span>timestamp <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb5-1545"><a href="#cb5-1545" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb5-1546"><a href="#cb5-1546" aria-hidden="true" tabindex="-1"></a>      <span class="fu">showNotification</span>(<span class="st">"Item updated successfully!"</span>, <span class="at">type =</span> <span class="st">"message"</span>)</span>
<span id="cb5-1547"><a href="#cb5-1547" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb5-1548"><a href="#cb5-1548" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb5-1549"><a href="#cb5-1549" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-1550"><a href="#cb5-1550" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Save Item</span></span>
<span id="cb5-1551"><a href="#cb5-1551" aria-hidden="true" tabindex="-1"></a>  <span class="fu">observeEvent</span>(input<span class="sc">$</span>save_item, {</span>
<span id="cb5-1552"><a href="#cb5-1552" aria-hidden="true" tabindex="-1"></a>    item <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb5-1553"><a href="#cb5-1553" aria-hidden="true" tabindex="-1"></a>      <span class="at">grade =</span> input<span class="sc">$</span>grade,</span>
<span id="cb5-1554"><a href="#cb5-1554" aria-hidden="true" tabindex="-1"></a>      <span class="at">subject =</span> input<span class="sc">$</span>subject,</span>
<span id="cb5-1555"><a href="#cb5-1555" aria-hidden="true" tabindex="-1"></a>      <span class="at">question =</span> input<span class="sc">$</span>question,</span>
<span id="cb5-1556"><a href="#cb5-1556" aria-hidden="true" tabindex="-1"></a>      <span class="at">optionA =</span> input<span class="sc">$</span>optionA,</span>
<span id="cb5-1557"><a href="#cb5-1557" aria-hidden="true" tabindex="-1"></a>      <span class="at">optionB =</span> input<span class="sc">$</span>optionB,</span>
<span id="cb5-1558"><a href="#cb5-1558" aria-hidden="true" tabindex="-1"></a>      <span class="at">optionC =</span> input<span class="sc">$</span>optionC,</span>
<span id="cb5-1559"><a href="#cb5-1559" aria-hidden="true" tabindex="-1"></a>      <span class="at">optionD =</span> input<span class="sc">$</span>optionD,</span>
<span id="cb5-1560"><a href="#cb5-1560" aria-hidden="true" tabindex="-1"></a>      <span class="at">optionE =</span> input<span class="sc">$</span>optionE,</span>
<span id="cb5-1561"><a href="#cb5-1561" aria-hidden="true" tabindex="-1"></a>      <span class="at">correctAnswer =</span> input<span class="sc">$</span>correctAnswer</span>
<span id="cb5-1562"><a href="#cb5-1562" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb5-1563"><a href="#cb5-1563" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-1564"><a href="#cb5-1564" aria-hidden="true" tabindex="-1"></a>    validation <span class="ot">&lt;-</span> <span class="fu">validate_item</span>(item)</span>
<span id="cb5-1565"><a href="#cb5-1565" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-1566"><a href="#cb5-1566" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span>validation<span class="sc">$</span>valid) {</span>
<span id="cb5-1567"><a href="#cb5-1567" aria-hidden="true" tabindex="-1"></a>      <span class="fu">showNotification</span>(</span>
<span id="cb5-1568"><a href="#cb5-1568" aria-hidden="true" tabindex="-1"></a>        <span class="fu">paste</span>(<span class="st">"Cannot save. Validation errors:"</span>, <span class="fu">paste</span>(validation<span class="sc">$</span>errors, <span class="at">collapse =</span> <span class="st">"; "</span>)),</span>
<span id="cb5-1569"><a href="#cb5-1569" aria-hidden="true" tabindex="-1"></a>        <span class="at">type =</span> <span class="st">"error"</span>,</span>
<span id="cb5-1570"><a href="#cb5-1570" aria-hidden="true" tabindex="-1"></a>        <span class="at">duration =</span> <span class="dv">5</span></span>
<span id="cb5-1571"><a href="#cb5-1571" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb5-1572"><a href="#cb5-1572" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb5-1573"><a href="#cb5-1573" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Add timestamp</span></span>
<span id="cb5-1574"><a href="#cb5-1574" aria-hidden="true" tabindex="-1"></a>      item<span class="sc">$</span>timestamp <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb5-1575"><a href="#cb5-1575" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb5-1576"><a href="#cb5-1576" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Append to saved items</span></span>
<span id="cb5-1577"><a href="#cb5-1577" aria-hidden="true" tabindex="-1"></a>      current_saved <span class="ot">&lt;-</span> <span class="fu">saved_items</span>()</span>
<span id="cb5-1578"><a href="#cb5-1578" aria-hidden="true" tabindex="-1"></a>      current_saved[[<span class="fu">length</span>(current_saved) <span class="sc">+</span> <span class="dv">1</span>]] <span class="ot">&lt;-</span> item</span>
<span id="cb5-1579"><a href="#cb5-1579" aria-hidden="true" tabindex="-1"></a>      <span class="fu">saved_items</span>(current_saved)</span>
<span id="cb5-1580"><a href="#cb5-1580" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb5-1581"><a href="#cb5-1581" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Save to file</span></span>
<span id="cb5-1582"><a href="#cb5-1582" aria-hidden="true" tabindex="-1"></a>      <span class="fu">tryCatch</span>({</span>
<span id="cb5-1583"><a href="#cb5-1583" aria-hidden="true" tabindex="-1"></a>        <span class="fu">saveRDS</span>(current_saved, <span class="st">"saved_items.rds"</span>)</span>
<span id="cb5-1584"><a href="#cb5-1584" aria-hidden="true" tabindex="-1"></a>        <span class="fu">showNotification</span>(</span>
<span id="cb5-1585"><a href="#cb5-1585" aria-hidden="true" tabindex="-1"></a>          <span class="fu">paste</span>(<span class="st">"Item saved successfully! Total items:"</span>, <span class="fu">length</span>(current_saved)),</span>
<span id="cb5-1586"><a href="#cb5-1586" aria-hidden="true" tabindex="-1"></a>          <span class="at">type =</span> <span class="st">"message"</span>,</span>
<span id="cb5-1587"><a href="#cb5-1587" aria-hidden="true" tabindex="-1"></a>          <span class="at">duration =</span> <span class="dv">3</span></span>
<span id="cb5-1588"><a href="#cb5-1588" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb5-1589"><a href="#cb5-1589" aria-hidden="true" tabindex="-1"></a>      }, <span class="at">error =</span> <span class="cf">function</span>(e) {</span>
<span id="cb5-1590"><a href="#cb5-1590" aria-hidden="true" tabindex="-1"></a>        <span class="fu">showNotification</span>(</span>
<span id="cb5-1591"><a href="#cb5-1591" aria-hidden="true" tabindex="-1"></a>          <span class="fu">paste</span>(<span class="st">"Error saving to file:"</span>, e<span class="sc">$</span>message),</span>
<span id="cb5-1592"><a href="#cb5-1592" aria-hidden="true" tabindex="-1"></a>          <span class="at">type =</span> <span class="st">"error"</span>,</span>
<span id="cb5-1593"><a href="#cb5-1593" aria-hidden="true" tabindex="-1"></a>          <span class="at">duration =</span> <span class="dv">5</span></span>
<span id="cb5-1594"><a href="#cb5-1594" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb5-1595"><a href="#cb5-1595" aria-hidden="true" tabindex="-1"></a>      })</span>
<span id="cb5-1596"><a href="#cb5-1596" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb5-1597"><a href="#cb5-1597" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb5-1598"><a href="#cb5-1598" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-1599"><a href="#cb5-1599" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Render saved items table</span></span>
<span id="cb5-1600"><a href="#cb5-1600" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>saved_items_table <span class="ot">&lt;-</span> <span class="fu">renderTable</span>({</span>
<span id="cb5-1601"><a href="#cb5-1601" aria-hidden="true" tabindex="-1"></a>    items <span class="ot">&lt;-</span> <span class="fu">saved_items</span>()</span>
<span id="cb5-1602"><a href="#cb5-1602" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-1603"><a href="#cb5-1603" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">length</span>(items) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb5-1604"><a href="#cb5-1604" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(<span class="fu">data.frame</span>(</span>
<span id="cb5-1605"><a href="#cb5-1605" aria-hidden="true" tabindex="-1"></a>        <span class="at">Message =</span> <span class="st">"No items saved yet"</span></span>
<span id="cb5-1606"><a href="#cb5-1606" aria-hidden="true" tabindex="-1"></a>      ))</span>
<span id="cb5-1607"><a href="#cb5-1607" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb5-1608"><a href="#cb5-1608" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-1609"><a href="#cb5-1609" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create summary table</span></span>
<span id="cb5-1610"><a href="#cb5-1610" aria-hidden="true" tabindex="-1"></a>    summary_df <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, <span class="fu">lapply</span>(<span class="fu">seq_along</span>(items), <span class="cf">function</span>(i) {</span>
<span id="cb5-1611"><a href="#cb5-1611" aria-hidden="true" tabindex="-1"></a>      item <span class="ot">&lt;-</span> items[[i]]</span>
<span id="cb5-1612"><a href="#cb5-1612" aria-hidden="true" tabindex="-1"></a>      <span class="fu">data.frame</span>(</span>
<span id="cb5-1613"><a href="#cb5-1613" aria-hidden="true" tabindex="-1"></a>        <span class="at">Index =</span> i,</span>
<span id="cb5-1614"><a href="#cb5-1614" aria-hidden="true" tabindex="-1"></a>        <span class="at">Grade =</span> item<span class="sc">$</span>grade,</span>
<span id="cb5-1615"><a href="#cb5-1615" aria-hidden="true" tabindex="-1"></a>        <span class="at">Subject =</span> item<span class="sc">$</span>subject,</span>
<span id="cb5-1616"><a href="#cb5-1616" aria-hidden="true" tabindex="-1"></a>        <span class="at">Question =</span> <span class="fu">substr</span>(item<span class="sc">$</span>question, <span class="dv">1</span>, <span class="dv">60</span>),</span>
<span id="cb5-1617"><a href="#cb5-1617" aria-hidden="true" tabindex="-1"></a>        <span class="at">Timestamp =</span> <span class="fu">as.character</span>(item<span class="sc">$</span>timestamp),</span>
<span id="cb5-1618"><a href="#cb5-1618" aria-hidden="true" tabindex="-1"></a>        <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span></span>
<span id="cb5-1619"><a href="#cb5-1619" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb5-1620"><a href="#cb5-1620" aria-hidden="true" tabindex="-1"></a>    }))</span>
<span id="cb5-1621"><a href="#cb5-1621" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-1622"><a href="#cb5-1622" aria-hidden="true" tabindex="-1"></a>    summary_df</span>
<span id="cb5-1623"><a href="#cb5-1623" aria-hidden="true" tabindex="-1"></a>  }, <span class="at">striped =</span> <span class="cn">TRUE</span>, <span class="at">hover =</span> <span class="cn">TRUE</span>, <span class="at">bordered =</span> <span class="cn">TRUE</span>)</span>
<span id="cb5-1624"><a href="#cb5-1624" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-1625"><a href="#cb5-1625" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Feedback message</span></span>
<span id="cb5-1626"><a href="#cb5-1626" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>feedback_message <span class="ot">&lt;-</span> <span class="fu">renderUI</span>({</span>
<span id="cb5-1627"><a href="#cb5-1627" aria-hidden="true" tabindex="-1"></a>    items <span class="ot">&lt;-</span> <span class="fu">saved_items</span>()</span>
<span id="cb5-1628"><a href="#cb5-1628" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">length</span>(items) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb5-1629"><a href="#cb5-1629" aria-hidden="true" tabindex="-1"></a>      <span class="fu">div</span>(</span>
<span id="cb5-1630"><a href="#cb5-1630" aria-hidden="true" tabindex="-1"></a>        <span class="at">class =</span> <span class="st">"alert alert-info"</span>,</span>
<span id="cb5-1631"><a href="#cb5-1631" aria-hidden="true" tabindex="-1"></a>        <span class="fu">icon</span>(<span class="st">"circle-info"</span>),</span>
<span id="cb5-1632"><a href="#cb5-1632" aria-hidden="true" tabindex="-1"></a>        <span class="fu">paste</span>(<span class="st">"Total saved items:"</span>, <span class="fu">length</span>(items))</span>
<span id="cb5-1633"><a href="#cb5-1633" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb5-1634"><a href="#cb5-1634" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb5-1635"><a href="#cb5-1635" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb5-1636"><a href="#cb5-1636" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-1637"><a href="#cb5-1637" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-1638"><a href="#cb5-1638" aria-hidden="true" tabindex="-1"></a><span class="co"># ==============================================================================</span></span>
<span id="cb5-1639"><a href="#cb5-1639" aria-hidden="true" tabindex="-1"></a><span class="co"># RUN APP</span></span>
<span id="cb5-1640"><a href="#cb5-1640" aria-hidden="true" tabindex="-1"></a><span class="co"># ==============================================================================</span></span>
<span id="cb5-1641"><a href="#cb5-1641" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-1642"><a href="#cb5-1642" aria-hidden="true" tabindex="-1"></a><span class="fu">shinyApp</span>(<span class="at">ui =</span> ui, <span class="at">server =</span> server)</span>
<span id="cb5-1643"><a href="#cb5-1643" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-1644"><a href="#cb5-1644" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb5-1645"><a href="#cb5-1645" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-1646"><a href="#cb5-1646" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb5-1647"><a href="#cb5-1647" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-1648"><a href="#cb5-1648" aria-hidden="true" tabindex="-1"></a><span class="fu">### Screenshots of the App with LLM Integration</span></span>
<span id="cb5-1649"><a href="#cb5-1649" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-1650"><a href="#cb5-1650" aria-hidden="true" tabindex="-1"></a>::: {.callout-note collapse="true"}</span>
<span id="cb5-1651"><a href="#cb5-1651" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-1652"><a href="#cb5-1652" aria-hidden="true" tabindex="-1"></a><span class="fu">## Initial App State</span></span>
<span id="cb5-1653"><a href="#cb5-1653" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-1654"><a href="#cb5-1654" aria-hidden="true" tabindex="-1"></a><span class="al">![](screenshots/mcq_maker_0.png)</span>{fig-align="center"}</span>
<span id="cb5-1655"><a href="#cb5-1655" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-1656"><a href="#cb5-1656" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb5-1657"><a href="#cb5-1657" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-1658"><a href="#cb5-1658" aria-hidden="true" tabindex="-1"></a>::: {.callout-note collapse="true"}</span>
<span id="cb5-1659"><a href="#cb5-1659" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-1660"><a href="#cb5-1660" aria-hidden="true" tabindex="-1"></a><span class="fu">## After LLM Item Generation</span></span>
<span id="cb5-1661"><a href="#cb5-1661" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-1662"><a href="#cb5-1662" aria-hidden="true" tabindex="-1"></a><span class="al">![](screenshots/mcq_maker_1.png)</span>{fig-align="center"}</span>
<span id="cb5-1663"><a href="#cb5-1663" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-1664"><a href="#cb5-1664" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb5-1665"><a href="#cb5-1665" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-1666"><a href="#cb5-1666" aria-hidden="true" tabindex="-1"></a>::: {.callout-note collapse="true"}</span>
<span id="cb5-1667"><a href="#cb5-1667" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-1668"><a href="#cb5-1668" aria-hidden="true" tabindex="-1"></a><span class="fu">## Partial Item Re-generation</span></span>
<span id="cb5-1669"><a href="#cb5-1669" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-1670"><a href="#cb5-1670" aria-hidden="true" tabindex="-1"></a><span class="al">![](screenshots/mcq_maker_2.png)</span>{fig-align="center"}</span>
<span id="cb5-1671"><a href="#cb5-1671" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-1672"><a href="#cb5-1672" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb5-1673"><a href="#cb5-1673" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-1674"><a href="#cb5-1674" aria-hidden="true" tabindex="-1"></a>::: {.callout-note collapse="true"}</span>
<span id="cb5-1675"><a href="#cb5-1675" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-1676"><a href="#cb5-1676" aria-hidden="true" tabindex="-1"></a><span class="fu">## Re-generated Item</span></span>
<span id="cb5-1677"><a href="#cb5-1677" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-1678"><a href="#cb5-1678" aria-hidden="true" tabindex="-1"></a><span class="al">![](screenshots/mcq_maker_3.png)</span>{fig-align="center"}</span>
<span id="cb5-1679"><a href="#cb5-1679" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-1680"><a href="#cb5-1680" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb5-1681"><a href="#cb5-1681" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-1682"><a href="#cb5-1682" aria-hidden="true" tabindex="-1"></a>::: {.callout-note collapse="true"}</span>
<span id="cb5-1683"><a href="#cb5-1683" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-1684"><a href="#cb5-1684" aria-hidden="true" tabindex="-1"></a><span class="fu">## Direct Item Editing</span></span>
<span id="cb5-1685"><a href="#cb5-1685" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-1686"><a href="#cb5-1686" aria-hidden="true" tabindex="-1"></a><span class="al">![](screenshots/mcq_maker_4.png)</span>{fig-align="center"}</span>
<span id="cb5-1687"><a href="#cb5-1687" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-1688"><a href="#cb5-1688" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb5-1689"><a href="#cb5-1689" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-1690"><a href="#cb5-1690" aria-hidden="true" tabindex="-1"></a><span class="fu">## Build your own app!</span></span>
<span id="cb5-1691"><a href="#cb5-1691" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-1692"><a href="#cb5-1692" aria-hidden="true" tabindex="-1"></a>Now it's time for _you_ to build a Shiny app!</span></code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">
<p>This workshop was developed by Christopher Runyon.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
<p>This book was built with <a href="https://quarto.org/">Quarto</a>.</p>
</div>
  </div>
</footer>


</body></html>